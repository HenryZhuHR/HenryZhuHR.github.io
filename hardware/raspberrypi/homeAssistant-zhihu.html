<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>【Home Assistant】把米家设备接入苹果 | HenryZhu's xyz</title>
    <meta name="description" content="个人站点">
    <meta name="generator" content="VitePress v1.1.4">
    <link rel="preload stylesheet" href="/assets/style.CWwDg0Y0.css" as="style">
    
    <script type="module" src="/assets/app.cdbEmlM6.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.3CCflSmY.js">
    <link rel="modulepreload" href="/assets/chunks/framework.bdxXucLJ.js">
    <link rel="modulepreload" href="/assets/chunks/hacs-install-setting.DhhHuNJH.js">
    <link rel="modulepreload" href="/assets/hardware_raspberrypi_homeAssistant-zhihu.md.BAM_9FEs.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-b1bb354a><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0277d463></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0277d463> Skip to content </a><!--]--><!----><header class="VPNav" data-v-b1bb354a data-v-954d38e9><div class="VPNavBar top" data-v-954d38e9 data-v-6b1ca918><div class="wrapper" data-v-6b1ca918><div class="container" data-v-6b1ca918><div class="title" data-v-6b1ca918><div class="VPNavBarTitle" data-v-6b1ca918 data-v-b2cab524><a class="title" href="/" data-v-b2cab524><!--[--><!--]--><!----><span data-v-b2cab524>HenryZhu&#39;s xyz</span><!--[--><!--]--></a></div></div><div class="content" data-v-6b1ca918><div class="content-body" data-v-6b1ca918><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6b1ca918><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6b1ca918 data-v-09032615><span id="main-nav-aria-label" class="visually-hidden" data-v-09032615>Main Navigation</span><!--[--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6b1ca918 data-v-e280d45c><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="切换到深色模式" aria-checked="false" data-v-e280d45c data-v-5b28c0bf data-v-ddf0ad2d><span class="check" data-v-ddf0ad2d><span class="icon" data-v-ddf0ad2d><!--[--><span class="vpi-sun sun" data-v-5b28c0bf></span><span class="vpi-moon moon" data-v-5b28c0bf></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6b1ca918 data-v-19c891b6 data-v-2040afa4><!--[--><a class="VPSocialLink no-icon" href="https://github.com/HenryZhuHR" aria-label="github" target="_blank" rel="noopener" data-v-2040afa4 data-v-c3b9fedb><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6b1ca918 data-v-808d3abf data-v-437ab5a9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-437ab5a9><span class="vpi-more-horizontal icon" data-v-437ab5a9></span></button><div class="menu" data-v-437ab5a9><div class="VPMenu" data-v-437ab5a9 data-v-393c8ff8><!----><!--[--><!--[--><!----><div class="group" data-v-808d3abf><div class="item appearance" data-v-808d3abf><p class="label" data-v-808d3abf>深色模式开关</p><div class="appearance-action" data-v-808d3abf><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="切换到深色模式" aria-checked="false" data-v-808d3abf data-v-5b28c0bf data-v-ddf0ad2d><span class="check" data-v-ddf0ad2d><span class="icon" data-v-ddf0ad2d><!--[--><span class="vpi-sun sun" data-v-5b28c0bf></span><span class="vpi-moon moon" data-v-5b28c0bf></span><!--]--></span></span></button></div></div></div><div class="group" data-v-808d3abf><div class="item social-links" data-v-808d3abf><div class="VPSocialLinks social-links-list" data-v-808d3abf data-v-2040afa4><!--[--><a class="VPSocialLink no-icon" href="https://github.com/HenryZhuHR" aria-label="github" target="_blank" rel="noopener" data-v-2040afa4 data-v-c3b9fedb><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6b1ca918 data-v-c79f9601><span class="container" data-v-c79f9601><span class="top" data-v-c79f9601></span><span class="middle" data-v-c79f9601></span><span class="bottom" data-v-c79f9601></span></span></button></div></div></div></div><div class="divider" data-v-6b1ca918><div class="divider-line" data-v-6b1ca918></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-b1bb354a data-v-eeb6ef07><div class="container" data-v-eeb6ef07><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-eeb6ef07 data-v-863045a1><button data-v-863045a1>回到顶部</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-b1bb354a data-v-1b54c654><div class="VPDoc has-aside" data-v-1b54c654 data-v-657d647b><!--[--><!--]--><div class="container" data-v-657d647b><div class="aside" data-v-657d647b><div class="aside-curtain" data-v-657d647b></div><div class="aside-container" data-v-657d647b><div class="aside-content" data-v-657d647b><div class="VPDocAside" data-v-657d647b data-v-e151a091><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" role="navigation" data-v-e151a091 data-v-1e426887><div class="content" data-v-1e426887><div class="outline-marker" data-v-1e426887></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-1e426887>页面导航</div><ul class="VPDocOutlineItem root" data-v-1e426887 data-v-30d85cc4><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-e151a091></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-657d647b><div class="content-container" data-v-657d647b><!--[--><!--]--><main class="main" data-v-657d647b><div style="position:relative;" class="vp-doc _hardware_raspberrypi_homeAssistant-zhihu external-link-icon-enabled" data-v-657d647b><div><p>#! <a href="https://zhuanlan.zhihu.com/p/613160658" target="_blank" rel="noreferrer">https://zhuanlan.zhihu.com/p/613160658</a></p><h1 id="【home-assistant】把米家设备接入苹果" tabindex="-1">【Home Assistant】把米家设备接入苹果 <a class="header-anchor" href="#【home-assistant】把米家设备接入苹果" aria-label="Permalink to &quot;【Home Assistant】把米家设备接入苹果&quot;">​</a></h1><p><a href="https://www.home-assistant.io/" target="_blank" rel="noreferrer">Home Assistant</a> 是一款基于 Python 的智能家居开源系统，支持多品牌的智能家居设备，用于实现设备的语音控制、自动化等。</p><ul><li><strong>动机</strong>：苹果的家居好是好，但是又贵又少；小米的东西便宜，但是不能直接加到苹果家庭内</li><li><strong>解决</strong>：将 Home Assistant 安装到树莓派上，作为中枢控制</li></ul><p>支持列表：<a href="https://www.jianguoyun.com/p/DbzdYzoQp5HMBhjZ4IkB" target="_blank" rel="noreferrer">https://www.jianguoyun.com/p/DbzdYzoQp5HMBhjZ4IkB</a></p><h2 id="home-assistant-安装" tabindex="-1">Home Assistant 安装 <a class="header-anchor" href="#home-assistant-安装" aria-label="Permalink to &quot;Home Assistant 安装&quot;">​</a></h2><h3 id="docker-的安装方式" tabindex="-1">Docker 的安装方式 <a class="header-anchor" href="#docker-的安装方式" aria-label="Permalink to &quot;Docker 的安装方式&quot;">​</a></h3><p>采用 docker 的方式在树莓派上安装 Home Assistant</p><p>终端运行以安装docker</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sSL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://get.docker.com</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sh</span></span></code></pre></div><p>启动docker，并且将 Docker 设置为自动启动。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>sudo service docker start</span></span>
<span class="line"><span>sudo systemctl enable docker</span></span></code></pre></div><p>然后重新启动 Pi，或者通过以下方式启动 Docker 守护程序：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span></span></code></pre></div><p>安装完 docker 后，直接安装 Home Assistant，其中需要修改 <code>-v</code> 参数 <code>/home/pi/homeassistant:/config</code> 为 Home Assistant 配置文件所在目录，修改为 <code>&lt;路径&gt;:/config</code> ，其余可以不改变</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> homeassistant</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --privileged</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --restart=unless-stopped</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -e</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> TZ=MY_TIME_ZONE</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/pi/homeassistant:/config</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  --network=host</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ghcr.io/home-assistant/raspberrypi4-homeassistant:stable</span></span></code></pre></div><h4 id="重启-home-assistant" tabindex="-1">重启 Home Assistant <a class="header-anchor" href="#重启-home-assistant" aria-label="Permalink to &quot;重启 Home Assistant&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> homeassistant</span></span></code></pre></div><h3 id="supervised-版本安装" tabindex="-1">Supervised 版本安装 <a class="header-anchor" href="#supervised-版本安装" aria-label="Permalink to &quot;Supervised 版本安装&quot;">​</a></h3><blockquote><p>参考 <a href="https://github.com/home-assistant/supervised-installer" target="_blank" rel="noreferrer">Install Home Assistant Supervised</a> 获取更多的信息</p></blockquote><p>查看树莓派版本</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lsb_release</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span></span></code></pre></div><h3 id="networkmanager" tabindex="-1">NetworkManager <a class="header-anchor" href="#networkmanager" aria-label="Permalink to &quot;NetworkManager&quot;">​</a></h3><p>HomeAssistantSupervised需要NetworkManager的支持，树莓派官方使用的是ModemManager、openresolv和dhcpcd5。</p><p>原本的配置可以不动，但是需要固定Mac地址并禁用ModemManger。</p><p>因为NetworkManager一旦安装就会开始工作。所以我们先创建一个NetworkManager的配置文件来固定Mac地址，防止我们后续操作重启时候，树莓派的Mac地址频繁变更。</p><p>预编写NetworkManager的配置：</p><p>创建配置目录和文件</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>sudo mkdir -p /etc/NetworkManager/conf.d/</span></span></code></pre></div><p>对文件追加内容</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>sudo nano /etc/NetworkManager/conf.d/100-disable-wifi-mac-randomization.conf</span></span></code></pre></div><p>追加的内容：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>[connection]</span></span>
<span class="line"><span>wifi.mac-address-randomization=1</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[device]</span></span>
<span class="line"><span>wifi.scan-rand-mac-address=no</span></span></code></pre></div><p>之后就可以安装network-manager了：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>sudo apt install -y network-manager</span></span></code></pre></div><p>之后，需要禁用ModeManager：</p><p>停止ModemManager</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>sudo systemctl stop ModemManager</span></span></code></pre></div><p>禁止ModemManager开机自启</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>sudo systemctl disable ModemManager</span></span></code></pre></div><p>到此，NetworkManager部分就准备好了。</p><h4 id="安装依赖" tabindex="-1">安装依赖 <a class="header-anchor" href="#安装依赖" aria-label="Permalink to &quot;安装依赖&quot;">​</a></h4><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apparmor</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jq</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> udisks2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libglib2.0-bin</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> network-manager</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dbus</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemd-journal-remote</span></span></code></pre></div><p>但是需要注意，需要把apparmor的启动配置参数加到树莓派的启动参数内（参考自：<a href="https://github.com/Kanga-Who/home-assistant/issues/25%EF%BC%89%EF%BC%9A" target="_blank" rel="noreferrer">https://github.com/Kanga-Who/home-assistant/issues/25）：</a> add <code>apparmor=1 security=apparmor</code> to <code>/boot/cmdline.txt</code></p><h4 id="安装-docker-ce" tabindex="-1">安装 Docker-CE <a class="header-anchor" href="#安装-docker-ce" aria-label="Permalink to &quot;安装 Docker-CE&quot;">​</a></h4><p>安装 Docker-CE (Community Edition)。Docker CE (Community Edition) is the only supported containerization method for Home Assistant Supervised.</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -fsSL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://get.docker.com</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get-docker.sh</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get-docker.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --mirror</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Aliyun</span></span></code></pre></div><p>把我们自带的用户添加到docker用户组内：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>sudo usermod -aG docker pi</span></span></code></pre></div><h4 id="安装-os-agent" tabindex="-1">安装 OS Agent <a class="header-anchor" href="#安装-os-agent" aria-label="Permalink to &quot;安装 OS Agent&quot;">​</a></h4><p>安装 <a href="https://github.com/home-assistant/os-agent/tree/main#using-home-assistant-supervised-on-debian" target="_blank" rel="noreferrer">OS-Agent</a>。从 [GitHub Release](<a href="https://github.com/home-assistant/os-agent/releases/latest" target="_blank" rel="noreferrer">https://github.com/home-assistant/os-agent/releases/latest</a> 下载最新的 OS Agent Debian package (linux_aarch64)，并安装</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dpkg</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> os-agent_1.4.1_linux_aarch64.deb</span></span></code></pre></div><blockquote><p><code>uname -a</code> 查看当前树莓派架构，树莓派4B为 ARM v8 指令集</p></blockquote><p>You can test if the installation was successful by running:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gdbus</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> introspect</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --system</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --dest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> io.hass.os</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --object-path</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /io/hass/os</span></span></code></pre></div><blockquote><p>You might need to install <code>libglib2.0-bin</code> to get the <code>gdbus</code> command. 出现以下内容</p></blockquote><details><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">node</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /io/hass/os</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  interface</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> org.freedesktop.DBus.Introspectable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    methods:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      Introspect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> out</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    signals:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    properties:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  }</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  interface</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> org.freedesktop.DBus.Properties</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    methods:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      Get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(in  s interface,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          in </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> property,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      GetAll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(in  s interface,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">             out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a{sv}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> props</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      Set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(in  s interface,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          in </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> property,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          in </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    signals:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      PropertiesChanged</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> interface,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        a{sv}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> changed_properties,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                        as</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> invalidates_properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    properties:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  }</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  interface</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> io.hass.os</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    methods:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    signals:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    properties:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      @org.freedesktop.DBus.Property.EmitsChangedSignal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;invalidates&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      readonly</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Version</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;1.4.1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      @org.freedesktop.DBus.Property.EmitsChangedSignal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;true&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      readwrite</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> b</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Diagnostics</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  }</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span></code></pre></div></details><h4 id="安装-supervised" tabindex="-1">安装 Supervised <a class="header-anchor" href="#安装-supervised" aria-label="Permalink to &quot;安装 Supervised&quot;">​</a></h4><p>安装 Home Assistant Supervised Debian Package</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://github.com/home-assistant/supervised-installer/releases/latest/download/homeassistant-supervised.deb</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dpkg</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> homeassistant-supervised.deb</span></span></code></pre></div><blockquote><p><code>homeassistant-supervised.deb</code> 需要科学上网</p></blockquote><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[info] Restarting NetworkManager</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[info] Enable systemd-resolved</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[info] Enable systemd-journal-gatewayd</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[info] Restarting docker service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PING</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> checkonline.home-assistant.io</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (172.67.68.90) 56(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">84</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) bytes of data.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">64</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bytes</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 172.67.68.90:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> icmp_seq=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ttl=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">46</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">101</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ms</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">---</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> checkonline.home-assistant.io</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ping</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> statistics</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> packets</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> transmitted,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> received,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0%</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> packet</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> loss,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rtt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> min/avg/max/mdev</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 100.631/100.631/100.631/0.000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ms</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[info] Install supervisor startup scripts</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[info] Install AppArmor scripts</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[info] Start Home Assistant Supervised</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[info] Installing the </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ha&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cli</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[warn] Could not find /etc/default/grub or /boot/firmware/cmdline.txt failed to switch to cgroup v1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[info] Within a few minutes you will be able to reach Home Assistant at:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[info] http://homeassistant.local:8123 or using the IP address of your</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[info] machine: http://192.168.1.7:8123</span></span></code></pre></div><p>等待一会儿就可以<a href="#访问-home-assistant">访问 Home Assistant</a></p><p>安装后 <code>raspberrypi.local</code> 会失效</p><p><strong>查看安装日志</strong></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">journalctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span></span></code></pre></div><p>查看Docker容器数量，完全装完好像是8个</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ps</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [OPTIONS]</span></span></code></pre></div><p>查看状态 docker logs -f hassio_supervisor</p><h3 id="访问-home-assistant" tabindex="-1">访问 Home Assistant <a class="header-anchor" href="#访问-home-assistant" aria-label="Permalink to &quot;访问 Home Assistant&quot;">​</a></h3><p>通过 <code>http://&lt;raspberry-ip&gt;:8123</code> 访问</p><ul><li>homeassistant.local:8123</li><li>raspberrypi.local:8123</li><li></li></ul><p><a href="http://192.168.1.7:8123" target="_blank" rel="noreferrer">http://192.168.1.7:8123</a></p><p>安装后 homeassistant 的目录为 <code>/usr/share/hassio/homeassistant/</code></p><h2 id="hacs-插件安装" tabindex="-1">HACS 插件安装 <a class="header-anchor" href="#hacs-插件安装" aria-label="Permalink to &quot;HACS 插件安装&quot;">​</a></h2><p>Github 上 <a href="https://github.com/hacs/integration" target="_blank" rel="noreferrer">HACS</a></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://get.hacs.xyz</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bash</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">INFO:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Creating</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HACS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> directory...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">INFO:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Unpacking</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HACS...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">INFO:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Removing</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HACS</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> file...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">INFO:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Installation</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> complete.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">INFO:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Remember</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Home</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Assistant</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> before</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> you</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> configure</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> it</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> homeassistant</span></span></code></pre></div><p>打开高级设置确保可以安装HACS <img src="/assets/hacs-install-setting.DBgudP9D.png" alt="打开高级设置"></p><p>配置 -&gt; 通用 -&gt; 服务控制 -&gt; 服务管理 -&gt; 重新启动</p><p>如果无效则需要在树莓派终端重启docker</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span></span></code></pre></div><p>按照 <a href="https://hacs.xyz/docs/configuration/basic" target="_blank" rel="noreferrer">https://hacs.xyz/docs/configuration/basic</a> 设置 HACS</p><h2 id="在-hacs-中安装-mi-miot" tabindex="-1">在 HACS 中安装 Mi MioT <a class="header-anchor" href="#在-hacs-中安装-mi-miot" aria-label="Permalink to &quot;在 HACS 中安装 Mi MioT&quot;">​</a></h2><p><a href="https://gitee.com/al-one/hass-xiaomi-miot" target="_blank" rel="noreferrer">https://gitee.com/al-one/hass-xiaomi-miot</a></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -q</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://raw.githubusercontent.com/al-one/hass-xiaomi-miot/master/install.sh</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ARCHIVE_TAG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">latest</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bash</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果遇到下载缓慢或下载失败可以执行下面的命令</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -q</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://ghproxy.com/raw.githubusercontent.com/al-one/hass-xiaomi-miot/master/install.sh</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> HUB_DOMAIN=ghproxy.com/github.com</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ARCHIVE_TAG=latest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bash</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 或者</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -q</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://raw.fastgit.org/al-one/hass-xiaomi-miot/master/install.sh</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HUB_DOMAIN</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">hub.fastgit.xyz</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ARCHIVE_TAG</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">latest</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bash</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span></span></code></pre></div><h2 id="添加米家设备" tabindex="-1">添加米家设备 <a class="header-anchor" href="#添加米家设备" aria-label="Permalink to &quot;添加米家设备&quot;">​</a></h2><h2 id="添加到-homekit-中" tabindex="-1">添加到 Homekit 中 <a class="header-anchor" href="#添加到-homekit-中" aria-label="Permalink to &quot;添加到 Homekit 中&quot;">​</a></h2><h2 id="主题" tabindex="-1">主题 <a class="header-anchor" href="#主题" aria-label="Permalink to &quot;主题&quot;">​</a></h2><p>设置主题之前，需要修改 <code>homeassistant</code> 目录下的 <code>configuration.yaml</code> 文件，然后重启 homeassistant (docker 安装方式为 <code>/usr/share/hassio/homeassistant/configuration.yaml</code>)</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Loads default set of integrations. Do not remove.</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">default_config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Text to speech</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">tts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">platform</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">google_translate</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 添加下面两行配置，第二行最前面是两个空格</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">frontend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  themes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!include_dir_merge_named</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> themes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">automation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> automations.yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scripts.yaml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">scene</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scenes.yaml</span></span></code></pre></div><p>themes/ios-themes/ios-themes.yaml</p><p>Mushroom 卡片： <a href="https://github.com/piitaya/lovelace-mushroom" target="_blank" rel="noreferrer">piitaya/lovelace-mushroom</a> 在 HACS 内的前端选项，搜索 Mushroom 即可</p><p>参考： <a href="https://www.bilibili.com/read/cv15938967" target="_blank" rel="noreferrer">https://www.bilibili.com/read/cv15938967</a></p></div></div></main><footer class="VPDocFooter" data-v-657d647b data-v-6a79f00e><!--[--><!--]--><div class="edit-info" data-v-6a79f00e><!----><div class="last-updated" data-v-6a79f00e><p class="VPLastUpdated" data-v-6a79f00e data-v-9f8adae7>最后更新于: <time datetime="2024-05-10T07:33:30.000Z" data-v-9f8adae7></time></p></div></div><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter" data-v-b1bb354a data-v-3430671b><div class="container" data-v-3430671b><p class="message" data-v-3430671b>Powered By <a href="https://vitepress.dev/">Vitepress</a></p><p class="copyright" data-v-3430671b>All rights reserved © 2024-2024 <a href="https://github.com/HenryZhuHR?tab=repositories">HenryZhuHR</a></p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"hardware_raspberrypi_icm20602.md\":\"Chb63wtX\",\"index.md\":\"D2lgvj3q\",\"api-examples.md\":\"V6xFafvu\",\"hardware_raspberrypi_homeassistant-zhihu.md\":\"BAM_9FEs\",\"hardware_raspberrypi_raspberrypi.md\":\"CRKpOul9\",\"markdown-examples.md\":\"Bt0XMIpu\",\"program_github_github.md\":\"Bj8SDzaj\",\"program_linux_basic_linux-file_system.md\":\"DljU3MRO\",\"program_linux_basic_实验2 makefile实验.md\":\"COu_7D0Q\",\"hardware_raspberrypi_openwrt.md\":\"d9mHgN3d\",\"hardware_raspberrypi_homeassistant.md\":\"D1quv1M3\",\"program_git_git-zhihu.md\":\"6zYj9HAt\",\"program_git_git.md\":\"DTXiCYzh\",\"program_linux_basic_basic.md\":\"BQxWpkwa\",\"program_linux_basic_linux-basic.md\":\"ByUSfdMJ\",\"program_linux_command_cp.md\":\"rEBsKhf0\",\"program_linux_frp_frp.md\":\"Dlt6iy3H\",\"program_linux_tmux_tmux.md\":\"CekOUDxk\",\"program_linux_vim_vim.md\":\"Df9VMxBm\",\"program_ssh_ssh.md\":\"BzRFAgfm\",\"program_linux_basic_实验1 linux.md\":\"ai1hCDKv\",\"program_linux_ubuntu_ubuntu.md\":\"Dy-3C27p\",\"program_linux_linux.md\":\"BNJXFVIQ\",\"program_linux_linux-ubuntu.md\":\"CWoINCjH\",\"program_conda_conda.md\":\"DXTv1tVW\",\"program_git_command.md\":\"BRYTzIG7\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"HenryZhu's xyz\",\"description\":\"个人站点\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/HenryZhuHR\"}],\"externalLinkIcon\":true,\"footer\":{\"message\":\"Powered By <a href=\\\"https://vitepress.dev/\\\">Vitepress</a>\",\"copyright\":\"All rights reserved © 2024-2024 <a href=\\\"https://github.com/HenryZhuHR?tab=repositories\\\">HenryZhuHR</a>\"},\"outline\":{\"label\":\"页面导航\"},\"lastUpdated\":{\"text\":\"最后更新于\",\"formatOptions\":{\"dateStyle\":\"short\",\"timeStyle\":\"medium\"}},\"langMenuLabel\":\"多语言\",\"returnToTopLabel\":\"回到顶部\",\"sidebarMenuLabel\":\"文档导航\",\"darkModeSwitchLabel\":\"深色模式开关\",\"lightModeSwitchTitle\":\"切换到浅色模式\",\"darkModeSwitchTitle\":\"切换到深色模式\"},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>