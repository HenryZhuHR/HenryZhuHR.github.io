<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.49">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" type="image/png" sizes="32x32" href="/images/global/avatar-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/global/avatar-16x16.png"><meta name="application-name" content="Henry Zhu"><meta name="apple-mobile-web-app-title" content="Henry Zhu"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="apple-touch-icon" href="/images/global/avatar.png"><meta name="theme-color" content="#377bb5"><meta name="msapplication-TileColor" content="#377bb5"><title>FreeRTOS | Henry Zhu</title><meta name="description" content="">
    <link rel="modulepreload" href="/assets/app.e2a6bb87.js"><link rel="modulepreload" href="/assets/freertos.html.8e6d8054.js"><link rel="modulepreload" href="/assets/freertos.html.5c138d73.js"><link rel="prefetch" href="/assets/offer.html.df936bb7.js"><link rel="prefetch" href="/assets/resume.html.f7bb4442.js"><link rel="prefetch" href="/assets/deeplearning.html.912fadc7.js"><link rel="prefetch" href="/assets/about.html.1e2becfa.js"><link rel="prefetch" href="/assets/index.html.b6d87e98.js"><link rel="prefetch" href="/assets/cpu.html.1fe8dd9e.js"><link rel="prefetch" href="/assets/process.html.ceec3b98.js"><link rel="prefetch" href="/assets/mysql.html.4dcfd0d8.js"><link rel="prefetch" href="/assets/obsidian.html.f88c5bec.js"><link rel="prefetch" href="/assets/DiffusionModel.html.994a8cc3.js"><link rel="prefetch" href="/assets/index.html.64d46029.js"><link rel="prefetch" href="/assets/basic.html.4eae7658.js"><link rel="prefetch" href="/assets/classification.html.6af1adf1.js"><link rel="prefetch" href="/assets/classifier.html.2f5932c6.js"><link rel="prefetch" href="/assets/cnn.html.d721c89f.js"><link rel="prefetch" href="/assets/gan.html.0b7522e8.js"><link rel="prefetch" href="/assets/FaceAssign.html.547a928d.js"><link rel="prefetch" href="/assets/Initialization.html.f42fd297.js"><link rel="prefetch" href="/assets/MetricLearning.html.1ec6b598.js"><link rel="prefetch" href="/assets/ema.html.a3ade3eb.js"><link rel="prefetch" href="/assets/mlp.html.d35da666.js"><link rel="prefetch" href="/assets/nlp.html.b191e903.js"><link rel="prefetch" href="/assets/norm.html.52311e88.js"><link rel="prefetch" href="/assets/object_dection.html.6e439e2c.js"><link rel="prefetch" href="/assets/fine_tune.html.cb6d89e6.js"><link rel="prefetch" href="/assets/pytorch-install.html.c94377e6.js"><link rel="prefetch" href="/assets/train.html.e4124028.js"><link rel="prefetch" href="/assets/transformer.html.5383695d.js"><link rel="prefetch" href="/assets/index.html.2b9d0e8f.js"><link rel="prefetch" href="/assets/对抗纹理.html.58078046.js"><link rel="prefetch" href="/assets/2019ICML_Zhang_TRADES.html.78ee293b.js"><link rel="prefetch" href="/assets/2019_Shafahi_LS.html.7388e530.js"><link rel="prefetch" href="/assets/2020ICML_Rice_RobustOverfitting.html.ba364817.js"><link rel="prefetch" href="/assets/2020NIPS_Pang_HE.html.472aa544.js"><link rel="prefetch" href="/assets/2021CVPR_Luo_Diffusion3DPointCloud.html.7938f0f8.js"><link rel="prefetch" href="/assets/2021ICML_radford_CLIP.html.70b8c04d.js"><link rel="prefetch" href="/assets/AdversarialTraining.html.4935c3b0.js"><link rel="prefetch" href="/assets/StyleGAN2.html.b1b68b00.js"><link rel="prefetch" href="/assets/latex.html.90635eb9.js"><link rel="prefetch" href="/assets/backtracking.html.6f341901.js"><link rel="prefetch" href="/assets/dp.html.f2f0487e.js"><link rel="prefetch" href="/assets/monotonic_stack.html.4d866b4f.js"><link rel="prefetch" href="/assets/wuhan23_sunset.html.d4c65045.js"><link rel="prefetch" href="/assets/多卡训练.html.56ebb72c.js"><link rel="prefetch" href="/assets/index.html.4addc43b.js"><link rel="prefetch" href="/assets/conda.html.ea4491e8.js"><link rel="prefetch" href="/assets/CXX.html.4c59db51.js"><link rel="prefetch" href="/assets/deploy.html.432f1f8e.js"><link rel="prefetch" href="/assets/mAP.html.16e8ac3f.js"><link rel="prefetch" href="/assets/design_pattern.html.a28a07d3.js"><link rel="prefetch" href="/assets/command.html.4dce3d49.js"><link rel="prefetch" href="/assets/git-zhihu.html.1707fc79.js"><link rel="prefetch" href="/assets/git.html.9b3ee30f.js"><link rel="prefetch" href="/assets/github.html.8c083bd9.js"><link rel="prefetch" href="/assets/http.html.b2667ce9.js"><link rel="prefetch" href="/assets/linux-ubuntu.html.b36c026a.js"><link rel="prefetch" href="/assets/linux.html.33aee037.js"><link rel="prefetch" href="/assets/macos.html.a0f8b6ca.js"><link rel="prefetch" href="/assets/mosquitto.html.7d3ab270.js"><link rel="prefetch" href="/assets/index.html.5e6b04ca.js"><link rel="prefetch" href="/assets/openvino.html.4fceed65.js"><link rel="prefetch" href="/assets/list.html.d6036b5f.js"><link rel="prefetch" href="/assets/python.html.9826fb66.js"><link rel="prefetch" href="/assets/OpenWRT.html.e26b2f68.js"><link rel="prefetch" href="/assets/homeAssistant-zhihu.html.177a50b1.js"><link rel="prefetch" href="/assets/homeAssistant.html.bd5d729c.js"><link rel="prefetch" href="/assets/icm20602.html.bd352ef8.js"><link rel="prefetch" href="/assets/raspberrypi.html.30d346d0.js"><link rel="prefetch" href="/assets/server.html.89127fdd.js"><link rel="prefetch" href="/assets/ros2.html.18a26329.js"><link rel="prefetch" href="/assets/rtmp.html.c8ea9db7.js"><link rel="prefetch" href="/assets/ssh.html.9dde9202.js"><link rel="prefetch" href="/assets/Vue-init.html.2eb3cf3e.js"><link rel="prefetch" href="/assets/index.html.cc33b72e.js"><link rel="prefetch" href="/assets/CodiMD.html.589db885.js"><link rel="prefetch" href="/assets/PromptEngineering.html.77c39590.js"><link rel="prefetch" href="/assets/QQ-GPT.html.8f31f0c8.js"><link rel="prefetch" href="/assets/utm串口挂载.html.cac09dc5.js"><link rel="prefetch" href="/assets/BlenderPython.html.071e0eb9.js"><link rel="prefetch" href="/assets/ContentAuthoring-vehicles.html.d5caadd9.js"><link rel="prefetch" href="/assets/apis.html.f9348ec0.js"><link rel="prefetch" href="/assets/carla-zhihu.html.582531f0.js"><link rel="prefetch" href="/assets/carla.html.6073e636.js"><link rel="prefetch" href="/assets/python-api.html.03da0082.js"><link rel="prefetch" href="/assets/retrieve_data.html.82afe08b.js"><link rel="prefetch" href="/assets/clash.html.0a63b049.js"><link rel="prefetch" href="/assets/pytorch3d.html.82de2770.js"><link rel="prefetch" href="/assets/vscode.html.62b5c605.js"><link rel="prefetch" href="/assets/start.html.5d82315f.js"><link rel="prefetch" href="/assets/dataset.html.dc2ad9f1.js"><link rel="prefetch" href="/assets/index.html.8bb260a7.js"><link rel="prefetch" href="/assets/diffusion_attack.html.ab4ca83e.js"><link rel="prefetch" href="/assets/cuda_cudnn.html.e9e14950.js"><link rel="prefetch" href="/assets/TensorRT.legacy.html.1bacb8fd.js"><link rel="prefetch" href="/assets/TensorRT.html.394e181c.js"><link rel="prefetch" href="/assets/cuda.html.b02c75b1.js"><link rel="prefetch" href="/assets/index.html.e696ffaf.js"><link rel="prefetch" href="/assets/JetsonXavierNX-zhihu.html.295219eb.js"><link rel="prefetch" href="/assets/jetson_xavier.html.ab49eb44.js"><link rel="prefetch" href="/assets/basic.html.5f2eba05.js"><link rel="prefetch" href="/assets/cmake.html.772f1c49.js"><link rel="prefetch" href="/assets/cxx11.html.f2a42b0f.js"><link rel="prefetch" href="/assets/hash_table.html.7c65b17a.js"><link rel="prefetch" href="/assets/tree.html.d33e294c.js"><link rel="prefetch" href="/assets/generics.html.764662d5.js"><link rel="prefetch" href="/assets/lambda.html.2940b2e0.js"><link rel="prefetch" href="/assets/rvalue.html.3cc1f080.js"><link rel="prefetch" href="/assets/safety_efficiency.html.0c07834f.js"><link rel="prefetch" href="/assets/smart_ptr.html.2b39e074.js"><link rel="prefetch" href="/assets/std_cincout.html.c626d036.js"><link rel="prefetch" href="/assets/stl.html.e78e9f0c.js"><link rel="prefetch" href="/assets/thread.html.46d79fc0.js"><link rel="prefetch" href="/assets/trick.html.d7e22552.js"><link rel="prefetch" href="/assets/java-env.html.53a572d4.js"><link rel="prefetch" href="/assets/basic.html.58840ade.js"><link rel="prefetch" href="/assets/linux-basic.html.2e1926d3.js"><link rel="prefetch" href="/assets/linux-file_system.html.edefa040.js"><link rel="prefetch" href="/assets/实验1 Linux.html.edabd78d.js"><link rel="prefetch" href="/assets/实验2 Makefile实验.html.68e8387d.js"><link rel="prefetch" href="/assets/cp.html.1bfc0291.js"><link rel="prefetch" href="/assets/frp.html.fee6dac9.js"><link rel="prefetch" href="/assets/tmux.html.da4d7637.js"><link rel="prefetch" href="/assets/ubuntu.html.d1c054a7.js"><link rel="prefetch" href="/assets/vim.html.6fe7ddf3.js"><link rel="prefetch" href="/assets/iterator.html.5db031c5.js"><link rel="prefetch" href="/assets/list.html.65f8b187.js"><link rel="prefetch" href="/assets/icm20602.html.3e087edd.js"><link rel="prefetch" href="/assets/404.html.7d858b3d.js"><link rel="prefetch" href="/assets/index.html.de26035a.js"><link rel="prefetch" href="/assets/index.html.4a704eac.js"><link rel="prefetch" href="/assets/index.html.aa248416.js"><link rel="prefetch" href="/assets/index.html.e17824b6.js"><link rel="prefetch" href="/assets/index.html.fb4e8b68.js"><link rel="prefetch" href="/assets/index.html.a04dd3d3.js"><link rel="prefetch" href="/assets/index.html.ff009d80.js"><link rel="prefetch" href="/assets/index.html.bf8f59c9.js"><link rel="prefetch" href="/assets/index.html.d96055c1.js"><link rel="prefetch" href="/assets/index.html.2126153c.js"><link rel="prefetch" href="/assets/index.html.f45aae34.js"><link rel="prefetch" href="/assets/index.html.7f48a75e.js"><link rel="prefetch" href="/assets/index.html.07f86cc2.js"><link rel="prefetch" href="/assets/index.html.cf475022.js"><link rel="prefetch" href="/assets/index.html.881f858e.js"><link rel="prefetch" href="/assets/index.html.efd3a267.js"><link rel="prefetch" href="/assets/index.html.8111aed0.js"><link rel="prefetch" href="/assets/index.html.76958b33.js"><link rel="prefetch" href="/assets/index.html.a4fddea4.js"><link rel="prefetch" href="/assets/index.html.f7d705bb.js"><link rel="prefetch" href="/assets/index.html.f55a68b7.js"><link rel="prefetch" href="/assets/index.html.7f012b50.js"><link rel="prefetch" href="/assets/index.html.c0ba8663.js"><link rel="prefetch" href="/assets/index.html.78a29513.js"><link rel="prefetch" href="/assets/index.html.fb327772.js"><link rel="prefetch" href="/assets/index.html.bbc9b385.js"><link rel="prefetch" href="/assets/index.html.ea22432c.js"><link rel="prefetch" href="/assets/index.html.140ed163.js"><link rel="prefetch" href="/assets/index.html.503474a9.js"><link rel="prefetch" href="/assets/index.html.deae5fb3.js"><link rel="prefetch" href="/assets/offer.html.ff9b1926.js"><link rel="prefetch" href="/assets/resume.html.33ad998c.js"><link rel="prefetch" href="/assets/deeplearning.html.916e4670.js"><link rel="prefetch" href="/assets/about.html.3a0cef4b.js"><link rel="prefetch" href="/assets/index.html.0ba4be57.js"><link rel="prefetch" href="/assets/cpu.html.0eb453d0.js"><link rel="prefetch" href="/assets/process.html.a9d54a52.js"><link rel="prefetch" href="/assets/mysql.html.9b06278e.js"><link rel="prefetch" href="/assets/obsidian.html.484cd36e.js"><link rel="prefetch" href="/assets/DiffusionModel.html.51e48802.js"><link rel="prefetch" href="/assets/index.html.8150c453.js"><link rel="prefetch" href="/assets/basic.html.0599d6c7.js"><link rel="prefetch" href="/assets/classification.html.eb661d62.js"><link rel="prefetch" href="/assets/classifier.html.2f8e596a.js"><link rel="prefetch" href="/assets/cnn.html.e96ca693.js"><link rel="prefetch" href="/assets/gan.html.2779a2f6.js"><link rel="prefetch" href="/assets/FaceAssign.html.c4980493.js"><link rel="prefetch" href="/assets/Initialization.html.3f72863c.js"><link rel="prefetch" href="/assets/MetricLearning.html.b1245523.js"><link rel="prefetch" href="/assets/ema.html.0b9005a0.js"><link rel="prefetch" href="/assets/mlp.html.bb558cc6.js"><link rel="prefetch" href="/assets/nlp.html.9e7d231b.js"><link rel="prefetch" href="/assets/norm.html.4430c082.js"><link rel="prefetch" href="/assets/object_dection.html.9dfa3aec.js"><link rel="prefetch" href="/assets/fine_tune.html.a2f4e93b.js"><link rel="prefetch" href="/assets/pytorch-install.html.8c45f3cd.js"><link rel="prefetch" href="/assets/train.html.927381a1.js"><link rel="prefetch" href="/assets/transformer.html.5af99d6c.js"><link rel="prefetch" href="/assets/index.html.89a3efab.js"><link rel="prefetch" href="/assets/对抗纹理.html.8cc235f8.js"><link rel="prefetch" href="/assets/2019ICML_Zhang_TRADES.html.28bdde51.js"><link rel="prefetch" href="/assets/2019_Shafahi_LS.html.f9ba8a17.js"><link rel="prefetch" href="/assets/2020ICML_Rice_RobustOverfitting.html.9d9dab14.js"><link rel="prefetch" href="/assets/2020NIPS_Pang_HE.html.d991366b.js"><link rel="prefetch" href="/assets/2021CVPR_Luo_Diffusion3DPointCloud.html.56aa984f.js"><link rel="prefetch" href="/assets/2021ICML_radford_CLIP.html.cb6a2a5b.js"><link rel="prefetch" href="/assets/AdversarialTraining.html.41f011e0.js"><link rel="prefetch" href="/assets/StyleGAN2.html.9bc10f1c.js"><link rel="prefetch" href="/assets/latex.html.6d8eebeb.js"><link rel="prefetch" href="/assets/backtracking.html.513a76ec.js"><link rel="prefetch" href="/assets/dp.html.494f9878.js"><link rel="prefetch" href="/assets/monotonic_stack.html.add5e854.js"><link rel="prefetch" href="/assets/wuhan23_sunset.html.fc258c63.js"><link rel="prefetch" href="/assets/多卡训练.html.4c8e589a.js"><link rel="prefetch" href="/assets/index.html.6a5ed9fa.js"><link rel="prefetch" href="/assets/conda.html.eb241059.js"><link rel="prefetch" href="/assets/CXX.html.10ab9b31.js"><link rel="prefetch" href="/assets/deploy.html.f2e1c53f.js"><link rel="prefetch" href="/assets/mAP.html.a4830371.js"><link rel="prefetch" href="/assets/design_pattern.html.af8253f9.js"><link rel="prefetch" href="/assets/command.html.95771a02.js"><link rel="prefetch" href="/assets/git-zhihu.html.81819e33.js"><link rel="prefetch" href="/assets/git.html.4706fb77.js"><link rel="prefetch" href="/assets/github.html.0c764380.js"><link rel="prefetch" href="/assets/http.html.315590dc.js"><link rel="prefetch" href="/assets/linux-ubuntu.html.9e511335.js"><link rel="prefetch" href="/assets/linux.html.872d0998.js"><link rel="prefetch" href="/assets/macos.html.64ef826c.js"><link rel="prefetch" href="/assets/mosquitto.html.1de18add.js"><link rel="prefetch" href="/assets/index.html.589071eb.js"><link rel="prefetch" href="/assets/openvino.html.eca69b51.js"><link rel="prefetch" href="/assets/list.html.8c6c9d6b.js"><link rel="prefetch" href="/assets/python.html.f9ba2225.js"><link rel="prefetch" href="/assets/OpenWRT.html.2986b654.js"><link rel="prefetch" href="/assets/homeAssistant-zhihu.html.ed8e4b69.js"><link rel="prefetch" href="/assets/homeAssistant.html.ea1ee46f.js"><link rel="prefetch" href="/assets/icm20602.html.9f687a37.js"><link rel="prefetch" href="/assets/raspberrypi.html.021e2a37.js"><link rel="prefetch" href="/assets/server.html.d03beb8a.js"><link rel="prefetch" href="/assets/ros2.html.7a788426.js"><link rel="prefetch" href="/assets/rtmp.html.5729e3de.js"><link rel="prefetch" href="/assets/ssh.html.49d8f0a3.js"><link rel="prefetch" href="/assets/Vue-init.html.a7944208.js"><link rel="prefetch" href="/assets/index.html.dd184f3b.js"><link rel="prefetch" href="/assets/CodiMD.html.91815fce.js"><link rel="prefetch" href="/assets/PromptEngineering.html.4a540894.js"><link rel="prefetch" href="/assets/QQ-GPT.html.132edc13.js"><link rel="prefetch" href="/assets/utm串口挂载.html.5a6dd758.js"><link rel="prefetch" href="/assets/BlenderPython.html.07992b3f.js"><link rel="prefetch" href="/assets/ContentAuthoring-vehicles.html.5ebe06be.js"><link rel="prefetch" href="/assets/apis.html.d696b5f0.js"><link rel="prefetch" href="/assets/carla-zhihu.html.be4dc108.js"><link rel="prefetch" href="/assets/carla.html.858323b9.js"><link rel="prefetch" href="/assets/python-api.html.18f282d1.js"><link rel="prefetch" href="/assets/retrieve_data.html.582e301d.js"><link rel="prefetch" href="/assets/clash.html.c67b2826.js"><link rel="prefetch" href="/assets/pytorch3d.html.5a795719.js"><link rel="prefetch" href="/assets/vscode.html.9b1ffcac.js"><link rel="prefetch" href="/assets/start.html.b835c286.js"><link rel="prefetch" href="/assets/dataset.html.6f0d8294.js"><link rel="prefetch" href="/assets/index.html.949ab12f.js"><link rel="prefetch" href="/assets/diffusion_attack.html.29de8087.js"><link rel="prefetch" href="/assets/cuda_cudnn.html.f5cc355d.js"><link rel="prefetch" href="/assets/TensorRT.legacy.html.a76805a3.js"><link rel="prefetch" href="/assets/TensorRT.html.ba22a425.js"><link rel="prefetch" href="/assets/cuda.html.0488f309.js"><link rel="prefetch" href="/assets/index.html.9bbc9453.js"><link rel="prefetch" href="/assets/JetsonXavierNX-zhihu.html.d5378e3e.js"><link rel="prefetch" href="/assets/jetson_xavier.html.2412768c.js"><link rel="prefetch" href="/assets/basic.html.3f8cc93d.js"><link rel="prefetch" href="/assets/cmake.html.40db936e.js"><link rel="prefetch" href="/assets/cxx11.html.bb03bba9.js"><link rel="prefetch" href="/assets/hash_table.html.9d5bfbbb.js"><link rel="prefetch" href="/assets/tree.html.cf005b44.js"><link rel="prefetch" href="/assets/generics.html.798f81ee.js"><link rel="prefetch" href="/assets/lambda.html.8e0ffb3c.js"><link rel="prefetch" href="/assets/rvalue.html.fc85ec05.js"><link rel="prefetch" href="/assets/safety_efficiency.html.7fb43c7b.js"><link rel="prefetch" href="/assets/smart_ptr.html.db4d2752.js"><link rel="prefetch" href="/assets/std_cincout.html.3a158269.js"><link rel="prefetch" href="/assets/stl.html.10562152.js"><link rel="prefetch" href="/assets/thread.html.0097da8a.js"><link rel="prefetch" href="/assets/trick.html.2bcd0da9.js"><link rel="prefetch" href="/assets/java-env.html.f87c01ed.js"><link rel="prefetch" href="/assets/basic.html.dfec0091.js"><link rel="prefetch" href="/assets/linux-basic.html.f69a24c1.js"><link rel="prefetch" href="/assets/linux-file_system.html.b65414b5.js"><link rel="prefetch" href="/assets/实验1 Linux.html.f0ec5293.js"><link rel="prefetch" href="/assets/实验2 Makefile实验.html.c6386523.js"><link rel="prefetch" href="/assets/cp.html.90826f40.js"><link rel="prefetch" href="/assets/frp.html.b702f983.js"><link rel="prefetch" href="/assets/tmux.html.0e490e1b.js"><link rel="prefetch" href="/assets/ubuntu.html.be8b3cb6.js"><link rel="prefetch" href="/assets/vim.html.24350952.js"><link rel="prefetch" href="/assets/iterator.html.5f7e746c.js"><link rel="prefetch" href="/assets/list.html.1f38d27e.js"><link rel="prefetch" href="/assets/icm20602.html.4ce3bb2f.js"><link rel="prefetch" href="/assets/404.html.19457a36.js"><link rel="prefetch" href="/assets/index.html.3c6db038.js"><link rel="prefetch" href="/assets/index.html.dfd177c1.js"><link rel="prefetch" href="/assets/index.html.1fefafe7.js"><link rel="prefetch" href="/assets/index.html.3ba861ca.js"><link rel="prefetch" href="/assets/index.html.110f72ae.js"><link rel="prefetch" href="/assets/index.html.2d7ddcf7.js"><link rel="prefetch" href="/assets/index.html.061e6056.js"><link rel="prefetch" href="/assets/index.html.70e8c913.js"><link rel="prefetch" href="/assets/index.html.649a7ed6.js"><link rel="prefetch" href="/assets/index.html.3541f6bb.js"><link rel="prefetch" href="/assets/index.html.e8ea8643.js"><link rel="prefetch" href="/assets/index.html.dc99c5bc.js"><link rel="prefetch" href="/assets/index.html.170cc290.js"><link rel="prefetch" href="/assets/index.html.8e9fb1c8.js"><link rel="prefetch" href="/assets/index.html.5ddf73bd.js"><link rel="prefetch" href="/assets/index.html.9a090320.js"><link rel="prefetch" href="/assets/index.html.2ea925fa.js"><link rel="prefetch" href="/assets/index.html.abc694ac.js"><link rel="prefetch" href="/assets/index.html.29eb2768.js"><link rel="prefetch" href="/assets/index.html.95048c64.js"><link rel="prefetch" href="/assets/index.html.3ce1f8fc.js"><link rel="prefetch" href="/assets/index.html.9475c23e.js"><link rel="prefetch" href="/assets/index.html.05ea4196.js"><link rel="prefetch" href="/assets/index.html.674424db.js"><link rel="prefetch" href="/assets/index.html.135a28c3.js"><link rel="prefetch" href="/assets/index.html.2eeb9f50.js"><link rel="prefetch" href="/assets/index.html.aabe3b99.js"><link rel="prefetch" href="/assets/index.html.3a156cfd.js"><link rel="prefetch" href="/assets/index.html.29d8b8e9.js"><link rel="prefetch" href="/assets/index.html.7be77f13.js"><link rel="prefetch" href="/assets/404.cf2ec252.js"><link rel="prefetch" href="/assets/HomePage.ecf27057.js"><link rel="prefetch" href="/assets/Layout.719a42c1.js"><link rel="prefetch" href="/assets/Links.39dae116.js"><link rel="prefetch" href="/assets/Post.7a480b17.js"><link rel="prefetch" href="/assets/Tags.9be1392a.js">
    <link rel="stylesheet" href="/assets/style.fd106935.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar"><!--[--><header class="navbar invert"><span><a href="/" class=""><span class="site-name">cd Home/主页</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="主页/Home"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0.48 0.48 23.04 23.04" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg></span><span>主页/Home</span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/links/" class="" aria-label="文章分类/Links"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M305.45 462.59c7.391 7.298 6.188 20.097-3 25.004-77.714 41.802-176.726 29.91-242.344-35.709-65.602-65.603-77.51-164.523-35.692-242.331 4.891-9.095 17.69-10.298 25.003-3l116.812 116.813 27.394-27.394c-.688-2.61-1.594-5.001-1.594-7.814a32.004 32.004 0 1132.004 32.005c-2.797 0-5.204-.891-7.798-1.594l-27.41 27.41zm206.526-159.523a16.103 16.103 0 01-16.002 17.003H463.86a15.97 15.97 0 01-15.892-15.002C440.467 175.549 336.453 70.534 207.03 63.533a15.845 15.845 0 01-15.002-15.908V16.027A16.094 16.094 0 01209.03.024C372.255 8.62 503.475 139.841 511.976 303.067zm-96.012-.297a16.21 16.21 0 01-16.112 17.3h-32.207a16.069 16.069 0 01-15.893-14.705c-6.907-77.011-68.118-138.91-144.924-145.224a15.94 15.94 0 01-14.8-15.893v-32.114a16.134 16.134 0 0117.3-16.096c110.123 8.501 198.228 96.607 206.636 206.732z"/></svg></span><span>文章分类/Links</span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/tags/" class="" aria-label="标签/Tags"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg></span><span>标签/Tags</span><!--[--><!--]--></a></div><!--]--><div class="navbar-item"><a style="cursor:pointer;"><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 2c4.968 0 9 4.032 9 9s-4.032 9-9 9-9-4.032-9-9 4.032-9 9-9zm0 16c3.867 0 7-3.133 7-7 0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7zm8.485.071l2.829 2.828-1.415 1.415-2.828-2.829 1.414-1.414z"/></svg></span><span>Search</span></a></div></nav><!--[--><!--]--><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="主页/Home"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0.48 0.48 23.04 23.04" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg></span><span>主页/Home</span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/links/" class="" aria-label="文章分类/Links"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M305.45 462.59c7.391 7.298 6.188 20.097-3 25.004-77.714 41.802-176.726 29.91-242.344-35.709-65.602-65.603-77.51-164.523-35.692-242.331 4.891-9.095 17.69-10.298 25.003-3l116.812 116.813 27.394-27.394c-.688-2.61-1.594-5.001-1.594-7.814a32.004 32.004 0 1132.004 32.005c-2.797 0-5.204-.891-7.798-1.594l-27.41 27.41zm206.526-159.523a16.103 16.103 0 01-16.002 17.003H463.86a15.97 15.97 0 01-15.892-15.002C440.467 175.549 336.453 70.534 207.03 63.533a15.845 15.845 0 01-15.002-15.908V16.027A16.094 16.094 0 01209.03.024C372.255 8.62 503.475 139.841 511.976 303.067zm-96.012-.297a16.21 16.21 0 01-16.112 17.3h-32.207a16.069 16.069 0 01-15.893-14.705c-6.907-77.011-68.118-138.91-144.924-145.224a15.94 15.94 0 01-14.8-15.893v-32.114a16.134 16.134 0 0117.3-16.096c110.123 8.501 198.228 96.607 206.636 206.732z"/></svg></span><span>文章分类/Links</span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/tags/" class="" aria-label="标签/Tags"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg></span><span>标签/Tags</span><!--[--><!--]--></a></div><!--]--><div class="navbar-item"><a style="cursor:pointer;"><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 2c4.968 0 9 4.032 9 9s-4.032 9-9 9-9-4.032-9-9 4.032-9 9-9zm0 16c3.867 0 7-3.133 7-7 0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7zm8.485.071l2.829 2.828-1.415 1.415-2.828-2.829 1.414-1.414z"/></svg></span><span>Search</span></a></div></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><div class="page-content"><!--[--><div class="show-catalog post-wrapper"><div class="article-header use-image post-header" style="background-image:url(/images/backgrounds/Martin-Parker-42.jpg);"><div class="article-header-mask" style="background:rgb(0,0,0, .5);"></div><div class="article-header-content"><div class="article-tags"><!--[--><a href="/tags/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/" class="article-tag">软件开发</a><!--]--></div><h1 class="article-title">FreeRTOS</h1><p class="article-subtitle">FreeRTOS 开发日志</p><div class="article-icons"><div class="article-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M313.6 304c-28.7 0-42.5 16-89.6 16-47.1 0-60.8-16-89.6-16C60.2 304 0 364.2 0 438.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-25.6c0-74.2-60.2-134.4-134.4-134.4zM400 464H48v-25.6c0-47.6 38.8-86.4 86.4-86.4 14.6 0 38.3 16 89.6 16 51.7 0 74.9-16 89.6-16 47.6 0 86.4 38.8 86.4 86.4V464zM224 288c79.5 0 144-64.5 144-144S303.5 0 224 0 80 64.5 80 144s64.5 144 144 144zm0-240c52.9 0 96 43.1 96 96s-43.1 96-96 96-96-43.1-96-96 43.1-96 96-96z"/></svg><span>HenryZhu</span></div><div class="article-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M400 64h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zm-6 400H54c-3.3 0-6-2.7-6-6V160h352v298c0 3.3-2.7 6-6 6z"/></svg><span>2023-10-17</span></div><div class="article-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M17.618 5.968l1.453-1.453 1.414 1.414-1.453 1.453a9 9 0 11-1.414-1.414zM12 20a7 7 0 100-14 7 7 0 000 14zM11 8h2v6h-2V8zM8 1h8v2H8V1z"/></svg><span>34 min</span></div></div></div><!----></div><main class="page post-content"><!--[--><!--]--><div class="theme-gungnir-content"><!--[--><!--]--><div><h1 id="freertos" tabindex="-1"><a class="header-anchor" href="#freertos" aria-hidden="true">#</a> FreeRTOS</h1><h2 id="简介" tabindex="-1"><a class="header-anchor" href="#简介" aria-hidden="true">#</a> 简介</h2><p><a href="https://www.freertos.org/zh-cn-cmn-s/index.html" target="_blank" rel="noopener noreferrer">FreeRTOS</a> 是一个迷你的实时操作系统内核。它是由Richard Barry在2003年基于RTOS内核的开源版本而开发的。</p><p>FreeRTOS 是一个开源的、实时的、小型的操作系统内核，它具有高可移植性，可以在多种微处理器上运行，包括 ARM、AVR、MIPS、PIC、RISC-V 等。FreeRTOS的内核代码只有几个C文件，易于移植。FreeRTOS的内核代码是开源的，可以免费使用，但是FreeRTOS的源代码是不开源的，需要购买。</p><p>FreeRTOS的特点：</p><ul><li><p><strong>实时性</strong>: FreeRTOS 是一个实时操作系统，它可以在严格的时间限制下完成任务。</p></li><li><p><strong>任务数量</strong>: FreeRTOS 可以创建多个任务，每个任务都有自己的优先级，任务可以被挂起，也可以被删除。</p></li><li><p><strong>任务调度</strong>: FreeRTOS 的调度器是抢占式的，它可以根据任务的优先级来调度任务。</p></li><li><p><strong>调度算法</strong>: FreeRTOS 的调度算法是基于优先级的抢占式调度算法。当多于1个任务具有相同的高优先级时，采用round robin算法调度。</p></li><li><p><strong>内存管理</strong>: FreeRTOS 的内存管理是动态的，可以在运行时动态分配内存。</p></li><li><p><strong>可移植性</strong>: FreeRTOS 的内核代码只有几个C文件，易于移植。FreeRTOS的内核代码是开源的，可以免费使用，但是FreeRTOS的源代码是不开源的，需要购买。</p></li><li><p><strong>任务通信</strong>: FreeRTOS 的任务通信方式有：队列、信号量、事件标志组、互斥量、软件定时器、消息邮箱等。</p><ul><li>消息队列：FreeRTOS实现的队列机制传递信息是采用传值方式，因此对于传递大量数据效率有些低。但可以通过传递指针的方式提高效率。中断处理函数中读写队列都是非阻塞型的。任务中读写队列可以为阻塞型也可以配置非阻塞型。当配置为阻塞型时可以指定一个阻塞的最大时间限（Timeout）。</li><li>任务间同步： FreeRTOS 支持基本的信号量功能。FreeRTOS 采用队列来实现信号量的功能，可以认为一个值为n的信号量就是一个长度为n的队列，队列中每个元素的大小为0。这样的队列并不会浪费宝贵的内存空间。</li><li>对于死锁（Deadlock）的处理： FreeRTOS 并没有实现一种可以完全避免死锁的机制。只是通过指定一个阻塞的最大时间限（Timeout）来减少死锁现象的发生。或者说是给出了当死锁现象发生时解锁的可能。当然能不能真的解锁要依赖于使用者的处理代码是否合适。</li><li>临界区： FreeRTOS 采用开关中断的方式实现临界区保护。任务代码中临界区可以嵌套，FreeRTOS 会自动记录每个任务中临界区嵌套的层数。</li><li>暂停调度： 与进入临界区类似，FreeRTOS 可以通过暂时关闭任务调度来保证任务代码不被更高优先级的其他任务打断，与临界区不同，关闭任务调度并不会关闭中断，这样中断处理函数仍会照常的执行。</li><li>内存分配： FreeRTOS 提供了多种内存动态分配的方法，具体程序中需要选择其中一种。最简单的内存分配方式提供了一种非常简单的固定内存分配算法，这种方式下只支持内存的分配，不支持分配内存的回收。因此，任务建立后就不能被删除。其他几种内存分配算法支持分配内存的回收，有的方法支持邻接内存块的合并，有些不支持。对我个人来说，我还是比较欣赏uC/OS-II中内存分配的方法，既保证了实时性，也具有一定的灵活性。FreeRTOS 中提供的几种方式，实时性好的功能上有缺陷，功能上完善的实时性却不好。我通常采用的方式是采用最简单的内存固定分配算法，当需要动态释放时将uC/OS-II中内存分配的代码拿来用。</li></ul></li></ul><h2 id="在-cubmx-上配置-freertos" tabindex="-1"><a class="header-anchor" href="#在-cubmx-上配置-freertos" aria-hidden="true">#</a> 在 CubMX 上配置 FreeRTOS</h2><p>在 Middleware and Software Packs 中选择 FreeRTOS，接口选择 CMSIS V2</p><p><img src="/assets/cubemx-init-rtos.9ff25c62.png" alt=""></p><p>配置部分分别有：</p><ul><li><strong>Mutexes</strong></li><li><strong>Events</strong></li><li><strong>FreeRTOS Heap Usage</strong></li><li><strong>User Constants</strong>: 配置一些常量</li><li><strong>Tasks and Queues</strong></li><li><strong>Timers and Semaphores</strong></li><li><strong>Config parameters</strong></li><li><strong>Include parameters</strong></li><li><strong>Advanced parameters</strong></li></ul><h2 id="freertos-源码结构" tabindex="-1"><a class="header-anchor" href="#freertos-源码结构" aria-hidden="true">#</a> FreeRTOS 源码结构</h2><p>https://www.freertos.org/zh-cn-cmn-s/a00017.html</p><p>开源代码: https://github.com/FreeRTOS/FreeRTOS</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>Middlewares<span class="token punctuation">\</span>Third_Party<span class="token punctuation">\</span>FreeRTOS<span class="token punctuation">\</span>Source
├── CMSIS_RTOS_V2
│   ├── cmsis_os.h
│   ├── cmsis_os2.c
│   └── cmsis_os2.h
├── include
│   ├── FreeRTOS.h
│   ├── event_groups.h
│   ├── list.h
│   ├── portable.h
│   ├── queue.h
│   ├── task.h
│   └── timers.h
│   └── <span class="token punctuation">..</span>.
├── portable
│   ├── GCC
│   │   └── ARM_CM3
│   │       ├── port.c
│   │       └── portmacro.h
│   └── MemMang
│       └── heap_4.c
├── croutine.c
├── event_groups.c
├── list.c
├── queue.c
├── stream_buffer.c
├── tasks.c
└── timers.c
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Source 中的文件都是 FreeRTOS 的核心代码</p><ul><li>CMSIS_RTOS_V2 是 FreeRTOS 的接口层</li><li>portable 是 FreeRTOS 的移植层，这些文件是与具体的处理器相关的，移植时需要根据具体的处理器进行修改。 <ul><li>目录名格式为 <code>&lt;compiler&gt;/&lt;architecture&gt;</code>，例如 <code>GCC</code> 是指使用 GCC 编译器，<code>ARM_CM3</code> 是指使用 ARM Cortex-M3 处理器，这些目录名都是可以修改的</li><li>MemMang 目录中的 <code>heap_4.c</code> 是内存管理的实现，这个文件也是与具体的处理器相关的，移植时需要根据具体的处理器进行修改。</li></ul></li><li>其他的文件都是 FreeRTOS 的核心源码，这些文件是通用的</li></ul><p>核心源码中</p><ul><li><code>tasks.c</code> 是任务的实现（必须，核心）</li><li><code>list.c</code> 是链表的实现（必须，核心）</li><li><code>queue.c</code> 提供队列操作、信号量操作（基本必需）</li><li><code>timers.c</code> 提供软件定时器（可选）</li><li><code>croutine.c</code> 提供协程（可选）</li><li><code>event_groups.c</code> 提供事件标志组（可选）</li><li><code>stream_buffer.c</code> 提供流缓冲区（可选）</li></ul><p>在头文件目录 <code>include</code> 中，最重要的是 <code>FreeRTOS.h</code> ，使用 FreeRTOS API 函数时，必须包含此文件。在FreeRTOS.h之后，再去包含其他头文件，如：<code>task.h</code>、<code>queue.h</code></p><p>在 <code>FreeRTOS/Source/portable/MemMang</code> 下是内存管理相关的文件</p><h2 id="任务" tabindex="-1"><a class="header-anchor" href="#任务" aria-hidden="true">#</a> 任务</h2><blockquote><p>进程是资源分配的最小单位，线程是CPU调度的最小单位</p></blockquote><p>在 FreeRTOS 中，不区分进程和线程，统称为任务 (Task)，每一个任务会对应一个任务控制块 (Task Control Block, TCB) 的结构体为 <code>TCB_t</code>，定义在 <code>FreeRTOS/Source/include/task.h</code> 中</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">tskTaskControlBlock</span> <span class="token punctuation">{</span>
	<span class="token keyword">volatile</span> StackType_t	<span class="token operator">*</span>pxTopOfStack<span class="token punctuation">;</span>
	ListItem_t			xStateListItem<span class="token punctuation">;</span>
	ListItem_t			xEventListItem<span class="token punctuation">;</span>
	UBaseType_t			uxPriority<span class="token punctuation">;</span>
	StackType_t			<span class="token operator">*</span>pxStack<span class="token punctuation">;</span>
	<span class="token keyword">char</span>				pcTaskName<span class="token punctuation">[</span> configMAX_TASK_NAME_LEN <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> tskTCB<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> tskTCB TCB_t<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>pxTopOfStack</code> 指向放置在任务堆栈上的最后一个项目的位置。这必须是TCB结构的第一个成员。</li><li><code>xStateListItem</code> 任务的状态链表。表示任务状态：就绪、阻塞、挂起</li><li><code>xEventListItem</code> 任务的事件链表。表示任务等待的事件</li><li><code>uxPriority</code> 任务的优先级</li><li><code>pxStack</code> 栈起始地址</li><li><code>pcTaskName</code> 任务的名称</li><li>此外，还有一些扩展项，由宏定义控制是否开启</li></ul><h3 id="任务状态" tabindex="-1"><a class="header-anchor" href="#任务状态" aria-hidden="true">#</a> 任务状态</h3><p>任务可以存在于以下状态中：</p><ul><li>「<strong>运行</strong>」当任务实际执行时，它被称为处于运行状态。任务当前正在使用处理器。如果运行 RTOS 的处理器只有一个内核，那么在任何给定时间内都只能有一个任务处于运行状态。</li><li>「<strong>就绪</strong>」准备就绪任务指那些能够执行（它们不处于阻塞或挂起状态），但目前没有执行的任务，因为同等或更高优先级的不同任务已经处于运行状态。</li><li>「<strong>阻塞</strong>」如果任务当前正在等待时间或外部事件，则该任务被认为处于阻塞状态。 <blockquote><p>例如，如果一个任务调用 <code>vTaskDelay()</code>，它将被阻塞（被置于阻塞状态）， 直到延迟结束-一个时间事件。 任务也可以通过阻塞来等待队列、信号量、事件组、通知或信号量事件。 处于阻塞状态的任务通常有一个&quot;超时&quot;期， 超时后任务将被超时，并被解除阻塞， 即使该任务所等待的事件没有发生。“阻塞”状态下的任务不使用任何处理时间，不能 被选择进入运行状态。</p></blockquote></li><li>「<strong>挂起</strong>」与“阻塞”状态下的任务一样， “挂起”状态下的任务不能被选择进入运行状态，但处于挂起状态的任务 没有超时。 相反，任务只有在分别通过 <code>vTaskSuspend()</code> 和 <code>xTaskResume()</code> API 调用明确命令时才会进入或退出挂起状态。</li></ul><p><img src="/assets/task-state.041a544e.svg" alt="任务状态"></p><h3 id="任务优先级" tabindex="-1"><a class="header-anchor" href="#任务优先级" aria-hidden="true">#</a> 任务优先级</h3><p>任务优先级在 <code>FreeRTOSConfig.h</code> 中定义，<code>configMAX_PRIORITIES</code> 定义了最大的优先级数，每个任务均被分配了从 <code>0</code> 到 <code>configMAX_PRIORITIES - 1</code> 的优先级</p><p>如果正在使用的端口实现了端口优化的任务选择机制，该机制使用 “前导零计数”类指令（用于单个指令中的任务选择）且在 <code>FreeRTOSConfig.h</code> 中将 <code>configUSE_PORT_OPTIMISED_TASK_SELECTION</code> 设置为 <code>1</code>，则 <code>configMAX_PRIORITIES</code> 不得大于 <code>32</code>。 在所有其他情况下，<code>configMAX_PRIORITIES</code> 可以采取任何 合理范围内的值，但出于 RAM 使用效率的原因，应保持在 实际需要的最小值。</p><p>低优先级数字表示低优先级任务。 空闲任务的优先级为零 (<code>tskIDLE_PRIORITY</code>)。</p><p>FreeRTOS 调度器可确保在就绪或运行状态的任务将 始终在同样处于就绪状态的较低优先级任务之前获得处理器 (CPU) 时间 。 换句话说，被置于运行状态的任务 始终是可运行的最高优先级任务。</p><p>任意数量的任务可共用相同的优先级。 如果 <code>configUSE_TIME_SLICING</code> 未经定义， 或者如果 <code>configUSE_TIME_SLICING</code> 设置为 <code>1</code>，则相同优先级的就绪状态任务 将使用时间切片轮询调度方案共享可用的处理时间 。</p><h3 id="任务调度" tabindex="-1"><a class="header-anchor" href="#任务调度" aria-hidden="true">#</a> 任务调度</h3><p>FreeRTOS 调度算法，主要针对<strong>单核</strong>、<strong>非对称多核 (AMP)</strong>、和<strong>对称多核 (SMP)</strong> RTOS 配置。调度算法是决定哪个 RTOS 任务应处于运行状态的软件程序。在任何给定时间，每个处理器核心只能有一个任务处于运行状态。</p><p>在 AMP 中， 每个处理器核心运行自身的 FreeRTOS 实例。在 SMP 中， 存在一个 FreeRTOS 实例，可以跨多核调度 RTOS 任务 。</p><h4 id="默认-rtos-调度策略-单核" tabindex="-1"><a class="header-anchor" href="#默认-rtos-调度策略-单核" aria-hidden="true">#</a> 默认 RTOS 调度策略（单核）</h4><p>FreeRTOS 默认使用固定优先级的<strong>抢占式调度</strong>策略，对<strong>同等优先级的任务</strong>执行<strong>时间片轮询调度</strong>：</p><ul><li>「<strong>固定优先级</strong>」是指调度器不会永久更改任务的优先级，尽管它可能会因优先级继承而暂时提高任务的优先级。</li><li>「<strong>抢占式调度</strong>」是指调度器始终运行优先级最高且可运行的 RTOS 任务，无论任务何时能够运行。 <blockquote><p>例如，如果中断服务程序 (ISR) 更改了优先级最高且可运行的任务，调度器会停止当前正在运行的低优先级任务 并启动高优先级任务——即使这发生在同一个时间片内。此时，据说高优先级任务 “抢占”了低优先级任务。</p></blockquote></li><li>「<strong>轮询调度</strong>」是指具有相同优先级的任务轮流进入运行状态。“时间片” 是指调度器会在每个 tick 中断上在同等优先级任务之间进行切换， tick 中断之间的时间构成一个时间片。tick 中断是 RTOS 用来衡量时间的周期性中断。</li></ul><p><strong>使用优先排序的抢占式调度器，避免任务饥饿</strong></p><p>总是运行优先级最高且可运行的任务的后果是，永远不会进入“阻塞”或“挂起”状态的高优先级任务会让所有任意执行时长的低优先级任务永久饥饿。</p><p>这就是为什么通常最好创建事件驱动型任务的原因之一 。例如，如果一个高优先级任务正在等待一个事件， 那么它就不应处于该事件的循环（轮询）中，因为如果处于轮询中，它会一直运行，永远不进入“阻塞”或“挂起”状态。 反之，该任务应进入“阻塞” 状态来等待事件。可以使用众多 FreeRTOS 任务间通信和同步原语之一将事件发送给任务。接收到 事件后， 优先级更高的任务会自动解除“阻塞”状态。高优先级任务处于“阻塞”状态时， 低优先级任务会运行。</p><p><strong>配置 RTOS 调度策略</strong></p><p>以下 <code>FreeRTOSConfig.h</code> 设置更改了默认调度行为：</p><p><code>configUSE_PREEMPTION</code> 如果 <code>configUSE_PREEMPTION</code> 设置为 <code>0</code>，则关闭“抢占”， 只有当运行状态的任务进入“阻塞”或“挂起”状态， 或运行状态任务调用 <code>taskYIELD()</code>， 或中断服务程序 (ISR) 手动请求上下文切换时，才会发生上下文切换。</p><p><code>configUSE_TIME_SLICING</code> 如果 <code>configUSE_TIME_SLICING</code> 设置为 <code>0</code>，则表示时间切片已关闭， 因此调度器不会在每个 tick 中断上在同等优先级的任务之间切换 。</p><h4 id="freertos-amp-调度策略" tabindex="-1"><a class="header-anchor" href="#freertos-amp-调度策略" aria-hidden="true">#</a> FreeRTOS AMP 调度策略</h4><p>使用 FreeRTOS 的非对称多处理 (AMP) 是指多核设备的每个核心都单独运行自己的 FreeRTOS 实例。这些 核心并不都需要具有相同架构， 但如果 FreeRTOS 实例之间需要进行通信，则需要共享一些内存。</p><p>每个核心都会运行自己的 FreeRTOS 实例， 因此任何给定核心上的调度算法与上文的单核系统调度算法完全相同 。您可以使用流缓冲区或消息缓冲区作为核间通信原语， 这样一来，一个核心上的任务可以进入“阻塞”状态， 以等待另一个核心发来的数据或事件。</p><h4 id="freertos-smp-调度策略" tabindex="-1"><a class="header-anchor" href="#freertos-smp-调度策略" aria-hidden="true">#</a> FreeRTOS SMP 调度策略</h4><p>使用 FreeRTOS 的对称多处理 (SMP) 是指 一个 FreeRTOS 实例可以跨多个处理器核心调度 RTOS 任务。由于 只有一个 FreeRTOS 实例在运行，一次只能使用 FreeRTOS 的一个端口， 因此每个核心必须具有相同的处理器架构并共用 相同的内存空间。</p><p>FreeRTOS SMP 调度策略使用与单核调度策略相同的算法， 但与单核和 AMP 场景不同的是， SMP 在任何给定时间都会导致多个任务处于运行状态 （每个核心上都有一个运行状态的任务）。这意味着， 只有缺乏可运行的高优先级任务时，才会运行低优先级任务的假设不再成立 。要想了解其中的原因，请考虑一下， 若起初只有一个高优先级任务 和两个中等优先级任务处于 “就绪”状态，SMP 调度器会如何选择在双核微控制器上运行的任务。调度器需要选择两个任务，每个核心对应一个任务。 首先，高优先级任务是指可运行的最高优先级任务， 因此会选择将它用于第一个核心。 这样就剩下了两个中等优先级的任务 作为可运行的最高优先级任务，因此会将它们用于第二个核心 。结果是高优先级和中等优先级的任务同时运行。</p><p><strong>配置 SMP RTOS 调度策略</strong></p><p>以下配置选项有助于移动下述代码：将为单核或 AMP RTOS 配置编写的代码移动到 SMP RTOS 配置中， 且这些代码依赖于该假设——如果有一个可运行的高优先级任务，那么低优先级任务不会运行。</p><p>configRUN_MULTIPLE_PRIORITIES 如果在下述文件中将 configRUN_MULTIPLE_PRIORITIES 设置为 0： FreeRTOSConfig.h，则调度器只会同时运行 具有相同优先级的多个任务。这可能会修复基于“一次只运行一个任务”这一假设编写的代码， 但这就无法享受到 SMP 配置带来的一些好处。</p><p>configUSE_CORE_AFFINITY 如果在 FreeRTOSConfig.h 中将 configUSE_CORE_AFFINITY 设置为 1， 则 vTaskCoreAffinitySet() API 函数可用于定义某个任务可以在哪些核心上运行 以及不可以在哪些核心上运行。使用该方法，应用程序编写者可以防止 同时执行假设了自身执行顺序的两个任务 。</p><h3 id="任务实现" tabindex="-1"><a class="header-anchor" href="#任务实现" aria-hidden="true">#</a> 任务实现</h3><p>任务结构应如下（伪代码）：</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">vATaskFunction</span><span class="token punctuation">(</span> <span class="token keyword">void</span> <span class="token operator">*</span>pvParameters <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">int32_t</span> local_var <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">/* 任务局部变量存放在各自栈中 */</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/* 任务代码 */</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/* 如果任务从循环中退出，则必须使用如下代码删除自己 */</span>
    <span class="token function">vTaskDelete</span><span class="token punctuation">(</span> <span class="token constant">NULL</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* 程序不可以执行到这里，否则就出错了 */</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>需要注意的是</p><ul><li>任务不得尝试从其实现函数返回或以其他方式退出。In newer FreeRTOS port attempting to do so will result in an configASSERT() being called if it is defined. 在较新的 FreeRTOS 端口中，尝试这样做将导致在定义 <code>configASSERT()</code> 时调用它。</li><li>如果任务需要退出，则让任务调用 <code>vTaskDelete( NULL );</code> 以确保其退出是干净的。</li><li><code>TaskFunction_t</code> 类型是指返回 <code>void</code> 并将 <code>void</code> 指针作为其唯一参数的函数。<strong>所有实现任务的函数</strong>都应该是这种类型的函数。该参数可用于将任何类型的信息传递到任务中、</li></ul><p>任务函数不应返回，因此通常实现为连续循环。但是，正如 RTOS 调度算法介绍页面所述，通常最好创建事件驱动型任务，避免优先级较低的任务因缺少处理时间而饥饿，从而形成以下结构体（伪代码）：</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">vATaskFunction</span><span class="token punctuation">(</span> <span class="token keyword">void</span> <span class="token operator">*</span>pvParameters <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">WaitForEvent</span><span class="token punctuation">(</span> EventObject<span class="token punctuation">,</span> TimeOut <span class="token punctuation">)</span> <span class="token operator">==</span> pdPASS <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">/* Handle event here. */</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">/* Clear errors, or take actions here. */</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* As per the first code listing above. */</span>
    <span class="token function">vTaskDelete</span><span class="token punctuation">(</span> <span class="token constant">NULL</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Psudeo code showing a task waiting for an event with a block time. If the event occurs, process it. 伪代码显示等待具有时间的事件的任务。如果事件发生，请处理它。</p><p>If the timeout expires before the event occurs, then the system may be in an error state, so handle the error. 如果超时在事件发生之前过期，则系统可能处于错误状态，因此请处理错误。</p><p>伪代码中的 <code>WaitForEvent()</code> 可以是 <code>xQueueReceive()</code>, <code>lTaskNotifyTake()</code>, <code>xEventGroupWaitBits()</code> 或任何其他 FreeRTOS 通信和同步原语</p><ul><li>创建任务，请调用 <code>xTaskCreate()</code> 或 <code>xTaskCreateStatic()</code></li><li>删除任务，请调用 <code>vTaskDelete()</code>。</li></ul><h3 id="任务创建" tabindex="-1"><a class="header-anchor" href="#任务创建" aria-hidden="true">#</a> 任务创建</h3><p>使用 FreeRTOS 源码创建任务，需要调用 <code>xTaskCreate()</code> 函数，定义在 <code>FreeRTOS/Source/tasks.c</code> 中</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code>BaseType_t <span class="token function">xTaskCreate</span><span class="token punctuation">(</span> TaskFunction_t pxTaskCode<span class="token punctuation">,</span>
                        <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> <span class="token keyword">const</span> pcName<span class="token punctuation">,</span>
                        <span class="token keyword">const</span> configSTACK_DEPTH_TYPE usStackDepth<span class="token punctuation">,</span>
                        <span class="token keyword">void</span> <span class="token operator">*</span> <span class="token keyword">const</span> pvParameters<span class="token punctuation">,</span>
                        UBaseType_t uxPriority<span class="token punctuation">,</span>
                        TaskHandle_t <span class="token operator">*</span> <span class="token keyword">const</span> pxCreatedTask <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong><code>pxTaskCode</code></strong> 函数指针，也是任务函数的入口，应该确保任务永远不退出。返回类型被定义成空类型 <code>typedef void (*TaskFunction_t)( void * );</code></li><li><strong><code>pcName</code></strong> 任务名称，主要用于调试，最大长度为 <code>configMAX_TASK_NAME_LEN</code>，定义在 <code>FreeRTOSConfig.h</code></li><li><strong><code>usStackDepth</code></strong> 任务堆栈大小，能够支持的堆栈变量数量（堆栈深度），单位是 word，最大值为 <code>uint16_t</code> 最大值</li><li><strong><code>pvParameters</code></strong> 传递给任务的参数，一般为 <code>NULL</code></li><li><strong><code>uxPriority</code></strong> 任务优先级，<code>UBaseType_t</code> 为 <code>uint32_t</code>，默认为 <code>tskIDLE_PRIORITY</code> 为 <code>0</code></li><li><strong><code>pxCreatedTask</code></strong> 任务句柄。创建任务后可以使用这个句柄引用任务。 <code>typedef void * TaskHandle_t;</code></li></ul><p>CubeMX 中创建任务，需要在 <code>Tasks and Queues</code> 中创建任务，如下图所示</p><p><img src="/assets/cubemx-freertos-task-create.6f58818a.png" alt="创建任务"></p><ul><li>Task name: 任务名称</li><li>Priority: 优先级</li><li>Stack size(Words): 堆栈大小，字为单位，16 bit</li><li>Entry function: 任务入口函数</li><li>Code Generation Option: 任务函数代码生成方式 <ul><li>Default: 生成一个默认格式的任务函数，用户需要实现函数功能</li><li>As weak: 生产一个用 <code>__weak</code> 修饰的弱函数，可以再在别处实现该任务函数。程序执行时会自动寻找到这个另外实现的任务函数。</li><li>As external: 生成一个外部引用的任务函数，需要在别处实现该任务函数。程序执行时会自动寻找到这个另外实现的任务函数。</li></ul></li><li>Parameters: 传递给任务的参数（指针），一般为 NULL</li><li>Allocation: 任务的内存分配方式， 一般使用 Dynamic ，很少使用 Static</li><li>Buffer Name:</li><li>Control Block Name:</li></ul><h3 id="任务挂起和恢复" tabindex="-1"><a class="header-anchor" href="#任务挂起和恢复" aria-hidden="true">#</a> 任务挂起和恢复</h3><p><a href="https://zhuanlan.zhihu.com/p/451999870" target="_blank" rel="noopener noreferrer">FreeRTOS任务挂起和恢复 - 安迪西的文章 - 知乎</a></p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">vTaskSuspend</span><span class="token punctuation">(</span>TaskHandle_t xTaskToSuspend<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  TCB_t<span class="token operator">*</span> pxTCB<span class="token punctuation">;</span> <span class="token comment">// 任务控制块</span>
  <span class="token function">taskENTER_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 进入临界区</span>
  <span class="token punctuation">{</span>
    <span class="token comment">/* 获取TCB如果在这里传递了null，那么它就是正在挂起的正在运行的任务。 */</span>
    pxTCB <span class="token operator">=</span> <span class="token function">prvGetTCBFromHandle</span><span class="token punctuation">(</span>xTaskToSuspend<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">traceTASK_SUSPEND</span><span class="token punctuation">(</span>pxTCB<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* 从就绪/延迟队列中移除任务，并且放置到挂起队列 */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">uxListRemove</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>pxTCB<span class="token operator">-&gt;</span>xStateListItem<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span>UBaseType_t<span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">taskRESET_READY_PRIORITY</span><span class="token punctuation">(</span>pxTCB<span class="token operator">-&gt;</span>uxPriority<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">mtCOVERAGE_TEST_MARKER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/* 查看任务是否也在等待其他事件？ */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">listLIST_ITEM_CONTAINER</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>pxTCB<span class="token operator">-&gt;</span>xEventListItem<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token function">uxListRemove</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>pxTCB<span class="token operator">-&gt;</span>xEventListItem<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果是则将其从事件列表中移除</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">mtCOVERAGE_TEST_MARKER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">vListInsertEnd</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>xSuspendedTaskList<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>pxTCB<span class="token operator">-&gt;</span>xStateListItem<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// #if (configUSE_TASK_NOTIFICATIONS == 1) {...} // 如果启用了任务通知</span>
  <span class="token punctuation">}</span>
  <span class="token function">taskEXIT_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 退出临界区</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>xSchedulerRunning <span class="token operator">!=</span> pdFALSE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* Reset the next expected unblock time in case it referred to the task that is now in the Suspended state. */</span>
    <span class="token comment">/* 重置下一个预期解除屏蔽时间，以防它引用现在处于挂起状态的任务。 */</span>
    <span class="token function">taskENTER_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 进入临界区</span>
    <span class="token punctuation">{</span>
      <span class="token function">prvResetNextTaskUnblockTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">taskEXIT_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 退出临界区</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">mtCOVERAGE_TEST_MARKER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>pxTCB <span class="token operator">==</span> pxCurrentTCB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xSchedulerRunning <span class="token operator">!=</span> pdFALSE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">/* The current task has just been suspended. */</span>
      <span class="token comment">/* 当前任务刚刚挂起。 */</span>
      <span class="token function">configASSERT</span><span class="token punctuation">(</span>uxSchedulerSuspended <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">portYIELD_WITHIN_API</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">/* The scheduler is not running, but the task that was pointed to by pxCurrentTCB has just been suspended and pxCurrentTCB must be adjusted to point to a different task. */</span>
      <span class="token comment">/* 调度程序未运行，但pxCurrentTCB指向的任务刚刚被挂起，必须调整pxCurrentTCB以指向不同的任务。 */</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">listCURRENT_LIST_LENGTH</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>xSuspendedTaskList<span class="token punctuation">)</span> <span class="token operator">==</span> uxCurrentNumberOfTasks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/* No other tasks are ready, so set pxCurrentTCB back to NULL so when the next task is created pxCurrentTCB will be set to point to it no matter what its relative priority is. */</span>
        <span class="token comment">/* 没有其他任务准备好，因此将px货币TCB设置回NULL，以便在创建下一个任务时，无论其相对优先级如何，px货币TCB都将设置为指向它。 */</span>
        pxCurrentTCB <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">vTaskSwitchContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">mtCOVERAGE_TEST_MARKER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">vTaskSuspendAll</span><span class="token punctuation">(</span> <span class="token keyword">void</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">/* A critical section is not required as the variable is of type
	BaseType_t.  Please read Richard Barry&#39;s reply in the following link to a
	post in the FreeRTOS support forum before reporting this as a bug! -
	http://goo.gl/wu4acr */</span>
	<span class="token operator">++</span>uxSchedulerSuspended<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">vTaskResume</span><span class="token punctuation">(</span>TaskHandle_t xTaskToResume<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  TCB_t<span class="token operator">*</span> <span class="token keyword">const</span> pxTCB <span class="token operator">=</span> <span class="token punctuation">(</span>TCB_t<span class="token operator">*</span><span class="token punctuation">)</span>xTaskToResume<span class="token punctuation">;</span>

  <span class="token comment">/* It does not make sense to resume the calling task. */</span>
  <span class="token function">configASSERT</span><span class="token punctuation">(</span>xTaskToResume<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* The parameter cannot be NULL as it is impossible to resume the
  currently executing task. */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pxTCB <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>pxTCB <span class="token operator">!=</span> pxCurrentTCB<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">taskENTER_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">prvTaskIsTaskSuspended</span><span class="token punctuation">(</span>pxTCB<span class="token punctuation">)</span> <span class="token operator">!=</span> pdFALSE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">traceTASK_RESUME</span><span class="token punctuation">(</span>pxTCB<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/* The ready list can be accessed even if the scheduler is
        suspended because this is inside a critical section. */</span>
        <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token function">uxListRemove</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>pxTCB<span class="token operator">-&gt;</span>xStateListItem<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">prvAddTaskToReadyList</span><span class="token punctuation">(</span>pxTCB<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/* A higher priority task may have just been resumed. */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pxTCB<span class="token operator">-&gt;</span>uxPriority <span class="token operator">&gt;=</span> pxCurrentTCB<span class="token operator">-&gt;</span>uxPriority<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">/* This yield may not cause the task just resumed to run,
          but will leave the lists in the correct state for the
          next yield. */</span>
          <span class="token function">taskYIELD_IF_USING_PREEMPTION</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">mtCOVERAGE_TEST_MARKER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">mtCOVERAGE_TEST_MARKER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">taskEXIT_CRITICAL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">mtCOVERAGE_TEST_MARKER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="任务调度-1" tabindex="-1"><a class="header-anchor" href="#任务调度-1" aria-hidden="true">#</a> 任务调度</h3><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">vTaskStartScheduler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  BaseType_t xReturn<span class="token punctuation">;</span>
<span class="token comment">/* 以最低优先级添加空闲任务 */</span>
<span class="token comment">// #if (configSUPPORT_STATIC_ALLOCATION == 1) { ... }// 静态内存分配代码，不常用跳过，只动态</span>
  <span class="token punctuation">{</span>
    <span class="token comment">/* The Idle task is being created using dynamically allocated RAM. */</span>
    <span class="token comment">/* 动态分配内存创建空闲任务 */</span>
    xReturn <span class="token operator">=</span> <span class="token function">xTaskCreate</span><span class="token punctuation">(</span>prvIdleTask<span class="token punctuation">,</span> configIDLE_TASK_NAME<span class="token punctuation">,</span> configMINIMAL_STACK_SIZE<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token constant">NULL</span><span class="token punctuation">,</span>
                          <span class="token punctuation">(</span>tskIDLE_PRIORITY <span class="token operator">|</span> portPRIVILEGE_BIT<span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token operator">&amp;</span>xIdleTaskHandle<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*lint !e961 MISRA exception, justified as it is not a redundant explicit
                                                cast to all supported compilers. */</span>
  <span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>configUSE_TIMERS <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xReturn <span class="token operator">==</span> pdPASS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      xReturn <span class="token operator">=</span> <span class="token function">xTimerCreateTimerTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">mtCOVERAGE_TEST_MARKER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">/* configUSE_TIMERS */</span></span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>xReturn <span class="token operator">==</span> pdPASS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">/* freertos_tasks_c_additions_init() should only be called if the user
definable macro FREERTOS_TASKS_C_ADDITIONS_INIT() is defined, as that is
the only macro called by the function. */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">FREERTOS_TASKS_C_ADDITIONS_INIT</span></span>
    <span class="token punctuation">{</span>
      <span class="token function">freertos_tasks_c_additions_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

    <span class="token comment">/* Interrupts are turned off here, to ensure a tick does not occur
    before or during the call to xPortStartScheduler().  The stacks of
    the created tasks contain a status word with interrupts switched on
    so interrupts will automatically get re-enabled when the first task
    starts to run. */</span>
    <span class="token comment">/* 关闭中断，以确保在调用xPortStartScheduler（）之前或期间不发生节拍 */</span>
    <span class="token function">portDISABLE_INTERRUPTS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token punctuation">(</span>configUSE_NEWLIB_REENTRANT <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span></span></span>
    <span class="token punctuation">{</span>
      <span class="token comment">/* Switch Newlib&#39;s _impure_ptr variable to point to the _reent
      structure specific to the task that will run first. */</span>
      _impure_ptr <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>pxCurrentTCB<span class="token operator">-&gt;</span>xNewLib_reent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">/* configUSE_NEWLIB_REENTRANT */</span></span>

    xNextTaskUnblockTime <span class="token operator">=</span> portMAX_DELAY<span class="token punctuation">;</span>
    xSchedulerRunning    <span class="token operator">=</span> pdTRUE<span class="token punctuation">;</span>
    xTickCount           <span class="token operator">=</span> <span class="token punctuation">(</span>TickType_t<span class="token punctuation">)</span><span class="token number">0U</span><span class="token punctuation">;</span>

    <span class="token comment">/* If configGENERATE_RUN_TIME_STATS is defined then the following
    macro must be defined to configure the timer/counter used to generate
    the run time counter time base.   NOTE:  If configGENERATE_RUN_TIME_STATS
    is set to 0 and the following line fails to build then ensure you do not
    have portCONFIGURE_TIMER_FOR_RUN_TIME_STATS() defined in your
    FreeRTOSConfig.h file. */</span>
    <span class="token function">portCONFIGURE_TIMER_FOR_RUN_TIME_STATS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* Setting up the timer tick is hardware specific and thus in the portable interface. */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">xPortStartScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> pdFALSE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">/* Should not reach here as if the scheduler is running the function will not return. */</span>
      <span class="token comment">/* 没有代码，如果调度器启动成功就不会到达这里，因为调度器运行的时候不会返回 */</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">/* Should only reach here if a task calls xTaskEndScheduler(). */</span>
      <span class="token comment">/* 仅当任务调用 xTaskEndSchedulerr() 时才应到达此处。 */</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">/* This line will only be reached if the kernel could not be started,
    because there was not enough FreeRTOS heap to create the idle task
    or the timer task. */</span>
    <span class="token function">configASSERT</span><span class="token punctuation">(</span>xReturn <span class="token operator">!=</span> errCOULD_NOT_ALLOCATE_REQUIRED_MEMORY<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/* Prevent compiler warnings if INCLUDE_xTaskGetIdleTaskHandle is set to 0,
  meaning xIdleTaskHandle is not used anywhere else. */</span>
  <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>xIdleTaskHandle<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动调度器：FreeRTOS系统时钟是由滴答定时器来提供，任务切换也会用到PendSV中断，这些硬件的初始化在这里完成</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code>BaseType_t <span class="token function">xPortStartScheduler</span><span class="token punctuation">(</span> <span class="token keyword">void</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">/* configMAX_SYSCALL_INTERRUPT_PRIORITY must not be set to 0.
	See http://www.FreeRTOS.org/RTOS-Cortex-M3-M4.html */</span>
	<span class="token function">configASSERT</span><span class="token punctuation">(</span> configMAX_SYSCALL_INTERRUPT_PRIORITY <span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// #if( configASSERT_DEFINED == 1 ) {} // 这里还有部分代码，省略了</span>

	<span class="token comment">/* 配置 PendSV 和 SysTick 为最低级中断，确保系统实时性 */</span>
	portNVIC_SYSPRI2_REG <span class="token operator">|=</span> portNVIC_PENDSV_PRI<span class="token punctuation">;</span>
	portNVIC_SYSPRI2_REG <span class="token operator">|=</span> portNVIC_SYSTICK_PRI<span class="token punctuation">;</span>

	<span class="token comment">/* Start the timer that generates the tick ISR.  Interrupts are disabled here already. */</span>
	<span class="token comment">/* 启动定时器，生成节拍 ISR 。此处已禁用中断。 */</span>
	<span class="token function">vPortSetupTimerInterrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">/* Initialise the critical nesting count ready for the first task. */</span>
	uxCriticalNesting <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token comment">/* Start the first task. */</span>
	<span class="token function">prvPortStartFirstTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">/* Should never get here as the tasks will now be executing!  Call the task
	exit error function to prevent compiler warnings about a static function
	not being called in the case that the application writer overrides this
	functionality by defining configTASK_RETURN_ADDRESS.  Call
	vTaskSwitchContext() so link time optimisation does not remove the
	symbol. */</span>
	<span class="token function">vTaskSwitchContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">prvTaskExitError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">/* Should not get here! */</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="内存管理" tabindex="-1"><a class="header-anchor" href="#内存管理" aria-hidden="true">#</a> 内存管理</h2><p>在 <code>FreeRTOS/Source/portable/MemMang</code> 下是内存管理相关的文件</p><ul><li><code>heap_1.c</code>: 分配简单，时间确定；只分配、不回收</li><li><code>heap_2.c</code>: 动态分配、最佳匹配；碎片、时间不定</li><li><code>heap_3.c</code>: 调用标准库函数；速度慢、时间不定</li><li><code>heap_4.c</code>: 相邻空闲内存可合并；可解决碎片问题、时间不定</li><li><code>heap_5.c</code>: 在heap_4基础上支持分隔的内存块；可解决碎片问题、时间不定</li></ul><h2 id="freertos-配置" tabindex="-1"><a class="header-anchor" href="#freertos-配置" aria-hidden="true">#</a> FreeRTOS 配置</h2><p>FreeRTOS 使用 <code>FreeRTOSConfig.h</code> 配置文件进行定制。完整配置参考 <a href="https://www.freertos.org/zh-cn-cmn-s/a00110.html" target="_blank" rel="noopener noreferrer">Customisation</a></p><p>每个 FreeRTOS 应用程序必须在其预处理器的包含路径中包含 <code>FreeRTOSConfig.h</code> 头文件 。 <code>FreeRTOSConfig.h</code> 为正在构建的应用程序定制 RTOS 内核。因此它是特定于应用程序的，而非 RTOS，并且<strong>应当位于应用程序目录</strong>，而不是 RTOS 内核源代码目录。</p><blockquote><p>RTOS 源代码下载内容中的每个演示应用程序都有自己的 <code>FreeRTOSConfig.h</code> 文件。</p></blockquote><p>在 STM32CubeMX 的配置中，有如下配置项</p><table><thead><tr><th>配置项</th><th>说明</th></tr></thead><tbody><tr><td><strong>内核设置 (Kernel)</strong></td><td></td></tr><tr><td><a href="#configUSE_PREEMPTION">USE_PREEMPTION</a></td><td>是否使用抢占式调度</td></tr><tr><td><a href="#configCPU_CLOCK_HZ">CPU_CLOCK_HZ</a></td><td>CPU时钟频率</td></tr><tr><td><a href="#configTICK_RATE_HZ">TICK_RATE_HZ</a></td><td>节拍频率</td></tr><tr><td><a href="#configMAX_PRIORITIES">MAX_PRIORITIES</a></td><td>最大优先级数</td></tr><tr><td><a href="#configMINIMAL_STACK_SIZE">MINIMAL_STACK_SIZE</a></td><td>最小堆栈大小</td></tr><tr><td><a href="#configMAX_TASK_NAME_LEN">MAX_TASK_NAME_LEN</a></td><td>任务名称最大长度</td></tr><tr><td><a href="#configUSE_16_BIT_TICKS">USE_16_BIT_TICKS</a></td><td>是否使用16位的节拍计数器</td></tr><tr><td><a href="#configIDLE_SHOULD_YIELD">IDLE_SHOULD_YIELD</a></td><td>空闲任务是否放弃CPU</td></tr><tr><td><a href="#configUSE_MUTEXES">USE_MUTEXES</a></td><td>是否使用互斥量</td></tr><tr><td><a href="#configUSE_RECURSIVE_MUTEXES">USE_RECURSIVE_MUTEXES</a></td><td>是否使用递归互斥量</td></tr><tr><td><a href="#configUSE_COUNTING_SEMAPHORES">USE_COUNTING_SEMAPHORES</a></td><td>是否使用计数信号量</td></tr><tr><td><a href="#configQUEUE_REGISTRY_SIZE">QUEUE_REGISTRY_SIZE</a></td><td>队列注册表大小</td></tr><tr><td><a href="#configUSE_APPLICATION_TASK_TAG">USE_APPLICATION_TASK_TAG</a></td><td>是否使用任务标签</td></tr><tr><td><a href="#configENABLE_BACKWARD_COMPATIBILITY">ENABLE_BACKWARD_COMPATIBILITY</a></td><td>是否启用向后兼容性</td></tr><tr><td><a href="#configUSE_PORT_OPTIMISED_TASK_SELECTION">USE_PORT_OPTIMISED_TASK_SELECTION</a></td><td>是否使用端口优化的任务选择</td></tr><tr><td><a href="#configUSE_TICKLESS_IDLE">USE_TICKLESS_IDLE</a></td><td>是否使用低功耗模式</td></tr><tr><td><a href="#configUSE_TASK_NOTIFICATIONS">USE_TASK_NOTIFICATIONS</a></td><td>是否使用任务通知</td></tr><tr><td><a href="#configRECORD_STACK_HIGH_ADDRESS">RECORD_STACK_HIGH_ADDRESS</a></td><td>是否记录堆栈高地址</td></tr><tr><td><strong>内存管理 (Memory Management)</strong></td><td></td></tr><tr><td><a href="#configSUPPORT_STATIC_ALLOCATION">Memory Allocation (Static)</a></td><td>是否支持静态内存分配</td></tr><tr><td><a href="#configSUPPORT_DYNAMIC_ALLOCATION">Memory Allocation (Dynamic)</a></td><td>是否支持动态内存分配</td></tr><tr><td><a href="#configTOTAL_HEAP_SIZE">TOTAL_HEAP_SIZE</a></td><td>总堆大小</td></tr><tr><td>Memory Management scheme</td><td>内存管理方案</td></tr><tr><td><strong>勾子函数 (Hook function)</strong></td><td></td></tr><tr><td><a href="#configUSE_IDLE_HOOK">USE_IDLE_HOOK</a></td><td>是否使用空闲钩子</td></tr><tr><td><a href="#configUSE_TICK_HOOK">USE_TICK_HOOK</a></td><td>是否使用节拍钩子</td></tr><tr><td><a href="#configUSE_MALLOC_FAILED_HOOK">USE_MALLOC_FAILED_HOOK</a></td><td>是否使用内存分配失败钩子</td></tr><tr><td><a href="#configUSE_DAEMON_TASK_STARTUP_HOOK">USE_DAEMON_TASK_STARTUP_HOOK</a></td><td>是否使用守护任务启动钩子</td></tr><tr><td><a href="#configCHECK_FOR_STACK_OVERFLOW">CHECK_FOR_STACK_OVERFLOW</a></td><td>是否检查堆栈溢出</td></tr><tr><td><strong>运行时间和任务状态(Run time and task stats)</strong></td><td></td></tr><tr><td><a href="#configGENERATE_RUN_TIME_STATS">GENERATE_RUN_TIME_STATS</a></td><td>是否生成运行时间统计</td></tr><tr><td><a href="#configUSE_TRACE_FACILITY">USE_TRACE_FACILITY</a></td><td>是否使用跟踪功能</td></tr><tr><td><a href="#configUSE_STATS_FORMATTING_FUNCTIONS">USE_STATS_FORMATTING_FUNCTIONS</a></td><td>是否使用统计格式化函数</td></tr><tr><td><strong>协程 (Co-routine)</strong></td><td></td></tr><tr><td><a href="#configUSE_CO_ROUTINES">USE_CO_ROUTINES</a></td><td>是否使用协程</td></tr><tr><td><a href="#configMAX_CO_ROUTINE_PRIORITIES">MAX_CO_ROUTINE_PRIORITIES</a></td><td>最大协程优先级数</td></tr><tr><td><strong>软件定时器 (Software timer)</strong></td><td></td></tr><tr><td><a href="#configUSE_TIMERS">USE_TIMERS</a></td><td>是否使用软件定时器</td></tr><tr><td><a href="#configTIMER_TASK_PRIORITY">TIMER_TASK_PRIORITY</a></td><td>定时器任务优先级</td></tr><tr><td><a href="#configTIMER_QUEUE_LENGTH">TIMER_QUEUE_LENGTH</a></td><td>定时器队列长度</td></tr><tr><td><a href="#configTIMER_TASK_STACK_DEPTH">TIMER_TASK_STACK_DEPTH</a></td><td>定时器任务堆栈大小</td></tr><tr><td><strong>中断 (Interrupt nesting behaviour)</strong></td><td></td></tr><tr><td><a href="#configLIBRARY_LOWEST_INTERRUPT_PRIORITY">LIBRARY_LOWEST_INTERRUPT_PRIORITY</a></td><td>库最低中断优先级</td></tr><tr><td><a href="#configLIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY">LIBRARY_MAX_SYSCALL_INTERRUPT_PRIORITY</a></td><td>库最大系统调用中断优先级</td></tr></tbody></table><h4 id="configuse-preemption" tabindex="-1"><a class="header-anchor" href="#configuse-preemption" aria-hidden="true">#</a> configUSE_PREEMPTION</h4><p>是否使用抢占式 (PREEMPTION) 调度器：</p><ul><li><code>1</code>，抢占式调度器</li><li><code>0</code>，协作式调度器（时间片）</li></ul><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_PREEMPTION</span>  <span class="token expression"><span class="token number">1</span></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>协作式调度，本质上是任务在运行一段时间后，自己放弃 CPU 运行权，让其他任务运行。在 FreeRTOS 里，是通过 <code>taskYIELD()</code> 这个函数实现放弃 CPU 的。</p></blockquote><h4 id="configsupport-static-allocation" tabindex="-1"><a class="header-anchor" href="#configsupport-static-allocation" aria-hidden="true">#</a> configSUPPORT_STATIC_ALLOCATION</h4><p>设置为 1，那么 RTOS 对象可以使用应用程序编写者提供的 RAM 创建；设置为 0，那么 RTOS 对象只能使用从 FreeRTOS 堆中分配的 RAM 创建。</p><p>如果将 configSUPPORT_STATIC_ALLOCATION 设置为 1，那么应用程序编写者还必须提供两个回调函数： vApplicationGetIdleTaskMemory() 用于提供 RTOS 空闲任务所使用的内存，以及（如果 configUSE_TIMERS 设置为 1）vApplicationGetTimerTaskMemory() 用于提供 RTOS 守护/定时器服务任务使用的内存。 示例 提供在下方。</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configSUPPORT_STATIC_ALLOCATION</span>          <span class="token expression"><span class="token number">1</span></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="configsupport-dynamic-allocation" tabindex="-1"><a class="header-anchor" href="#configsupport-dynamic-allocation" aria-hidden="true">#</a> configSUPPORT_DYNAMIC_ALLOCATION</h4><p>如果将 configSUPPORT_DYNAMIC_ALLOCATION 设置为 1，那么 RTOS 对象可以 使用从 FreeRTOS 堆中自动分配的 RAM 创建。</p><p>如果 configSUPPORT_DYNAMIC_ALLOCATION 设置为 0，那么 RTOS 对象只能 使用应用程序编写者提供的 RAM 创建。</p><p>https://www.freertos.org/zh-cn-cmn-s/Static_Vs_Dynamic_Memory_Allocation.html</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configSUPPORT_DYNAMIC_ALLOCATION</span>         <span class="token expression"><span class="token number">1</span></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="configuse-idle-hook" tabindex="-1"><a class="header-anchor" href="#configuse-idle-hook" aria-hidden="true">#</a> configUSE_IDLE_HOOK</h4><ul><li><code>1</code> 使用空闲钩子 (Idle Hook 类似于回调函数)</li><li><code>0</code> 忽略空闲钩子</li></ul><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_IDLE_HOOK</span>   <span class="token expression"><span class="token number">0</span></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>当RTOS调度器开始工作后，为了保证至少有一个任务在运行，空闲任务被自动创建，占用最低优先级（0优先级）。对于已经删除的RTOS任务，空闲任务可以释放分配给它们的堆栈内存。因此，在应用中应该注意，使用vTaskDelete()函数时要确保空闲任务获得一定的处理器时间。除此之外，空闲任务没有其它特殊功能，因此可以任意的剥夺空闲任务的处理器时间。</p><p>应用程序也可能和空闲任务共享同个优先级。</p><p>空闲任务钩子是一个函数，这个函数由用户来实现，RTOS规定了函数的名字和参数，这个函数在每个空闲任务周期都会被调用。</p><p>要创建一个空闲钩子：</p><p>设置FreeRTOSConfig.h 文件中的configUSE_IDLE_HOOK 为1； 定义一个函数，函数名和参数如下所示： void vApplicationIdleHook(void );</p><p>这个钩子函数不可以调用会引起空闲任务阻塞的API函数（例如：vTaskDelay()、带有阻塞时间的队列和信号量函数），在钩子函数内部使用协程是被允许的。</p><p>使用空闲钩子函数设置CPU进入省电模式是很常见的。</p><h4 id="configuse-tick-hook" tabindex="-1"><a class="header-anchor" href="#configuse-tick-hook" aria-hidden="true">#</a> configUSE_TICK_HOOK</h4><ul><li><code>1</code> 使用节拍钩子</li><li><code>0</code> 忽略节拍钩子</li></ul><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_TICK_HOOK</span>                      <span class="token expression"><span class="token number">0</span></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="configcpu-clock-hz" tabindex="-1"><a class="header-anchor" href="#configcpu-clock-hz" aria-hidden="true">#</a> configCPU_CLOCK_HZ</h4><p>输入驱动生成节拍中断的外设所用的内部时钟的执行频率（以赫兹为单位）。 内部时钟通常也是 驱动内部 CPU 的时钟。 此值是 正确配置定时器外围设备所必需的。</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configCPU_CLOCK_HZ</span>                       <span class="token expression"><span class="token punctuation">(</span> SystemCoreClock <span class="token punctuation">)</span></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="configtick-rate-hz" tabindex="-1"><a class="header-anchor" href="#configtick-rate-hz" aria-hidden="true">#</a> configTICK_RATE_HZ</h4><p>在 FreeRTOS 中，系统时钟节拍的特点就是周期性中断，既然要产生中断那就需要定时器，所以在这里就是使用了一个24位的定时器，采用向下计数的方式，然后可以产生周期性的中断。</p><p>RTOS 节拍中断的频率。节拍中断用于测定时间。因此，节拍频率越高，时间测定的分辨率越高。然而，节拍频率高也意味着 RTOS 内核将使用更多的 CPU 时间，因此效率会降低 。</p><p>多个任务可以共用相同的优先级。 RTOS 调度器将会 在每个 RTOS 滴答期间切换具有相同优先级的任务，让它们共享处理器时间。 因此，滴答频率高也会减少分给每个任务的“时间切片”。</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configTICK_RATE_HZ</span>                       <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>TickType_t<span class="token punctuation">)</span><span class="token number">1000</span><span class="token punctuation">)</span></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="configmax-priorities" tabindex="-1"><a class="header-anchor" href="#configmax-priorities" aria-hidden="true">#</a> configMAX_PRIORITIES</h4><p>应用程序任务可用的优先级数量。任意数量的任务可共用相同的优先级。协程单独分配优先级。</p><p>每个可用的优先级都消耗了 RTOS 内核一些 RAM，因此不应将该值设置得高于应用程序实际需要的优先级数量 。</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configMAX_PRIORITIES</span>                     <span class="token expression"><span class="token punctuation">(</span> <span class="token number">56</span> <span class="token punctuation">)</span></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="configminimal-stack-size" tabindex="-1"><a class="header-anchor" href="#configminimal-stack-size" aria-hidden="true">#</a> configMINIMAL_STACK_SIZE</h4><p>空闲任务使用的堆栈大小。</p><p>此堆栈大小与 <code>xTaskCreate()</code> 和 <code>xTaskCreateStatic()</code> 函数的堆栈大小参数类似， 是按字指定，而不是按字节指定。 如果堆栈上的每个元素为 32 位，那么 大小为 100 元素的堆栈包含 400 字节（每个堆栈元素 32 位，消耗 4 个字节）。</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configMINIMAL_STACK_SIZE</span>                 <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span><span class="token punctuation">)</span><span class="token number">128</span><span class="token punctuation">)</span></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="configtotal-heap-size" tabindex="-1"><a class="header-anchor" href="#configtotal-heap-size" aria-hidden="true">#</a> configTOTAL_HEAP_SIZE</h4><p>这个参数需要注意设置大一些，否则无法开启过多任务</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configTOTAL_HEAP_SIZE</span>                    <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">size_t</span><span class="token punctuation">)</span><span class="token number">3072</span><span class="token punctuation">)</span></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="configmax-task-name-len" tabindex="-1"><a class="header-anchor" href="#configmax-task-name-len" aria-hidden="true">#</a> configMAX_TASK_NAME_LEN</h4><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configMAX_TASK_NAME_LEN</span>                  <span class="token expression"><span class="token punctuation">(</span> <span class="token number">16</span> <span class="token punctuation">)</span></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="configuse-trace-facility" tabindex="-1"><a class="header-anchor" href="#configuse-trace-facility" aria-hidden="true">#</a> configUSE_TRACE_FACILITY</h4><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_TRACE_FACILITY</span>                 <span class="token expression"><span class="token number">1</span></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="configuse-16-bit-ticks" tabindex="-1"><a class="header-anchor" href="#configuse-16-bit-ticks" aria-hidden="true">#</a> configUSE_16_BIT_TICKS</h4><p>时间以 &#39;滴答s&#39; 为单位测定，这是 RTOS 内核启动后，滴答中断已经执行的次数。 滴答数存放在 滴答Type_t 类型的变量中。 将 configUSE_16_BIT_滴答S 定义为 1，会将 滴答Type_t 定义为 (typedef) 无符号的 16 位类型。 将 configUSE_16_BIT_滴答S 定义为 0，会将 滴答Type_t 定义为 (typedef) 无符号的 32 位类型。</p><p>在 8 位和 16 位架构上使用 16 位类型，将大大提高性能，但会限制最大可指定的 时间段为 65535 &#39;滴答s&#39;。 因此，假设滴答频率为 250 Hz，当使用 16 位计数器时，任务可以延迟或阻塞的最大时间为 262 秒，而 使用 32 位计数器时，则为 17179869 秒。</p><p>增加了 configTICK_TYPE_WIDTH_IN_BITS，以支持大于 32 位的滴答计数。新设计应使用 configTICK_TYPE_WIDTH_IN_BITS，而不是 configUSE_16_BIT_TICKS。</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_16_BIT_TICKS</span>                   <span class="token expression"><span class="token number">0</span></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="configuse-mutexes" tabindex="-1"><a class="header-anchor" href="#configuse-mutexes" aria-hidden="true">#</a> configUSE_MUTEXES</h4><p><code>configUSE_MUTEXES</code> 设置为 1，启用互斥锁的功能</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_MUTEXES</span>                        <span class="token expression"><span class="token number">1</span></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="configqueue-registry-size" tabindex="-1"><a class="header-anchor" href="#configqueue-registry-size" aria-hidden="true">#</a> configQUEUE_REGISTRY_SIZE</h4><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configQUEUE_REGISTRY_SIZE</span>                <span class="token expression"><span class="token number">8</span></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="configuse-recursive-mutexes" tabindex="-1"><a class="header-anchor" href="#configuse-recursive-mutexes" aria-hidden="true">#</a> configUSE_RECURSIVE_MUTEXES</h4><p><code>configUSE_RECURSIVE_MUTEXES</code> 设置为 1，启用递归互斥锁的功能</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_RECURSIVE_MUTEXES</span>              <span class="token expression"><span class="token number">1</span></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="configuse-counting-semaphores" tabindex="-1"><a class="header-anchor" href="#configuse-counting-semaphores" aria-hidden="true">#</a> configUSE_COUNTING_SEMAPHORES</h4><p>将其设置为 1，将在构建中包含计数信号量功能，或设置为 0，将在构建中忽略计数信号量功能。</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_COUNTING_SEMAPHORES</span>            <span class="token expression"><span class="token number">1</span></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="configuse-port-optimised-task-selection" tabindex="-1"><a class="header-anchor" href="#configuse-port-optimised-task-selection" aria-hidden="true">#</a> configUSE_PORT_OPTIMISED_TASK_SELECTION</h4><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_PORT_OPTIMISED_TASK_SELECTION</span>  <span class="token expression"><span class="token number">0</span></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="configuse-co-routines" tabindex="-1"><a class="header-anchor" href="#configuse-co-routines" aria-hidden="true">#</a> configUSE_CO_ROUTINES</h4><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">configUSE_CO_ROUTINES</span>                    <span class="token expression"><span class="token number">0</span></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="configmax-co-routine-priorities" tabindex="-1"><a class="header-anchor" href="#configmax-co-routine-priorities" aria-hidden="true">#</a> configMAX_CO_ROUTINE_PRIORITIES</h4><h4 id="configuse-timers" tabindex="-1"><a class="header-anchor" href="#configuse-timers" aria-hidden="true">#</a> configUSE_TIMERS</h4><h4 id="configtimer-task-priority" tabindex="-1"><a class="header-anchor" href="#configtimer-task-priority" aria-hidden="true">#</a> configTIMER_TASK_PRIORITY</h4><h4 id="configtimer-queue-length" tabindex="-1"><a class="header-anchor" href="#configtimer-queue-length" aria-hidden="true">#</a> configTIMER_QUEUE_LENGTH</h4><h4 id="configtimer-task-stack-depth" tabindex="-1"><a class="header-anchor" href="#configtimer-task-stack-depth" aria-hidden="true">#</a> configTIMER_TASK_STACK_DEPTH</h4><h4 id="configuse-newlib-reentrant" tabindex="-1"><a class="header-anchor" href="#configuse-newlib-reentrant" aria-hidden="true">#</a> configUSE_NEWLIB_REENTRANT</h4><h4 id="include-vtaskpriorityset" tabindex="-1"><a class="header-anchor" href="#include-vtaskpriorityset" aria-hidden="true">#</a> INCLUDE_vTaskPrioritySet</h4><h4 id="include-uxtaskpriorityget" tabindex="-1"><a class="header-anchor" href="#include-uxtaskpriorityget" aria-hidden="true">#</a> INCLUDE_uxTaskPriorityGet</h4><h4 id="include-vtaskdelete" tabindex="-1"><a class="header-anchor" href="#include-vtaskdelete" aria-hidden="true">#</a> INCLUDE_vTaskDelete</h4><h4 id="include-vtaskcleanupresources" tabindex="-1"><a class="header-anchor" href="#include-vtaskcleanupresources" aria-hidden="true">#</a> INCLUDE_vTaskCleanUpResources</h4><h4 id="include-vtasksuspend" tabindex="-1"><a class="header-anchor" href="#include-vtasksuspend" aria-hidden="true">#</a> INCLUDE_vTaskSuspend</h4><h4 id="include-vtaskdelayuntil" tabindex="-1"><a class="header-anchor" href="#include-vtaskdelayuntil" aria-hidden="true">#</a> INCLUDE_vTaskDelayUntil</h4><h4 id="include-vtaskdelay" tabindex="-1"><a class="header-anchor" href="#include-vtaskdelay" aria-hidden="true">#</a> INCLUDE_vTaskDelay</h4><h4 id="include-xtaskgetschedulerstate" tabindex="-1"><a class="header-anchor" href="#include-xtaskgetschedulerstate" aria-hidden="true">#</a> INCLUDE_xTaskGetSchedulerState</h4><h4 id="include-xtimerpendfunctioncall" tabindex="-1"><a class="header-anchor" href="#include-xtimerpendfunctioncall" aria-hidden="true">#</a> INCLUDE_xTimerPendFunctionCall</h4><h4 id="include-xqueuegetmutexholder" tabindex="-1"><a class="header-anchor" href="#include-xqueuegetmutexholder" aria-hidden="true">#</a> INCLUDE_xQueueGetMutexHolder</h4><h4 id="include-uxtaskgetstackhighwatermark" tabindex="-1"><a class="header-anchor" href="#include-uxtaskgetstackhighwatermark" aria-hidden="true">#</a> INCLUDE_uxTaskGetStackHighWaterMark</h4><h4 id="include-etaskgetstate" tabindex="-1"><a class="header-anchor" href="#include-etaskgetstate" aria-hidden="true">#</a> INCLUDE_eTaskGetState</h4><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考" aria-hidden="true">#</a> 参考</h2><ul><li><p><a href="https://blog.csdn.net/weixin_44793491/article/details/107577711" target="_blank" rel="noopener noreferrer">FreeRTOS + CubeMX</a></p></li><li><p><a href="https://blog.csdn.net/zhzht19861011/article/details/50134883" target="_blank" rel="noopener noreferrer">FreeRTOS 内核配置说明</a></p></li><li><p><a href="https://www.zhihu.com/question/332352204/answer/3216774530" target="_blank" rel="noopener noreferrer">如何系统学习freertos（STM32平台）？</a> - 安迪西的回答 - 知乎</p></li></ul></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg><a class="external-link meta-item-label" href="https://github.com/HenryZhuHR/henryzhuhr.github.io/edit/main/docs/program/freertos/freertos.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub"><!--[--><!--]--><!----><span>Edit this page on GitHub</span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><!----></footer><!----><!--[--><div class="pager"><a href="/program/Nvidia/TensorRT/TensorRT.html" class="prev">Previous <br><span>TensorRT</span></a><a href="/MachineLearning/nlp/nlp.html" class="next">Next <br><span>NLP 学习日志</span></a></div><!--]--><!----></main><ul class="catalog" style="top:0px;"><li class="level-2 toc-link-简介">简介</li><li class="level-2 toc-link-在-cubmx-上配置-freertos">在 CubMX 上配置 FreeRTOS</li><li class="level-2 toc-link-freertos-源码结构">FreeRTOS 源码结构</li><li class="level-2 toc-link-任务">任务</li><li class="level-3 toc-link-任务状态">任务状态</li><li class="level-3 toc-link-任务优先级">任务优先级</li><li class="level-3 toc-link-任务调度">任务调度</li><li class="level-4 toc-link-默认-rtos-调度策略-单核">默认 RTOS 调度策略（单核）</li><li class="level-4 toc-link-freertos-amp-调度策略">FreeRTOS AMP 调度策略</li><li class="level-4 toc-link-freertos-smp-调度策略">FreeRTOS SMP 调度策略</li><li class="level-3 toc-link-任务实现">任务实现</li><li class="level-3 toc-link-任务创建">任务创建</li><li class="level-3 toc-link-任务挂起和恢复">任务挂起和恢复</li><li class="level-3 toc-link-任务调度-1">任务调度</li><li class="level-2 toc-link-内存管理">内存管理</li><li class="level-2 toc-link-freertos-配置">FreeRTOS 配置</li><li class="level-4 toc-link-configuse-preemption">configUSE_PREEMPTION</li><li class="level-4 toc-link-configsupport-static-allocation">configSUPPORT_STATIC_ALLOCATION</li><li class="level-4 toc-link-configsupport-dynamic-allocation">configSUPPORT_DYNAMIC_ALLOCATION</li><li class="level-4 toc-link-configuse-idle-hook">configUSE_IDLE_HOOK</li><li class="level-4 toc-link-configuse-tick-hook">configUSE_TICK_HOOK</li><li class="level-4 toc-link-configcpu-clock-hz">configCPU_CLOCK_HZ</li><li class="level-4 toc-link-configtick-rate-hz">configTICK_RATE_HZ</li><li class="level-4 toc-link-configmax-priorities">configMAX_PRIORITIES</li><li class="level-4 toc-link-configminimal-stack-size">configMINIMAL_STACK_SIZE</li><li class="level-4 toc-link-configtotal-heap-size">configTOTAL_HEAP_SIZE</li><li class="level-4 toc-link-configmax-task-name-len">configMAX_TASK_NAME_LEN</li><li class="level-4 toc-link-configuse-trace-facility">configUSE_TRACE_FACILITY</li><li class="level-4 toc-link-configuse-16-bit-ticks">configUSE_16_BIT_TICKS</li><li class="level-4 toc-link-configuse-mutexes">configUSE_MUTEXES</li><li class="level-4 toc-link-configqueue-registry-size">configQUEUE_REGISTRY_SIZE</li><li class="level-4 toc-link-configuse-recursive-mutexes">configUSE_RECURSIVE_MUTEXES</li><li class="level-4 toc-link-configuse-counting-semaphores">configUSE_COUNTING_SEMAPHORES</li><li class="level-4 toc-link-configuse-port-optimised-task-selection">configUSE_PORT_OPTIMISED_TASK_SELECTION</li><li class="level-4 toc-link-configuse-co-routines">configUSE_CO_ROUTINES</li><li class="level-4 toc-link-configmax-co-routine-priorities">configMAX_CO_ROUTINE_PRIORITIES</li><li class="level-4 toc-link-configuse-timers">configUSE_TIMERS</li><li class="level-4 toc-link-configtimer-task-priority">configTIMER_TASK_PRIORITY</li><li class="level-4 toc-link-configtimer-queue-length">configTIMER_QUEUE_LENGTH</li><li class="level-4 toc-link-configtimer-task-stack-depth">configTIMER_TASK_STACK_DEPTH</li><li class="level-4 toc-link-configuse-newlib-reentrant">configUSE_NEWLIB_REENTRANT</li><li class="level-4 toc-link-include-vtaskpriorityset">INCLUDE_vTaskPrioritySet</li><li class="level-4 toc-link-include-uxtaskpriorityget">INCLUDE_uxTaskPriorityGet</li><li class="level-4 toc-link-include-vtaskdelete">INCLUDE_vTaskDelete</li><li class="level-4 toc-link-include-vtaskcleanupresources">INCLUDE_vTaskCleanUpResources</li><li class="level-4 toc-link-include-vtasksuspend">INCLUDE_vTaskSuspend</li><li class="level-4 toc-link-include-vtaskdelayuntil">INCLUDE_vTaskDelayUntil</li><li class="level-4 toc-link-include-vtaskdelay">INCLUDE_vTaskDelay</li><li class="level-4 toc-link-include-xtaskgetschedulerstate">INCLUDE_xTaskGetSchedulerState</li><li class="level-4 toc-link-include-xtimerpendfunctioncall">INCLUDE_xTimerPendFunctionCall</li><li class="level-4 toc-link-include-xqueuegetmutexholder">INCLUDE_xQueueGetMutexHolder</li><li class="level-4 toc-link-include-uxtaskgetstackhighwatermark">INCLUDE_uxTaskGetStackHighWaterMark</li><li class="level-4 toc-link-include-etaskgetstate">INCLUDE_eTaskGetState</li><li class="level-2 toc-link-参考">参考</li></ul></div><!--]--></div><div class="search-page" role="search"><span class="search-close"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="28" height="28" fill="currentColor"><path d="M224 416c-8.188 0-16.38-3.125-22.62-9.375l-192-192c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L224 338.8l169.4-169.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-192 192C240.4 412.9 232.2 416 224 416z"></path></svg></span><div class="gungnir-search-box"><input placeholder="$ grep ..." autocomplete="off" spellcheck="false" value><!----></div></div><div class="menu-btn-container"><div class="menu-btn-wrapper"><div class="menu-btn"><div style="" class="menu-btn-icon"><span></span><span></span><span></span></div><div style="display:none;" class="menu-text">0</div><svg class="menu-progress"><circle class="menu-border" cx="50%" cy="50%" r="48%" style="stroke-dasharray:0% 314.15926%;"></circle></svg></div><div class="menu-btn-child-wrapper"><div title="toggle color mode" class="menu-btn-child"><svg class="ov-icon" style="font-size:1.2em;display:none;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M256 160c-52.9 0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0-49.9-49.9-49.9-131.1 0-181 49.9-49.9 131.1-49.9 181 0 49.9 49.9 49.9 131.1 0 181z"/></svg><svg class="ov-icon" style="font-size:1.2em;display:none;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 00283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"/></svg><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M224 96l16-32 32-16-32-16-16-32-16 32-32 16 32 16 16 32zM80 160l26.66-53.33L160 80l-53.34-26.67L80 0 53.34 53.33 0 80l53.34 26.67L80 160zm352 128l-26.66 53.33L352 368l53.34 26.67L432 448l26.66-53.33L512 368l-53.34-26.67L432 288zm70.62-193.77L417.77 9.38C411.53 3.12 403.34 0 395.15 0c-8.19 0-16.38 3.12-22.63 9.38L9.38 372.52c-12.5 12.5-12.5 32.76 0 45.25l84.85 84.85c6.25 6.25 14.44 9.37 22.62 9.37 8.19 0 16.38-3.12 22.63-9.37l363.14-363.15c12.5-12.48 12.5-32.75 0-45.24zM359.45 203.46l-50.91-50.91 86.6-86.6 50.91 50.91-86.6 86.6z"/></svg></div><div class="menu-btn-child"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"/></svg></div><div class="menu-btn-child"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z"/></svg></div><div class="menu-btn-child menu-toc-btn"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M48 48a48 48 0 1048 48 48 48 0 00-48-48zm0 160a48 48 0 1048 48 48 48 0 00-48-48zm0 160a48 48 0 1048 48 48 48 0 00-48-48zm448 16H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16v-32a16 16 0 00-16-16zm0-320H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16V80a16 16 0 00-16-16zm0 160H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16v-32a16 16 0 00-16-16z"/></svg></div><div class="toggle-sidebar-button menu-btn-child menu-btn-sidebar" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-1.6 -1.6 19.2 19.2" fill="currentColor"><path d="M14 2a1 1 0 011 1v10a1 1 0 01-1 1H2a1 1 0 01-1-1V3a1 1 0 011-1h12zM2 1a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V3a2 2 0 00-2-2H2z"/><path d="M3 4a1 1 0 011-1h2a1 1 0 011 1v8a1 1 0 01-1 1H4a1 1 0 01-1-1V4z"/></svg></div></div></div></div><footer class="footer"><span>
        &copy; <a href="https://github.com/HenryZhuHR" target="_blank">HenryZhuHR</a> 2022-today
        <br>
        Powered by <a href="https://v2.vuepress.vuejs.org" target="_blank">VuePress</a> &
        <a href="https://github.com/Renovamen/vuepress-theme-gungnir" target="_blank">Gungnir</a>
      </span></footer></div><!--]--></div>
    <script type="module" src="/assets/app.e2a6bb87.js" defer></script>
  </body>
</html>
