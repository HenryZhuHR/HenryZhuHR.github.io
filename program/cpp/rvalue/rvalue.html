<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.49">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" type="image/png" sizes="32x32" href="/images/global/avatar-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/global/avatar-16x16.png"><meta name="application-name" content="Henry Zhu"><meta name="apple-mobile-web-app-title" content="Henry Zhu"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="apple-touch-icon" href="/images/global/avatar.png"><meta name="theme-color" content="#377bb5"><meta name="msapplication-TileColor" content="#377bb5"><title>一切为了减少拷贝 | Henry Zhu</title><meta name="description" content="">
    <link rel="modulepreload" href="/assets/app.1fb5ba75.js"><link rel="modulepreload" href="/assets/rvalue.html.c2fb5b6f.js"><link rel="modulepreload" href="/assets/rvalue.html.98a24eef.js"><link rel="prefetch" href="/assets/resume.html.53206fbb.js"><link rel="prefetch" href="/assets/deeplearning.html.900dbe2b.js"><link rel="prefetch" href="/assets/index.html.7fa7729f.js"><link rel="prefetch" href="/assets/cache.html.cc22c458.js"><link rel="prefetch" href="/assets/mysql.html.757aa34f.js"><link rel="prefetch" href="/assets/obsidian.html.da43a8f8.js"><link rel="prefetch" href="/assets/DiffusionModel.html.ff266689.js"><link rel="prefetch" href="/assets/index.html.dc6a4c9d.js"><link rel="prefetch" href="/assets/basic.html.607c70f4.js"><link rel="prefetch" href="/assets/classification.html.b07b3f02.js"><link rel="prefetch" href="/assets/classifier.html.c708ed5c.js"><link rel="prefetch" href="/assets/cnn.html.3e86ea92.js"><link rel="prefetch" href="/assets/gan.html.1098a83a.js"><link rel="prefetch" href="/assets/FaceAssign.html.cc78d382.js"><link rel="prefetch" href="/assets/Initialization.html.43b78882.js"><link rel="prefetch" href="/assets/MetricLearning.html.56d0ac08.js"><link rel="prefetch" href="/assets/ema.html.f5ab5ce8.js"><link rel="prefetch" href="/assets/mlp.html.0660856e.js"><link rel="prefetch" href="/assets/norm.html.be62fdb1.js"><link rel="prefetch" href="/assets/object_dection.html.dfeb3b23.js"><link rel="prefetch" href="/assets/fine_tune.html.cdd48cf5.js"><link rel="prefetch" href="/assets/pytorch-install.html.2eab0925.js"><link rel="prefetch" href="/assets/train.html.daacd859.js"><link rel="prefetch" href="/assets/index.html.2a86807c.js"><link rel="prefetch" href="/assets/对抗纹理.html.4403d3a2.js"><link rel="prefetch" href="/assets/2019ICML_Zhang_TRADES.html.90f8bbeb.js"><link rel="prefetch" href="/assets/2019_Shafahi_LS.html.161b326c.js"><link rel="prefetch" href="/assets/2020ICML_Rice_RobustOverfitting.html.bd51b19d.js"><link rel="prefetch" href="/assets/2020NIPS_Pang_HE.html.0840be3d.js"><link rel="prefetch" href="/assets/2021CVPR_Luo_Diffusion3DPointCloud.html.1ceea55a.js"><link rel="prefetch" href="/assets/2021ICML_radford_CLIP.html.28ce0e19.js"><link rel="prefetch" href="/assets/AdversarialTraining.html.22036f37.js"><link rel="prefetch" href="/assets/StyleGAN2.html.378b189b.js"><link rel="prefetch" href="/assets/latex.html.de58da1e.js"><link rel="prefetch" href="/assets/backtracking.html.fb6514d9.js"><link rel="prefetch" href="/assets/dp.html.8bacc5fa.js"><link rel="prefetch" href="/assets/monotonic_stack.html.0ce62ff2.js"><link rel="prefetch" href="/assets/wuhan23_sunset.html.66db1c95.js"><link rel="prefetch" href="/assets/多卡训练.html.f5babbd3.js"><link rel="prefetch" href="/assets/index.html.08dfe82b.js"><link rel="prefetch" href="/assets/conda.html.cbf42244.js"><link rel="prefetch" href="/assets/CXX.html.72ffb69d.js"><link rel="prefetch" href="/assets/dl_deploy.html.3452e295.js"><link rel="prefetch" href="/assets/command.html.ebcf3232.js"><link rel="prefetch" href="/assets/git-zhihu.html.6eb6aaf5.js"><link rel="prefetch" href="/assets/git.html.8b2a454b.js"><link rel="prefetch" href="/assets/http.html.3558a6c2.js"><link rel="prefetch" href="/assets/java.html.a71ba7b7.js"><link rel="prefetch" href="/assets/linux-ubuntu.html.c1898321.js"><link rel="prefetch" href="/assets/linux.html.63bce3ca.js"><link rel="prefetch" href="/assets/mosquitto.html.3c5e5f9b.js"><link rel="prefetch" href="/assets/index.html.c46f4d5b.js"><link rel="prefetch" href="/assets/openvino.html.578a8b3a.js"><link rel="prefetch" href="/assets/list.html.4b77e0e7.js"><link rel="prefetch" href="/assets/python.html.fe309a69.js"><link rel="prefetch" href="/assets/ros2.html.69ec61fd.js"><link rel="prefetch" href="/assets/rtmp.html.7c9ab134.js"><link rel="prefetch" href="/assets/ssh.html.3b2f455c.js"><link rel="prefetch" href="/assets/Vue-init.html.8b6620b3.js"><link rel="prefetch" href="/assets/index.html.4136126a.js"><link rel="prefetch" href="/assets/CodiMD.html.484a7e08.js"><link rel="prefetch" href="/assets/PromptEngineering.html.2611a236.js"><link rel="prefetch" href="/assets/QQ-GPT.html.1c3063af.js"><link rel="prefetch" href="/assets/utm串口挂载.html.3517b7d4.js"><link rel="prefetch" href="/assets/BlenderPython.html.b1356ef3.js"><link rel="prefetch" href="/assets/ContentAuthoring-vehicles.html.e853dc67.js"><link rel="prefetch" href="/assets/apis.html.7ca22039.js"><link rel="prefetch" href="/assets/carla-zhihu.html.214dd4fc.js"><link rel="prefetch" href="/assets/carla.html.296a1f02.js"><link rel="prefetch" href="/assets/python-api.html.44711378.js"><link rel="prefetch" href="/assets/retrieve_data.html.7515810e.js"><link rel="prefetch" href="/assets/OpenWRT.html.4d9b86f2.js"><link rel="prefetch" href="/assets/homeAssistant-zhihu.html.a5c3a18a.js"><link rel="prefetch" href="/assets/homeAssistant.html.e68743af.js"><link rel="prefetch" href="/assets/raspberry.html.5433177e.js"><link rel="prefetch" href="/assets/server.html.6105e70a.js"><link rel="prefetch" href="/assets/vscode.html.17c6df65.js"><link rel="prefetch" href="/assets/start.html.9028e430.js"><link rel="prefetch" href="/assets/dataset.html.49ffe26c.js"><link rel="prefetch" href="/assets/index.html.684eff48.js"><link rel="prefetch" href="/assets/diffusion_attack.html.31c4c854.js"><link rel="prefetch" href="/assets/cuda_cudnn.html.2991ff11.js"><link rel="prefetch" href="/assets/TensorRT.html.7c1a68eb.js"><link rel="prefetch" href="/assets/cuda.html.14335be5.js"><link rel="prefetch" href="/assets/index.html.1cbe4fcc.js"><link rel="prefetch" href="/assets/JetsonXavierNX-zhihu.html.912da448.js"><link rel="prefetch" href="/assets/jetson_xavier.html.61e2fbef.js"><link rel="prefetch" href="/assets/cmake.html.d476d39e.js"><link rel="prefetch" href="/assets/cxx11.html.146133c7.js"><link rel="prefetch" href="/assets/generics.html.8f216386.js"><link rel="prefetch" href="/assets/lambda.html.80db4c14.js"><link rel="prefetch" href="/assets/safety_efficiency.html.8b0724b1.js"><link rel="prefetch" href="/assets/smart_ptr.html.db8ca5b2.js"><link rel="prefetch" href="/assets/std_cincout.html.1e4582d5.js"><link rel="prefetch" href="/assets/project.html.6fb8f36a.js"><link rel="prefetch" href="/assets/basic.html.2be0691f.js"><link rel="prefetch" href="/assets/linux-basic.html.cf8137fa.js"><link rel="prefetch" href="/assets/linux-file_system.html.9942e50e.js"><link rel="prefetch" href="/assets/实验1 Linux.html.16c93cc1.js"><link rel="prefetch" href="/assets/实验2 Makefile实验.html.7e41a790.js"><link rel="prefetch" href="/assets/cp.html.667a9262.js"><link rel="prefetch" href="/assets/frp.html.8d62a27a.js"><link rel="prefetch" href="/assets/tmux.html.27822585.js"><link rel="prefetch" href="/assets/ubuntu.html.512f02e5.js"><link rel="prefetch" href="/assets/vim.html.f2381e7f.js"><link rel="prefetch" href="/assets/iterator.html.abb1bb03.js"><link rel="prefetch" href="/assets/list.html.1a74537b.js"><link rel="prefetch" href="/assets/404.html.7d858b3d.js"><link rel="prefetch" href="/assets/index.html.de26035a.js"><link rel="prefetch" href="/assets/index.html.4a704eac.js"><link rel="prefetch" href="/assets/index.html.a04dd3d3.js"><link rel="prefetch" href="/assets/index.html.ff009d80.js"><link rel="prefetch" href="/assets/index.html.2126153c.js"><link rel="prefetch" href="/assets/index.html.f45aae34.js"><link rel="prefetch" href="/assets/index.html.7f48a75e.js"><link rel="prefetch" href="/assets/index.html.07f86cc2.js"><link rel="prefetch" href="/assets/index.html.cf475022.js"><link rel="prefetch" href="/assets/index.html.8111aed0.js"><link rel="prefetch" href="/assets/index.html.76958b33.js"><link rel="prefetch" href="/assets/index.html.881f858e.js"><link rel="prefetch" href="/assets/index.html.f7d705bb.js"><link rel="prefetch" href="/assets/index.html.f55a68b7.js"><link rel="prefetch" href="/assets/index.html.7f012b50.js"><link rel="prefetch" href="/assets/index.html.a4fddea4.js"><link rel="prefetch" href="/assets/index.html.c0ba8663.js"><link rel="prefetch" href="/assets/index.html.78a29513.js"><link rel="prefetch" href="/assets/index.html.fb327772.js"><link rel="prefetch" href="/assets/index.html.bbc9b385.js"><link rel="prefetch" href="/assets/index.html.ea22432c.js"><link rel="prefetch" href="/assets/index.html.140ed163.js"><link rel="prefetch" href="/assets/index.html.e17824b6.js"><link rel="prefetch" href="/assets/index.html.fb4e8b68.js"><link rel="prefetch" href="/assets/index.html.deae5fb3.js"><link rel="prefetch" href="/assets/resume.html.e48574e6.js"><link rel="prefetch" href="/assets/deeplearning.html.1225ff9d.js"><link rel="prefetch" href="/assets/index.html.c0b1bab8.js"><link rel="prefetch" href="/assets/cache.html.60374e00.js"><link rel="prefetch" href="/assets/mysql.html.5e037a43.js"><link rel="prefetch" href="/assets/obsidian.html.66ca0234.js"><link rel="prefetch" href="/assets/DiffusionModel.html.425ffed1.js"><link rel="prefetch" href="/assets/index.html.2db8b0f3.js"><link rel="prefetch" href="/assets/basic.html.96f7e5b0.js"><link rel="prefetch" href="/assets/classification.html.13bd7590.js"><link rel="prefetch" href="/assets/classifier.html.5238874f.js"><link rel="prefetch" href="/assets/cnn.html.052e71bb.js"><link rel="prefetch" href="/assets/gan.html.2e3c7e56.js"><link rel="prefetch" href="/assets/FaceAssign.html.748d4fda.js"><link rel="prefetch" href="/assets/Initialization.html.4682aaec.js"><link rel="prefetch" href="/assets/MetricLearning.html.731fd4ae.js"><link rel="prefetch" href="/assets/ema.html.234b7f4b.js"><link rel="prefetch" href="/assets/mlp.html.18b3d2a6.js"><link rel="prefetch" href="/assets/norm.html.d61d0b9e.js"><link rel="prefetch" href="/assets/object_dection.html.bc2dbff2.js"><link rel="prefetch" href="/assets/fine_tune.html.522acea8.js"><link rel="prefetch" href="/assets/pytorch-install.html.1f9f55c8.js"><link rel="prefetch" href="/assets/train.html.39eaae20.js"><link rel="prefetch" href="/assets/index.html.384ecb1a.js"><link rel="prefetch" href="/assets/对抗纹理.html.675cd90e.js"><link rel="prefetch" href="/assets/2019ICML_Zhang_TRADES.html.fa63a319.js"><link rel="prefetch" href="/assets/2019_Shafahi_LS.html.4e739aad.js"><link rel="prefetch" href="/assets/2020ICML_Rice_RobustOverfitting.html.355b2efa.js"><link rel="prefetch" href="/assets/2020NIPS_Pang_HE.html.14deac41.js"><link rel="prefetch" href="/assets/2021CVPR_Luo_Diffusion3DPointCloud.html.1105c743.js"><link rel="prefetch" href="/assets/2021ICML_radford_CLIP.html.9db95a64.js"><link rel="prefetch" href="/assets/AdversarialTraining.html.55c45d55.js"><link rel="prefetch" href="/assets/StyleGAN2.html.e02299fa.js"><link rel="prefetch" href="/assets/latex.html.5748ac8b.js"><link rel="prefetch" href="/assets/backtracking.html.71a8e7f1.js"><link rel="prefetch" href="/assets/dp.html.5599f434.js"><link rel="prefetch" href="/assets/monotonic_stack.html.f74ad665.js"><link rel="prefetch" href="/assets/wuhan23_sunset.html.02e60c62.js"><link rel="prefetch" href="/assets/多卡训练.html.c2ada95c.js"><link rel="prefetch" href="/assets/index.html.4fcc2287.js"><link rel="prefetch" href="/assets/conda.html.aaab43da.js"><link rel="prefetch" href="/assets/CXX.html.915689e1.js"><link rel="prefetch" href="/assets/dl_deploy.html.a6fa8f30.js"><link rel="prefetch" href="/assets/command.html.df58a4d3.js"><link rel="prefetch" href="/assets/git-zhihu.html.64e9551b.js"><link rel="prefetch" href="/assets/git.html.3c23dc4c.js"><link rel="prefetch" href="/assets/http.html.424d8ac4.js"><link rel="prefetch" href="/assets/java.html.82c669f5.js"><link rel="prefetch" href="/assets/linux-ubuntu.html.a270c573.js"><link rel="prefetch" href="/assets/linux.html.91f017af.js"><link rel="prefetch" href="/assets/mosquitto.html.076e7c4d.js"><link rel="prefetch" href="/assets/index.html.b413234c.js"><link rel="prefetch" href="/assets/openvino.html.99d29623.js"><link rel="prefetch" href="/assets/list.html.fc7936eb.js"><link rel="prefetch" href="/assets/python.html.b505e03e.js"><link rel="prefetch" href="/assets/ros2.html.d617e19d.js"><link rel="prefetch" href="/assets/rtmp.html.b904782b.js"><link rel="prefetch" href="/assets/ssh.html.ee3b63b7.js"><link rel="prefetch" href="/assets/Vue-init.html.a166c82f.js"><link rel="prefetch" href="/assets/index.html.014b3e60.js"><link rel="prefetch" href="/assets/CodiMD.html.c9caf207.js"><link rel="prefetch" href="/assets/PromptEngineering.html.11a24ba8.js"><link rel="prefetch" href="/assets/QQ-GPT.html.c92d0080.js"><link rel="prefetch" href="/assets/utm串口挂载.html.0e76ffb7.js"><link rel="prefetch" href="/assets/BlenderPython.html.124f40d3.js"><link rel="prefetch" href="/assets/ContentAuthoring-vehicles.html.19d243d9.js"><link rel="prefetch" href="/assets/apis.html.fe43bbcb.js"><link rel="prefetch" href="/assets/carla-zhihu.html.c23f9f0f.js"><link rel="prefetch" href="/assets/carla.html.8b1e4173.js"><link rel="prefetch" href="/assets/python-api.html.ed657aed.js"><link rel="prefetch" href="/assets/retrieve_data.html.2e7c3bc3.js"><link rel="prefetch" href="/assets/OpenWRT.html.ceab42e3.js"><link rel="prefetch" href="/assets/homeAssistant-zhihu.html.2f561469.js"><link rel="prefetch" href="/assets/homeAssistant.html.eaa895e3.js"><link rel="prefetch" href="/assets/raspberry.html.31090196.js"><link rel="prefetch" href="/assets/server.html.c731fc4e.js"><link rel="prefetch" href="/assets/vscode.html.57973de6.js"><link rel="prefetch" href="/assets/start.html.b70033f1.js"><link rel="prefetch" href="/assets/dataset.html.f6e3fe4a.js"><link rel="prefetch" href="/assets/index.html.3686085e.js"><link rel="prefetch" href="/assets/diffusion_attack.html.13668710.js"><link rel="prefetch" href="/assets/cuda_cudnn.html.ddbe56d0.js"><link rel="prefetch" href="/assets/TensorRT.html.02b2560b.js"><link rel="prefetch" href="/assets/cuda.html.e9dc6706.js"><link rel="prefetch" href="/assets/index.html.c4b670d9.js"><link rel="prefetch" href="/assets/JetsonXavierNX-zhihu.html.0be6e5c6.js"><link rel="prefetch" href="/assets/jetson_xavier.html.bd619c6f.js"><link rel="prefetch" href="/assets/cmake.html.248e928b.js"><link rel="prefetch" href="/assets/cxx11.html.ddd3a88a.js"><link rel="prefetch" href="/assets/generics.html.8fcf68cf.js"><link rel="prefetch" href="/assets/lambda.html.3fe1bd40.js"><link rel="prefetch" href="/assets/safety_efficiency.html.05a4e6e3.js"><link rel="prefetch" href="/assets/smart_ptr.html.fe57783c.js"><link rel="prefetch" href="/assets/std_cincout.html.f1bec547.js"><link rel="prefetch" href="/assets/project.html.2e3b40f3.js"><link rel="prefetch" href="/assets/basic.html.fd30def3.js"><link rel="prefetch" href="/assets/linux-basic.html.6830436b.js"><link rel="prefetch" href="/assets/linux-file_system.html.6da19d1d.js"><link rel="prefetch" href="/assets/实验1 Linux.html.a11af111.js"><link rel="prefetch" href="/assets/实验2 Makefile实验.html.a3b71f6d.js"><link rel="prefetch" href="/assets/cp.html.9040d6bc.js"><link rel="prefetch" href="/assets/frp.html.ce82b505.js"><link rel="prefetch" href="/assets/tmux.html.d5f5e130.js"><link rel="prefetch" href="/assets/ubuntu.html.f7ee4451.js"><link rel="prefetch" href="/assets/vim.html.c0ef2880.js"><link rel="prefetch" href="/assets/iterator.html.2ca03510.js"><link rel="prefetch" href="/assets/list.html.28a5f3da.js"><link rel="prefetch" href="/assets/404.html.87e00b85.js"><link rel="prefetch" href="/assets/index.html.ccbe8487.js"><link rel="prefetch" href="/assets/index.html.5931f721.js"><link rel="prefetch" href="/assets/index.html.906f1457.js"><link rel="prefetch" href="/assets/index.html.fcb50a93.js"><link rel="prefetch" href="/assets/index.html.fee43d45.js"><link rel="prefetch" href="/assets/index.html.9f5237d2.js"><link rel="prefetch" href="/assets/index.html.b8630435.js"><link rel="prefetch" href="/assets/index.html.add65193.js"><link rel="prefetch" href="/assets/index.html.01b0a4dd.js"><link rel="prefetch" href="/assets/index.html.74e7f304.js"><link rel="prefetch" href="/assets/index.html.a11931dc.js"><link rel="prefetch" href="/assets/index.html.f53c25d5.js"><link rel="prefetch" href="/assets/index.html.bdb46eef.js"><link rel="prefetch" href="/assets/index.html.c1baef6a.js"><link rel="prefetch" href="/assets/index.html.5fc1ea96.js"><link rel="prefetch" href="/assets/index.html.6c011b4e.js"><link rel="prefetch" href="/assets/index.html.b8fd324c.js"><link rel="prefetch" href="/assets/index.html.fcb164b6.js"><link rel="prefetch" href="/assets/index.html.3f54f86e.js"><link rel="prefetch" href="/assets/index.html.ed9c37e8.js"><link rel="prefetch" href="/assets/index.html.275e2cc5.js"><link rel="prefetch" href="/assets/index.html.240c73bc.js"><link rel="prefetch" href="/assets/index.html.052cc0cf.js"><link rel="prefetch" href="/assets/index.html.ca41ea81.js"><link rel="prefetch" href="/assets/index.html.534dec5f.js"><link rel="prefetch" href="/assets/404.16d66b7c.js"><link rel="prefetch" href="/assets/HomePage.d3d5ae3a.js"><link rel="prefetch" href="/assets/Layout.3aa49bef.js"><link rel="prefetch" href="/assets/Links.7e6398f7.js"><link rel="prefetch" href="/assets/Post.4b015b33.js"><link rel="prefetch" href="/assets/Tags.32564d31.js">
    <link rel="stylesheet" href="/assets/style.d4b70036.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar"><!--[--><header class="navbar invert"><span><a href="/" class=""><span class="site-name">$ cd /home/henryzhu</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="主页/Home"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0.48 0.48 23.04 23.04" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg></span><span>主页/Home</span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="开发/Develop"><span class="title"><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-1.6 -1.6 19.2 19.2" fill="currentColor"><path fill-rule="evenodd" d="M14.064 0a8.75 8.75 0 00-6.187 2.563l-.459.458c-.314.314-.616.641-.904.979H3.31a1.75 1.75 0 00-1.49.833L.11 7.607a.75.75 0 00.418 1.11l3.102.954c.037.051.079.1.124.145l2.429 2.428c.046.046.094.088.145.125l.954 3.102a.75.75 0 001.11.418l2.774-1.707a1.75 1.75 0 00.833-1.49V9.485c.338-.288.665-.59.979-.904l.458-.459A8.75 8.75 0 0016 1.936V1.75A1.75 1.75 0 0014.25 0h-.186zM10.5 10.625c-.088.06-.177.118-.266.175l-2.35 1.521.548 1.783 1.949-1.2a.25.25 0 00.119-.213v-2.066zM3.678 8.116L5.2 5.766c.058-.09.117-.178.176-.266H3.309a.25.25 0 00-.213.119l-1.2 1.95 1.782.547zm5.26-4.493A7.25 7.25 0 0114.063 1.5h.186a.25.25 0 01.25.25v.186a7.25 7.25 0 01-2.123 5.127l-.459.458a15.21 15.21 0 01-2.499 2.02l-2.317 1.5-2.143-2.143 1.5-2.317a15.25 15.25 0 012.02-2.5l.458-.458h.002zM12 5a1 1 0 11-2 0 1 1 0 012 0zm-8.44 9.56a1.5 1.5 0 10-2.12-2.12c-.734.73-1.047 2.332-1.15 3.003a.23.23 0 00.265.265c.671-.103 2.273-.416 3.005-1.148z"/></svg></span><span>开发/Develop</span></span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="开发/Develop"><span class="title"><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-1.6 -1.6 19.2 19.2" fill="currentColor"><path fill-rule="evenodd" d="M14.064 0a8.75 8.75 0 00-6.187 2.563l-.459.458c-.314.314-.616.641-.904.979H3.31a1.75 1.75 0 00-1.49.833L.11 7.607a.75.75 0 00.418 1.11l3.102.954c.037.051.079.1.124.145l2.429 2.428c.046.046.094.088.145.125l.954 3.102a.75.75 0 001.11.418l2.774-1.707a1.75 1.75 0 00.833-1.49V9.485c.338-.288.665-.59.979-.904l.458-.459A8.75 8.75 0 0016 1.936V1.75A1.75 1.75 0 0014.25 0h-.186zM10.5 10.625c-.088.06-.177.118-.266.175l-2.35 1.521.548 1.783 1.949-1.2a.25.25 0 00.119-.213v-2.066zM3.678 8.116L5.2 5.766c.058-.09.117-.178.176-.266H3.309a.25.25 0 00-.213.119l-1.2 1.95 1.782.547zm5.26-4.493A7.25 7.25 0 0114.063 1.5h.186a.25.25 0 01.25.25v.186a7.25 7.25 0 01-2.123 5.127l-.459.458a15.21 15.21 0 01-2.499 2.02l-2.317 1.5-2.143-2.143 1.5-2.317a15.25 15.25 0 012.02-2.5l.458-.458h.002zM12 5a1 1 0 11-2 0 1 1 0 012 0zm-8.44 9.56a1.5 1.5 0 10-2.12-2.12c-.734.73-1.047 2.332-1.15 3.003a.23.23 0 00.265.265c.671-.103 2.273-.416 3.005-1.148z"/></svg></span><span>开发/Develop</span></span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/program/linux/linux.md" class="" aria-label="Linux Go!"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0.48 0.48 23.04 23.04" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M20 4H4a2 2 0 00-2 2v12a2 2 0 002 2h16c1.1 0 2-.9 2-2V6a2 2 0 00-2-2zm0 14H4V8h16v10zm-2-1h-6v-2h6v2zM7.5 17l-1.41-1.41L8.67 13l-2.59-2.59L7.5 9l4 4-4 4z"/></svg></span><span>Linux Go!</span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/program/git/git.md" class="" aria-label="Git"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0.48 0.48 23.04 23.04" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46A7.93 7.93 0 0020 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74A7.93 7.93 0 004 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/></svg></span><span>Git</span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/program/ssh/ssh.md" class="" aria-label="SSH"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-1.6 -1.6 19.2 19.2" fill="currentColor"><path fill-rule="evenodd" d="M6.5 5.5a4 4 0 112.731 3.795.75.75 0 00-.768.18L7.44 10.5H6.25a.75.75 0 00-.75.75v1.19l-.06.06H4.25a.75.75 0 00-.75.75v1.19l-.06.06H1.75a.25.25 0 01-.25-.25v-1.69l5.024-5.023a.75.75 0 00.181-.768A3.995 3.995 0 016.5 5.5zm4-5.5a5.5 5.5 0 00-5.348 6.788L.22 11.72a.75.75 0 00-.22.53v2C0 15.216.784 16 1.75 16h2a.75.75 0 00.53-.22l.5-.5a.75.75 0 00.22-.53V14h.75a.75.75 0 00.53-.22l.5-.5a.75.75 0 00.22-.53V12h.75a.75.75 0 00.53-.22l.932-.932A5.5 5.5 0 1010.5 0zm.5 6a1 1 0 100-2 1 1 0 000 2z"/></svg></span><span>SSH</span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/links/" class="" aria-label="分类/Links"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M305.45 462.59c7.391 7.298 6.188 20.097-3 25.004-77.714 41.802-176.726 29.91-242.344-35.709-65.602-65.603-77.51-164.523-35.692-242.331 4.891-9.095 17.69-10.298 25.003-3l116.812 116.813 27.394-27.394c-.688-2.61-1.594-5.001-1.594-7.814a32.004 32.004 0 1132.004 32.005c-2.797 0-5.204-.891-7.798-1.594l-27.41 27.41zm206.526-159.523a16.103 16.103 0 01-16.002 17.003H463.86a15.97 15.97 0 01-15.892-15.002C440.467 175.549 336.453 70.534 207.03 63.533a15.845 15.845 0 01-15.002-15.908V16.027A16.094 16.094 0 01209.03.024C372.255 8.62 503.475 139.841 511.976 303.067zm-96.012-.297a16.21 16.21 0 01-16.112 17.3h-32.207a16.069 16.069 0 01-15.893-14.705c-6.907-77.011-68.118-138.91-144.924-145.224a15.94 15.94 0 01-14.8-15.893v-32.114a16.134 16.134 0 0117.3-16.096c110.123 8.501 198.228 96.607 206.636 206.732z"/></svg></span><span>分类/Links</span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/tags/" class="" aria-label="标签/Tags"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg></span><span>标签/Tags</span><!--[--><!--]--></a></div><!--]--><div class="navbar-item"><a style="cursor:pointer;"><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 2c4.968 0 9 4.032 9 9s-4.032 9-9 9-9-4.032-9-9 4.032-9 9-9zm0 16c3.867 0 7-3.133 7-7 0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7zm8.485.071l2.829 2.828-1.415 1.415-2.828-2.829 1.414-1.414z"/></svg></span><span>Search</span></a></div></nav><!--[--><!--]--><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="主页/Home"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0.48 0.48 23.04 23.04" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg></span><span>主页/Home</span><!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="开发/Develop"><span class="title"><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-1.6 -1.6 19.2 19.2" fill="currentColor"><path fill-rule="evenodd" d="M14.064 0a8.75 8.75 0 00-6.187 2.563l-.459.458c-.314.314-.616.641-.904.979H3.31a1.75 1.75 0 00-1.49.833L.11 7.607a.75.75 0 00.418 1.11l3.102.954c.037.051.079.1.124.145l2.429 2.428c.046.046.094.088.145.125l.954 3.102a.75.75 0 001.11.418l2.774-1.707a1.75 1.75 0 00.833-1.49V9.485c.338-.288.665-.59.979-.904l.458-.459A8.75 8.75 0 0016 1.936V1.75A1.75 1.75 0 0014.25 0h-.186zM10.5 10.625c-.088.06-.177.118-.266.175l-2.35 1.521.548 1.783 1.949-1.2a.25.25 0 00.119-.213v-2.066zM3.678 8.116L5.2 5.766c.058-.09.117-.178.176-.266H3.309a.25.25 0 00-.213.119l-1.2 1.95 1.782.547zm5.26-4.493A7.25 7.25 0 0114.063 1.5h.186a.25.25 0 01.25.25v.186a7.25 7.25 0 01-2.123 5.127l-.459.458a15.21 15.21 0 01-2.499 2.02l-2.317 1.5-2.143-2.143 1.5-2.317a15.25 15.25 0 012.02-2.5l.458-.458h.002zM12 5a1 1 0 11-2 0 1 1 0 012 0zm-8.44 9.56a1.5 1.5 0 10-2.12-2.12c-.734.73-1.047 2.332-1.15 3.003a.23.23 0 00.265.265c.671-.103 2.273-.416 3.005-1.148z"/></svg></span><span>开发/Develop</span></span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="开发/Develop"><span class="title"><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-1.6 -1.6 19.2 19.2" fill="currentColor"><path fill-rule="evenodd" d="M14.064 0a8.75 8.75 0 00-6.187 2.563l-.459.458c-.314.314-.616.641-.904.979H3.31a1.75 1.75 0 00-1.49.833L.11 7.607a.75.75 0 00.418 1.11l3.102.954c.037.051.079.1.124.145l2.429 2.428c.046.046.094.088.145.125l.954 3.102a.75.75 0 001.11.418l2.774-1.707a1.75 1.75 0 00.833-1.49V9.485c.338-.288.665-.59.979-.904l.458-.459A8.75 8.75 0 0016 1.936V1.75A1.75 1.75 0 0014.25 0h-.186zM10.5 10.625c-.088.06-.177.118-.266.175l-2.35 1.521.548 1.783 1.949-1.2a.25.25 0 00.119-.213v-2.066zM3.678 8.116L5.2 5.766c.058-.09.117-.178.176-.266H3.309a.25.25 0 00-.213.119l-1.2 1.95 1.782.547zm5.26-4.493A7.25 7.25 0 0114.063 1.5h.186a.25.25 0 01.25.25v.186a7.25 7.25 0 01-2.123 5.127l-.459.458a15.21 15.21 0 01-2.499 2.02l-2.317 1.5-2.143-2.143 1.5-2.317a15.25 15.25 0 012.02-2.5l.458-.458h.002zM12 5a1 1 0 11-2 0 1 1 0 012 0zm-8.44 9.56a1.5 1.5 0 10-2.12-2.12c-.734.73-1.047 2.332-1.15 3.003a.23.23 0 00.265.265c.671-.103 2.273-.416 3.005-1.148z"/></svg></span><span>开发/Develop</span></span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/program/linux/linux.md" class="" aria-label="Linux Go!"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0.48 0.48 23.04 23.04" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M20 4H4a2 2 0 00-2 2v12a2 2 0 002 2h16c1.1 0 2-.9 2-2V6a2 2 0 00-2-2zm0 14H4V8h16v10zm-2-1h-6v-2h6v2zM7.5 17l-1.41-1.41L8.67 13l-2.59-2.59L7.5 9l4 4-4 4z"/></svg></span><span>Linux Go!</span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/program/git/git.md" class="" aria-label="Git"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0.48 0.48 23.04 23.04" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46A7.93 7.93 0 0020 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74A7.93 7.93 0 004 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/></svg></span><span>Git</span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/program/ssh/ssh.md" class="" aria-label="SSH"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-1.6 -1.6 19.2 19.2" fill="currentColor"><path fill-rule="evenodd" d="M6.5 5.5a4 4 0 112.731 3.795.75.75 0 00-.768.18L7.44 10.5H6.25a.75.75 0 00-.75.75v1.19l-.06.06H4.25a.75.75 0 00-.75.75v1.19l-.06.06H1.75a.25.25 0 01-.25-.25v-1.69l5.024-5.023a.75.75 0 00.181-.768A3.995 3.995 0 016.5 5.5zm4-5.5a5.5 5.5 0 00-5.348 6.788L.22 11.72a.75.75 0 00-.22.53v2C0 15.216.784 16 1.75 16h2a.75.75 0 00.53-.22l.5-.5a.75.75 0 00.22-.53V14h.75a.75.75 0 00.53-.22l.5-.5a.75.75 0 00.22-.53V12h.75a.75.75 0 00.53-.22l.932-.932A5.5 5.5 0 1010.5 0zm.5 6a1 1 0 100-2 1 1 0 000 2z"/></svg></span><span>SSH</span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/links/" class="" aria-label="分类/Links"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M305.45 462.59c7.391 7.298 6.188 20.097-3 25.004-77.714 41.802-176.726 29.91-242.344-35.709-65.602-65.603-77.51-164.523-35.692-242.331 4.891-9.095 17.69-10.298 25.003-3l116.812 116.813 27.394-27.394c-.688-2.61-1.594-5.001-1.594-7.814a32.004 32.004 0 1132.004 32.005c-2.797 0-5.204-.891-7.798-1.594l-27.41 27.41zm206.526-159.523a16.103 16.103 0 01-16.002 17.003H463.86a15.97 15.97 0 01-15.892-15.002C440.467 175.549 336.453 70.534 207.03 63.533a15.845 15.845 0 01-15.002-15.908V16.027A16.094 16.094 0 01209.03.024C372.255 8.62 503.475 139.841 511.976 303.067zm-96.012-.297a16.21 16.21 0 01-16.112 17.3h-32.207a16.069 16.069 0 01-15.893-14.705c-6.907-77.011-68.118-138.91-144.924-145.224a15.94 15.94 0 01-14.8-15.893v-32.114a16.134 16.134 0 0117.3-16.096c110.123 8.501 198.228 96.607 206.636 206.732z"/></svg></span><span>分类/Links</span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/tags/" class="" aria-label="标签/Tags"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg></span><span>标签/Tags</span><!--[--><!--]--></a></div><!--]--><div class="navbar-item"><a style="cursor:pointer;"><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 2c4.968 0 9 4.032 9 9s-4.032 9-9 9-9-4.032-9-9 4.032-9 9-9zm0 16c3.867 0 7-3.133 7-7 0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7zm8.485.071l2.829 2.828-1.415 1.415-2.828-2.829 1.414-1.414z"/></svg></span><span>Search</span></a></div></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><div class="page-content"><!--[--><div class="show-catalog post-wrapper"><div class="article-header use-image post-header" style="background-image:url(/images/backgrounds/terraform-studios-pablo-dominguez-redwall2.jpg);"><div class="article-header-mask" style="background:rgb(67,65,47, .2);"></div><div class="article-header-content"><div class="article-tags"><!--[--><a href="/tags/c++/" class="article-tag">C++</a><a href="/tags/%E5%BC%80%E5%8F%91/" class="article-tag">开发</a><a href="/tags/%E9%9D%A2%E8%AF%95/" class="article-tag">面试</a><!--]--></div><h1 class="article-title">一切为了减少拷贝</h1><p class="article-subtitle">C++ 右值引用、移动语义、万能引用、引用折叠、完美转发</p><div class="article-icons"><div class="article-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M313.6 304c-28.7 0-42.5 16-89.6 16-47.1 0-60.8-16-89.6-16C60.2 304 0 364.2 0 438.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-25.6c0-74.2-60.2-134.4-134.4-134.4zM400 464H48v-25.6c0-47.6 38.8-86.4 86.4-86.4 14.6 0 38.3 16 89.6 16 51.7 0 74.9-16 89.6-16 47.6 0 86.4 38.8 86.4 86.4V464zM224 288c79.5 0 144-64.5 144-144S303.5 0 224 0 80 64.5 80 144s64.5 144 144 144zm0-240c52.9 0 96 43.1 96 96s-43.1 96-96 96-96-43.1-96-96 43.1-96 96-96z"/></svg><span>HenryZhu</span></div><div class="article-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M400 64h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zm-6 400H54c-3.3 0-6-2.7-6-6V160h352v298c0 3.3-2.7 6-6 6z"/></svg><span>2023-09-08</span></div><div class="article-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M17.618 5.968l1.453-1.453 1.414 1.414-1.453 1.453a9 9 0 11-1.414-1.414zM12 20a7 7 0 100-14 7 7 0 000 14zM11 8h2v6h-2V8zM8 1h8v2H8V1z"/></svg><span>22 min</span></div></div></div><!----></div><main class="page post-content"><!--[--><!--]--><div class="theme-gungnir-content"><!--[--><!--]--><div><h1 id="一切为了减少拷贝" tabindex="-1"><a class="header-anchor" href="#一切为了减少拷贝" aria-hidden="true">#</a> 一切为了减少拷贝</h1><p>C++ 11 中引入了右值引用、移动语义、万能引用、引用折叠、完美转发等新特性，这些特性的出现都是为了减少拷贝操作，提高程序的性能。而这些是现代 C++ 噩梦的开始</p><h2 id="左值和右值" tabindex="-1"><a class="header-anchor" href="#左值和右值" aria-hidden="true">#</a> 左值和右值</h2><p><img src="/assets/value.65b7a01b.svg" alt="value"></p><p>先来下定义：</p><ul><li><strong>左值(loactor valu, lvalue)</strong> 是存储在内存中、有明确存储地址（可寻址）的数据</li><li><strong>右值(read value, rvalue)</strong> 是可以提供数据值的数据（不一定可以寻址，例如存储于寄存器中的数据）。同时右值又有 <strong>纯右值(pure rvalue)</strong> 和 <strong>将亡值(eXpiring Value)</strong> 的分类。</li></ul><blockquote><p>locator value 翻译为「可寻址变量」，read value 翻译为「只读变量(字面量)」，因此 l 和 r 并不是左右的意思，而是 locator 和 read 的意思</p></blockquote><p><strong>例如</strong>，<code>x</code> 是一个左值，因为其有明确的内存地址；<code>3</code> 是一个纯右值，因为其不存储在内存中，而是直接提供数据（的临时）值。</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>  <span class="token comment">// x 是一个左值，3 是一个纯右值（字面量）</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>例如</strong>，自增操作时，<code>x++</code> 是一个右值，<code>++x</code> 是一个左值。</p><ul><li><code>x++</code> <strong>返回临时变量，是一个右值</strong>。在后置自增操作中，<code>x</code> 的值会被编译器拷贝一份，然后自增，最后返回拷贝的值。因此对 <code>x++</code> 取地址会报错</li><li><code>++x</code> <strong>返回自己本身，是一个左值</strong>。对 <code>++x</code> 取地址不会报错</li></ul><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code>x<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token comment">// 右值</span>
<span class="token operator">++</span>x<span class="token punctuation">;</span>  <span class="token comment">// 左值</span>
<span class="token keyword">int</span><span class="token operator">*</span> p <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token comment">// error: lvalue required as unary &#39;&amp;&#39; operand</span>
<span class="token keyword">int</span><span class="token operator">*</span> q <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token operator">++</span>x<span class="token punctuation">;</span>  <span class="token comment">// ok</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>例如</strong>，通常字面量都是右值，<strong>字符串字面量除外</strong>，虽然很少这样做，但字符串字面量存储到程序中对数据段时，程序加载到时候也会为其分配内存地址，因此<strong>是左值</strong>。</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span><span class="token operator">*</span> p <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span> <span class="token comment">// lvalue</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>例如</strong>，函数返回值</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> vec <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span>   <span class="token comment">// 0x16f84b228 </span>
    <span class="token comment">// vec 左值， {1, 2, 3} 右值</span>
    <span class="token keyword">return</span> vec<span class="token punctuation">;</span> <span class="token comment">// 返回时拷贝复制到 std::vector&lt;int&gt; </span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> nums<span class="token punctuation">;</span>  <span class="token comment">// 0x16f84b200  左值</span>
nums <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// 0x16f84b200</span>
                        <span class="token comment">// RVO: 0x16f84b228</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>函数 <code>func()</code> 内的 <code>vec</code> 是一个临时变量，在函数结束后， <code>vec</code> 会被拷贝一份返回，然后立即销毁，这就会造成额外的开销</p><p>但是，编译器对此进行了默认 RVO 优化 (禁用可以添加编译选项 <code>-fno-elide-constructors</code>)，会将 <code>vec</code> 进行隐式右值转化，直接将 <code>vec</code> 的内容移动到 <code>nums</code> 中，而不是拷贝一份，这样就避免了额外的开销。</p><h2 id="左值引用" tabindex="-1"><a class="header-anchor" href="#左值引用" aria-hidden="true">#</a> 左值引用</h2><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span> val <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">int</span><span class="token operator">&amp;</span> lrval <span class="token operator">=</span> val<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>定义左值引用的时候需要直接初始化，否则会报错 <code>error: declaration of reference variable &#39;lrval&#39; requires an initializer</code></p><h2 id="右值引用" tabindex="-1"><a class="header-anchor" href="#右值引用" aria-hidden="true">#</a> 右值引用</h2><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span> val <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token operator">&amp;&amp;</span> rrval <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>定义右值引用的时候需要直接初始化，否则会报错 <code>error: declaration of reference variable &#39;lrval&#39; requires an initializer</code></p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">PrintRefType</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">&amp;</span>ref<span class="token punctuation">)</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;lvalue:&quot;</span> <span class="token operator">&lt;&lt;</span>ref<span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">PrintRefType</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">&amp;&amp;</span>ref<span class="token punctuation">)</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;rvalue:&quot;</span> <span class="token operator">&lt;&lt;</span>ref<span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> val1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">PrintRefType</span><span class="token punctuation">(</span>val1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// output: lvalue:1</span>
    <span class="token function">PrintRefType</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// output: rvalue:2</span>

    <span class="token keyword">int</span><span class="token operator">&amp;&amp;</span> val2 <span class="token operator">=</span> val1<span class="token punctuation">;</span>  <span class="token comment">// error: rvalue reference to type &#39;int&#39; cannot bind to lvalue of type &#39;int&#39;</span>

    <span class="token keyword">int</span><span class="token operator">&amp;&amp;</span> val3 <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>val1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">PrintRefType</span><span class="token punctuation">(</span>val3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// output: lvalue:1</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>val1</code> 是一个左值</li><li><code>2</code> 是一个右值</li><li><code>int&amp;&amp; val2 = val1;</code> 右值引用不能引用左值，报错 <code>error: rvalue reference to type &#39;int&#39; cannot bind to lvalue of type &#39;int&#39;</code></li><li><code>int&amp;&amp; val3 = std::move(val1);</code> 可以使用 <code>std::move</code> 将左值转化为右值</li></ul><blockquote><p>大佬说过一句话：<strong>右值的概念其实很微妙</strong>，一旦某个右值，有了名字，也就在内存中有了位置，它就变成了一个左值。<strong>但它又是一个很有用的概念</strong>，允许程序员更加细粒度的处理对象拷贝时的内存分配问题，提高了对临时对象和不需要的对象的利用率，极大提高程序的效率。当然，也会引入更多的bug。不过，这就是C++的哲学，什么都允许你做，但出了问题，可别赖C++这门语言。<sup><a href="#ref-11">[11]</a></sup></p></blockquote><h2 id="引用绑定" tabindex="-1"><a class="header-anchor" href="#引用绑定" aria-hidden="true">#</a> 引用绑定</h2><p>「<strong>右值引用</strong>」只能绑定到「<strong>右值</strong>」上</p><p>「<strong>左值引用</strong>」除了可以绑定到「<strong>左值</strong>」上，「<strong>常量左值引用</strong>」还可以绑定到「<strong>右值</strong>」上，但是非常左值引用不可绑定到右值</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code>string <span class="token operator">&amp;</span>s <span class="token operator">=</span> <span class="token string">&quot;hi&quot;</span><span class="token punctuation">;</span>       <span class="token comment">// 非常左值引用 不可 绑定到右值</span>
<span class="token keyword">const</span> string <span class="token operator">&amp;</span>s <span class="token operator">=</span> <span class="token string">&quot;hi&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 常量左值引用 可以 绑定到右值</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>规则简化如下：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code>rvalue reference        <span class="token punctuation">{</span>rvalue<span class="token punctuation">}</span> <span class="token comment">// 右值引用 绑定到 右值</span>
lvalue reference        <span class="token punctuation">{</span>lvalue<span class="token punctuation">}</span> <span class="token comment">// 左值引用 绑定到 左值</span>
<span class="token keyword">const</span> lvalue reference  <span class="token punctuation">{</span>rvalue<span class="token punctuation">}</span> <span class="token comment">// 常量左值引用 绑定到 右值</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>相比之下，声明中带 “&amp;&amp;” 的，可能是lvalue references 或者 rvalue references 的引用可以绑定到任何东西上。这种引用灵活也忒灵活了，值得单独给它们起个名字。我称它们为 <a href="#%E4%B8%87%E8%83%BD%E5%BC%95%E7%94%A8">「<strong>万能引用</strong>」(universal references)</a></p><h2 id="拷贝构造函数和拷贝赋值运算符" tabindex="-1"><a class="header-anchor" href="#拷贝构造函数和拷贝赋值运算符" aria-hidden="true">#</a> 拷贝构造函数和拷贝赋值运算符</h2><h3 id="拷贝构造函数" tabindex="-1"><a class="header-anchor" href="#拷贝构造函数" aria-hidden="true">#</a> 拷贝构造函数</h3><p>当没有自定义拷贝构造函数时，编译器会自动生成一个「<strong>默认拷贝构造函数</strong>」，类似于：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token keyword">const</span> MyClass<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token operator">-&gt;</span>a <span class="token operator">=</span> obj<span class="token punctuation">.</span>a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该函数会将一个对象的数据成员的值拷贝到另一个对象中，但是不会拷贝对象中的指针成员，而是将指针成员的值拷贝到另一个对象中，这样两个对象中的指针成员指向同一个地址，这就是<a href="#%E6%B5%85%E6%8B%B7%E8%B4%9D"><strong>浅拷贝</strong></a>，有时候会导致程序出错。因此需要自定义拷贝构造函数，实现<a href="#%E6%B7%B1%E6%8B%B7%E8%B4%9D"><strong>深拷贝</strong></a>。</p><p>如果不需要编译器自动生成的拷贝构造函数，可以使用 <code>= delete</code> 关键字，例如：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token keyword">const</span> MyClass<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>❓ 哪些是拷贝构造函数</p><p>当函数第一个参数是类的对象的引用，且没有返回值时，该函数就是拷贝构造函数。例如：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token class-name">X</span><span class="token double-colon punctuation">::</span><span class="token function">X</span><span class="token punctuation">(</span>X<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">X</span><span class="token double-colon punctuation">::</span><span class="token function">X</span><span class="token punctuation">(</span><span class="token keyword">const</span> X<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">X</span><span class="token double-colon punctuation">::</span><span class="token function">X</span><span class="token punctuation">(</span><span class="token keyword">volatile</span> X<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">X</span><span class="token double-colon punctuation">::</span><span class="token function">X</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">volatile</span> X<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为什么强调第一个参数呢，因为，下面这些也都是拷贝构造函数：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token class-name">X</span><span class="token double-colon punctuation">::</span><span class="token function">X</span><span class="token punctuation">(</span><span class="token keyword">const</span> X<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//拷贝构造函数</span>
<span class="token class-name">X</span><span class="token double-colon punctuation">::</span><span class="token function">X</span><span class="token punctuation">(</span>X<span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//拷贝构造函数</span>
<span class="token class-name">X</span><span class="token double-colon punctuation">::</span><span class="token function">X</span><span class="token punctuation">(</span>X<span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//拷贝构造函数</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>而<strong>值传递</strong>的不是拷贝构造函数，例如：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token class-name">X</span><span class="token double-colon punctuation">::</span><span class="token function">X</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token class-name">X</span><span class="token double-colon punctuation">::</span><span class="token function">X</span><span class="token punctuation">(</span><span class="token keyword">const</span> X<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">X</span><span class="token double-colon punctuation">::</span><span class="token function">X</span><span class="token punctuation">(</span><span class="token keyword">volatile</span> X<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">X</span><span class="token double-colon punctuation">::</span><span class="token function">X</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">volatile</span> X<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>❓ <strong>为什么呢</strong>。</p><p>因为，值传递的时候，会调用拷贝构造函数，而拷贝构造函数又是值传递，这样就会导致无限递归，直到栈溢出，因此编译器会报错。</p><p>❓<strong>还有一个疑惑</strong>是，拷贝构造函数里能调用了另一个对象的 <code>private</code> 成员变量，这是为什么呢</p><p>实际上，这是对私有成员变量的理解有误，<strong>封装是编译期的概念，是针对类型而非对象的</strong>，在<strong>类的成员函数中可以访问「同类型实例对象」的私有成员变量</strong>，具体参考<a href="#ref-5">[5]</a></p><h3 id="拷贝赋值运算符" tabindex="-1"><a class="header-anchor" href="#拷贝赋值运算符" aria-hidden="true">#</a> 拷贝赋值运算符</h3><p>「<strong>拷贝赋值运算符</strong>」可以看成是一个特殊的拷贝构造函数，当没有重写拷贝赋值运算符时，编译器会自动生成一个「<strong>默认拷贝赋值运算符</strong>」，类似于：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code>MyClass<span class="token operator">&amp;</span> MyClass<span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> MyClass<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
   <span class="token keyword">this</span><span class="token operator">-&gt;</span>a <span class="token operator">=</span> obj<span class="token punctuation">.</span>a<span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果不需要编译器自动生成的赋值构造函数，可以使用 <code>= delete</code> 关键字，例如：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    MyClass<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> MyClass<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="拷贝构造函数和拷贝赋值运算符的区别" tabindex="-1"><a class="header-anchor" href="#拷贝构造函数和拷贝赋值运算符的区别" aria-hidden="true">#</a> 拷贝构造函数和拷贝赋值运算符的区别</h3><p>「<strong>拷贝赋值运算符</strong>」和「<strong>拷贝构造函数</strong>」都是用来初始化一个对象，但是「<strong>赋值构造函数</strong>」是用来初始化一个已经存在的对象，而「<strong>拷贝构造函数</strong>」是用来初始化一个新的对象。</p><p>例如，如下的例子使用的是「<strong>拷贝构造函数</strong>」：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code>MyClass obj1<span class="token punctuation">;</span>       <span class="token comment">// 调用默认构造函数</span>
MyClass <span class="token function">obj2</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>
MyClass obj2 <span class="token operator">=</span> obj1<span class="token punctuation">;</span>
MyClass obj3 <span class="token operator">=</span> <span class="token function">MyClass</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>
MyClass obj4 <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>
MyClass obj5 <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token function">MyClass</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
MyClass <span class="token operator">*</span>p_obj6 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MyClass</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如下的例子使用的是「<strong>拷贝赋值运算符</strong>」：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code>MyClass obj1<span class="token punctuation">;</span>   <span class="token comment">// 调用默认构造函数</span>
MyClass obj2<span class="token punctuation">;</span>   <span class="token comment">// 调用默认构造函数</span>
obj2 <span class="token operator">=</span> obj1<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="深拷贝" tabindex="-1"><a class="header-anchor" href="#深拷贝" aria-hidden="true">#</a> 深拷贝</h3><p>考虑这个例子，编译器会为我们自动生成一个拷贝构造函数</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> a<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> count<span class="token punctuation">;</span>   <span class="token comment">// 静态成员</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> count<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token operator">~</span><span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> count<span class="token operator">--</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> count<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> MyClass<span class="token double-colon punctuation">::</span>count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// 静态成员初始化（必须在类外）</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    MyClass mc1<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token class-name">MyClass</span><span class="token double-colon punctuation">::</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">// 1</span>
    MyClass <span class="token function">mc2</span><span class="token punctuation">(</span>mc1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token class-name">MyClass</span><span class="token double-colon punctuation">::</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">// 1</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这时候出现的问题是，输出都是 1 ，这会导致在析构的时候，会使得 <code>count</code> 为 -1，这是不符合预期的</p><p>这是因为在默认拷贝构造函数中，只是简单的将 <code>mc1</code> 的值赋值给 <code>mc2</code>，这样 <code>mc1</code> 和 <code>mc2</code> 的 <code>count</code> 都指向同一个地址，因此在析构的时候，会导致 <code>count</code> 减少两次，因此 <code>count</code> 为 -1</p><p>为此，需要自定义拷贝构造函数，实现深拷贝。这时候再输出 <code>count</code> 就是 2 了</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token keyword">const</span> MyClass<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token operator">-&gt;</span>a <span class="token operator">=</span> obj<span class="token punctuation">.</span>a<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token operator">-&gt;</span>count<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="浅拷贝" tabindex="-1"><a class="header-anchor" href="#浅拷贝" aria-hidden="true">#</a> 浅拷贝</h3><p>考虑下面这个例子，编译器生成的拷贝构造函数，会将 <code>mc1</code> 的 <code>p</code> 的值赋值给 <code>mc2</code> 的 <code>p</code>，这样 <code>mc1</code> 和 <code>mc2</code> 的 <code>p</code> 都指向同一个地址，因此在析构的时候，会导致 <code>p</code> 被释放两次，因此会报错</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> a<span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
  <span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token operator">~</span><span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token function">assert</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-&gt;</span>p<span class="token operator">!</span> <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>p<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  MyClass mc1<span class="token punctuation">;</span>
  MyClass <span class="token function">mc2</span><span class="token punctuation">(</span>mc1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为此，需要自定义拷贝构造函数，为 <code>p</code> 重新分配内存，实现深拷贝</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token keyword">const</span> MyClass<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token operator">-&gt;</span>a <span class="token operator">=</span> obj<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token operator">-&gt;</span>p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token keyword">this</span><span class="token operator">-&gt;</span>p <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="拷贝构造函数的应用" tabindex="-1"><a class="header-anchor" href="#拷贝构造函数的应用" aria-hidden="true">#</a> 拷贝构造函数的应用</h3><ul><li>从 <a href="#%E6%B7%B1%E6%8B%B7%E8%B4%9D">深拷贝</a> 的例子中可以看出，当「<strong>数据成员中有静态成员</strong>」时，需要考虑自定义拷贝构造函数，处理静态成员</li><li>从 <a href="#%E6%B5%85%E6%8B%B7%E8%B4%9D">浅拷贝</a> 的例子中可以看出，当「<strong>数据成员中有指针</strong>」时，必须要用「<strong>深拷贝</strong>」</li></ul><h2 id="移动语义" tabindex="-1"><a class="header-anchor" href="#移动语义" aria-hidden="true">#</a> 移动语义</h2><p>移动语义的出现实际上是为了解决拷贝构造函数的问题，因为拷贝构造函数会造成额外的开销，而移动语义可以避免这种额外的开销。</p><p>考虑下面这个例子<sup><a href="#ref-6">[6]</a></sup></p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>string str<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token operator">:</span> str<span class="token punctuation">{</span> s <span class="token punctuation">}</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>MyClass<span class="token operator">&gt;</span> mc_list<span class="token punctuation">;</span>
    MyClass tmp<span class="token punctuation">{</span> <span class="token string">&quot;hello&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    mc_list<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// tmp 是一个左值，拷贝</span>
    mc_list<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// tmp 是一个左值，拷贝</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>每次 <code>push_back</code> 的时候，都会发生一次拷贝操作，在两次添加后，<code>tmp</code> 的生命周期即将结束，那么你不能将 <code>tmp</code> 的内存“移动”到 <code>mc_list</code> 中吗？这样就可以避免额外的拷贝操作了</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>MyClass<span class="token operator">&gt;</span> mc_list<span class="token punctuation">;</span>
    MyClass tmp<span class="token punctuation">{</span> <span class="token string">&quot;hello&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    mc_list<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// tmp 是一个左值，拷贝</span>
    mc_list<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 将左值转化为右值</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里的 <code>std::move</code> 就是移动语义，将左值转化为右值，这样就可以避免额外的拷贝操作了，为什么呢？因为 <code>std::vector</code> 的 <code>push_back</code> 针对<strong>左值 (拷贝)</strong> 和<strong>右值 (移动)</strong> 有不同的实现，查看的源码 (Apple Clang 14.0)：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">// 前面有 `typedef const value_type&amp;  const_reference;`</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Allocator</span><span class="token operator">&gt;</span>
_LIBCPP_CONSTEXPR_SINCE_CXX20
<span class="token keyword">inline</span> _LIBCPP_HIDE_FROM_ABI
<span class="token keyword">void</span> <span class="token class-name">vector</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Allocator<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">push_back</span><span class="token punctuation">(</span>const_reference __x<span class="token punctuation">)</span> <span class="token comment">// 左值引用</span>
<span class="token punctuation">{</span>   <span class="token comment">// 执行拷贝操作</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-&gt;</span>__end_ <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span><span class="token function">__end_cap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">__construct_one_at_end</span><span class="token punctuation">(</span>__x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">__push_back_slow_path</span><span class="token punctuation">(</span>__x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Allocator</span><span class="token operator">&gt;</span>
_LIBCPP_CONSTEXPR_SINCE_CXX20
<span class="token keyword">inline</span> _LIBCPP_HIDE_FROM_ABI
<span class="token keyword">void</span> <span class="token class-name">vector</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Allocator<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">push_back</span><span class="token punctuation">(</span>value_type<span class="token operator">&amp;&amp;</span> __x<span class="token punctuation">)</span> <span class="token comment">// 右值引用</span>
<span class="token punctuation">{</span>   <span class="token comment">// 执行移动操作</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-&gt;</span>__end_ <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span><span class="token function">__end_cap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">__construct_one_at_end</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>__x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">__push_back_slow_path</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>__x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>总结一下，就是移动语义 <code>std::move</code> 可以将左值转化为右值，这样就可以避免额外的拷贝操作了</p><h2 id="移动构造函数" tabindex="-1"><a class="header-anchor" href="#移动构造函数" aria-hidden="true">#</a> 移动构造函数</h2><p>还是上面的类，我们增加「<strong>移动构造函数</strong>」，移动构造函数接受一个右值引用，例如：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>string str<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token operator">:</span> str<span class="token punctuation">{</span> s <span class="token punctuation">}</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 移动构造函数</span>
    <span class="token function">MyClass</span><span class="token punctuation">(</span>MyClass<span class="token operator">&amp;&amp;</span> rValue<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token comment">// noexcept</span>
    <span class="token operator">:</span> str<span class="token punctuation">{</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>rValue<span class="token punctuation">.</span>str<span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>有了移动构造函数之后，就可以通过它来创建新的对象，避免拷贝操作的开销</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code>MyClass tmp<span class="token punctuation">{</span> <span class="token string">&quot;hello&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
MyClass A<span class="token punctuation">{</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// 调用移动构造函数</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>注意 <code>noexcept</code> 说明符是我们对于不会抛出异常的保证，如果在执行的过程中有异常被抛出了，应用程序将会直接终止执行。也就是告知编译器，我们的移动构造函数不会抛出异常，可以放心使用</p><h2 id="万能引用" tabindex="-1"><a class="header-anchor" href="#万能引用" aria-hidden="true">#</a> 万能引用</h2><p>考虑下面的例子<sup><a href="#ref-7">[7]</a></sup>，用到的函数 <code>type_to_string</code> 参考 <sup><a href="#ref-8">[8]</a></sup></p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code>string <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">&amp;</span>a<span class="token punctuation">)</span>  <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;lvalue&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
string <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">&amp;&amp;</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;rvalue&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">&amp;&amp;</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cout <span class="token operator">&lt;&lt;</span> boolalpha<span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token generic-function"><span class="token function">type_to_string</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;, &quot;</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> is_lvalue_reference<span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;, &quot;</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token function">g</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 报错，无法将左值绑定到右值引用</span>
    <span class="token function">g</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// output: int&amp;&amp;, true, lvalue</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述例子过程如下：</p><ul><li>因为传入的是一个纯右值 <code>10</code> ，因为传入后就“不存在”了，因此被隐式地转换为将亡值</li><li>函数参数中，<code>10</code> 被绑定到右值引用 <code>a</code> (推导为 <code>int&amp;&amp;</code>)。所以这里输出 <code>int&amp;&amp;</code></li><li>右值引用 <code>a</code> 是一个左值(推导为 <code>int&amp;</code>)，所以输出 <code>lvalue</code>。所以这里输出 <code>true</code></li><li>根据 <code>a</code> 的类型重载，调用 <code>f(int &amp;a)</code>，所以输出 <code>lvalue</code></li></ul><p>所以可以看出，函数的左值引用和右值引用的重载，所依据的是「<strong>值的类型</strong>」，而不是表达式的类型</p><p>然而实际上我们并不关心值的类型，而是关心表达式所持有的资源能不能获取。对于一个函数所接受的参数，我们可以将其分为两类：</p><ul><li><strong>左值</strong>：我们无法获取其资源，因为其资源可能被其他对象所持有</li><li><strong>将亡值</strong>：我们可以获取其资源，因为其资源即将被销毁，因此可以直接拿来使用</li></ul><p>对于这两种情况，需要加以区分。但是我们希望将两个重载函数合并为一个函数模板，</p><p>第一步，需要引入「<strong>万能引用</strong>」推导表达式的值类型，万能引用需要借助于模板，也就是 <code>T&amp;&amp;</code></p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">// `constexpr` compiled with -std=c++17</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
string <span class="token function">f</span><span class="token punctuation">(</span>T<span class="token operator">&amp;&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token keyword">constexpr</span><span class="token punctuation">(</span>is_lvalue_reference<span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;lvalue&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> 
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token keyword">constexpr</span> <span class="token punctuation">(</span>is_rvalue_reference<span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;rvalue&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里的 <code>T&amp;&amp;</code> 可以根据传入的参数推导出类型 （这里涉及到<a href="#%E5%BC%95%E7%94%A8%E6%8A%98%E5%8F%A0"><strong>引用折叠</strong></a>）</p><ul><li>当传入的是<strong>左值</strong>时，<code>T</code> 推导为左值引用 <code>T&amp;</code>。</li><li>当传入的是<strong>将亡值</strong>时，<code>T</code> 推导为右值引用 <code>T&amp;&amp;</code>。</li></ul><p>所以，最后 <code>a</code> 的类型只与传入表达式的值类型有关，但是不管传入表达式的值类型是什么， <code>a</code> 的值类型都会变为左值</p><p>第二步，将 <code>a</code> 的值类型与表达式的值类型进行同步，那么我们就可以利用 <code>decltype(a)</code> 来获取值类型，并且利用 <code>static_cast&lt;decltype(a)&gt;(a)</code> 来将 <code>a</code> 的类型转化为 <code>a</code> 的值类型。</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
string <span class="token function">f</span><span class="token punctuation">(</span>T<span class="token operator">&amp;&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token keyword">constexpr</span><span class="token punctuation">(</span>is_lvalue_reference<span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;lvalue&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> 
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token keyword">constexpr</span><span class="token punctuation">(</span>is_rvalue_reference<span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;rvalue&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这时候调用</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// output: lvalue</span>
            <span class="token function">f</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// output: lvalue</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>表达式很长，需要解释一下 <code>is_lvalue_reference&lt;decltype((static_cast&lt;decltype(a)&gt;(a)))&gt;::value</code> 是个什么东西。</p><ol><li><p>首先，<code>decltype(a)</code> 是获取 <code>a</code> 的值类型</p></li><li><p><code>static_cast&lt;decltype(a)&gt;(a)</code> 是将 <code>a</code> 的类型转化为 <code>a</code> 的值类型</p></li><li><p><code>decltype((...))</code> 是 <code>static_cast&lt;decltype(a)&gt;(a)</code> 的值类型</p></li><li><p><code>is_lvalue_reference&lt;...&gt;::value</code> 是判断 <code>decltype((...))</code> 的值类型是否为左值引用，也就是 <code>static_cast&lt;decltype(a)&gt;(a)</code> 的值类型是否为左值引用，也就是 <code>a</code> 的值类型是否为左值引用</p></li></ol><blockquote><p><code>decltype(a)</code> 是获取 <code>a</code> 的值类型，<code>decltype((a))</code> 是获取 <code>a</code> 的引用类型，<a href="https://segmentfault.com/q/1010000000516149" target="_blank" rel="noopener noreferrer">“C++ decltype((i))为什么是个引用？”</a></p></blockquote><h2 id="引用折叠" tabindex="-1"><a class="header-anchor" href="#引用折叠" aria-hidden="true">#</a> 引用折叠</h2><p>引用折叠(reference collapsing) 是 C++11 中的一个新特性，它是为了解决万能引用中的问题而出现的。引用折叠的规则如下：</p><table><thead><tr><th>模板类型</th><th>T 实际类型</th><th>最终类型</th></tr></thead><tbody><tr><td><code>T&amp;</code></td><td><code>R</code></td><td><code>R&amp;</code></td></tr><tr><td><code>T&amp;</code></td><td><code>R&amp;</code></td><td><code>R&amp;</code></td></tr><tr><td><code>T&amp;</code></td><td><code>R&amp;&amp;</code></td><td><code>R&amp;</code></td></tr><tr><td><code>T&amp;&amp;</code></td><td><code>R</code></td><td><code>R&amp;&amp;</code></td></tr><tr><td><code>T&amp;&amp;</code></td><td><code>R&amp;</code></td><td><code>R&amp;</code></td></tr><tr><td><code>T&amp;&amp;</code></td><td><code>R&amp;&amp;</code></td><td><code>R&amp;&amp;</code></td></tr></tbody></table><blockquote><p>实际上，只要左值引用会传染，沾上一个左值引用就变左值引用了<sup><a href="#ref-9">[9]</a></sup></p></blockquote><p>根本原因是因为 C++ 中禁止 reference to reference ，所以编译器需要对四种情况(也就是 L2L,L2R,R2L,R2R )进行处理，将他们“折叠”(也可说是“坍缩”)成一种单一的 reference 。<sup><a href="#ref-9">[9]</a></sup></p><p>这时候我们再来看这一段代码</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
string <span class="token function">f</span><span class="token punctuation">(</span>T<span class="token operator">&amp;&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>解释一下两次调用实际发生了什么，</p><ul><li><code>int x = 20; f(x);</code> 传入函数的 <code>b</code> 是一个左值(<code>R</code>)，模板类型是一个万能引用 <code>T&amp;&amp;</code>，因此 <code>T</code> 推导为左值引用 <code>T&amp;</code>，因此 <code>a</code> 的类型为 <code>T&amp;</code></li><li><code>f(10);</code> 传入函数的 <code>10</code> 是一个纯右值，因此被隐式地转换为将亡值(<code>R</code>)，模板类型是一个万能引用 <code>T&amp;&amp;</code>，因此 <code>T</code> 推导为右值引用 <code>T&amp;&amp;</code>，因此 <code>a</code> 的类型为 <code>T&amp;&amp;</code></li></ul><h2 id="完美转发" tabindex="-1"><a class="header-anchor" href="#完美转发" aria-hidden="true">#</a> 完美转发</h2><p>在<a href="#%E4%B8%87%E8%83%BD%E5%BC%95%E7%94%A8"><strong>万能引用</strong></a>中，出现了一个 <code>is_lvalue_reference&lt;decltype((static_cast&lt;decltype(a)&gt;(a)))&gt;::value</code>，其中最重要的是 <code>static_cast&lt;decltype(a)&gt;(a)</code>，其目的是将 <code>a</code> 的类型转化为 <code>a</code> 的值类型，这种转化就是「<strong>完美转发</strong>」，也就是<code>std::forward&lt;T&gt;(a)</code>，其源码 (Apple Clang 14.0) 如下</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token operator">&gt;</span>
_LIBCPP_NODISCARD_EXT <span class="token keyword">inline</span> _LIBCPP_HIDE_FROM_ABI _LIBCPP_CONSTEXPR _Tp<span class="token operator">&amp;&amp;</span>
<span class="token function">forward</span><span class="token punctuation">(</span>_LIBCPP_LIFETIMEBOUND __libcpp_remove_reference_t<span class="token operator">&lt;</span>_Tp<span class="token operator">&gt;</span><span class="token operator">&amp;</span> __t<span class="token punctuation">)</span> _NOEXCEPT <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>_Tp<span class="token operator">&amp;&amp;</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>__t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token operator">&gt;</span>
_LIBCPP_NODISCARD_EXT <span class="token keyword">inline</span> _LIBCPP_HIDE_FROM_ABI _LIBCPP_CONSTEXPR _Tp<span class="token operator">&amp;&amp;</span>
<span class="token function">forward</span><span class="token punctuation">(</span>_LIBCPP_LIFETIMEBOUND __libcpp_remove_reference_t<span class="token operator">&lt;</span>_Tp<span class="token operator">&gt;</span><span class="token operator">&amp;&amp;</span> __t<span class="token punctuation">)</span> _NOEXCEPT <span class="token punctuation">{</span>
  <span class="token keyword">static_assert</span><span class="token punctuation">(</span><span class="token operator">!</span>is_lvalue_reference<span class="token operator">&lt;</span>_Tp<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">,</span> <span class="token string">&quot;cannot forward an rvalue as an lvalue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>_Tp<span class="token operator">&amp;&amp;</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>__t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看出，其原理实际上就是 <code>static_cast&lt;_Tp&amp;&amp;&gt;(__t)</code>，这里的 <code>_Tp</code> 就是 <code>T</code>，也就是 <code>a</code> 的值类型，<code>__t</code> 就是 <code>a</code>，也就是 <code>a</code> 的引用类型，因此 <code>static_cast&lt;_Tp&amp;&amp;&gt;(__t)</code> 就是将 <code>a</code> 的引用类型转化为 <code>a</code> 的值类型，这就是「<strong>完美转发</strong>」。</p><p>所以上述代码可以简化为</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">f1</span><span class="token punctuation">(</span>T<span class="token operator">&amp;&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token keyword">constexpr</span><span class="token punctuation">(</span>is_lvalue<span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;lvalue&quot;</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token keyword">constexpr</span><span class="token punctuation">(</span>is_xvalue<span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;xvalue&quot;</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的例子有些许复杂，我们在看一个简单的例子<sup><a href="#ref-11">[11]</a></sup></p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">getR</span><span class="token punctuation">(</span>T<span class="token operator">&amp;</span> t<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;lvalueR&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">getR</span><span class="token punctuation">(</span>T<span class="token operator">&amp;&amp;</span> t<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;rvalueR&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">testForward</span><span class="token punctuation">(</span>T<span class="token operator">&amp;&amp;</span> v<span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token function">print</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// v 已经是个左值，永远调用左值版本</span>
    <span class="token function">print</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 永远调用右值版本</span>
    <span class="token function">print</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 取决于实参的类型</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">testForward</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">//实参为左值，调用左值版本</span>
    <span class="token function">testForward</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//实参为右值，调用右值版本</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个例子就比较清楚了，<code>std::forward&lt;T&gt;(v)</code> 就是将 <code>v</code> 的引用类型转化为 <code>v</code> 的值类型，其调用哪一个重载函数，取决于传递进来的参数是左值还是右值</p><ul><li><p>这个例子其实体现了「<strong>完美转发存在的意义</strong>」，那就是你可以用不上，但不能没有的“功能”。只要你的函数接受了通用引用，又需要把这些通用引用传递给下一层函数，就必须依靠完美转发。<sup><a href="#ref-10">[10]</a></sup></p></li><li><p>那么「<strong>使用完美转发的意义</strong>」就是和设计模式相关的问题了。你可以把所有操作写在一个函数里，也可以分散到多个函数。但只要你分散了，遇到需要传递通用引用到下一层的情况就是难免的了。<sup><a href="#ref-10">[10]</a></sup></p></li></ul><p>「<strong>完美转发</strong>」基于「<strong>万能引用</strong>」，「<strong>引用折叠</strong>」以及「<strong><code>std::forward</code></strong>」。完美转发机制，是为了将左值和右值统一处理，节约代码量，而只有万能引用会出现同时接受左值和右值的情况，所以完美转发只存在于万能引用中。<sup><a href="#ref-11">[11]</a></sup></p><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考" aria-hidden="true">#</a> 参考</h2><ul><li><p><span id="ref-1"></span>[1] <a href="https://en.cppreference.com" target="_blank" rel="noopener noreferrer">cppreference.com</a></p></li><li><p><span id="ref-2"></span>[2] <a href="https://eli.thegreenplace.net/2011/12/15/understanding-lvalues-and-rvalues-in-c-and-c/" target="_blank" rel="noopener noreferrer">Understanding lvalues and rvalues in C and C++</a></p></li><li><p><span id="ref-3"></span>[3] <a href="https://changkun.de/modern-cpp/en-us/03-runtime/#3-3-rvalue-Reference" target="_blank" rel="noopener noreferrer">MODERN C++ TUTORIAL: C++ 11/14/17/20 ON THE FLY(SECOND EDITION) Changkun Ou</a></p></li><li><p><span id="ref-4"></span>[4] <a href="https://zhuanlan.zhihu.com/p/378951486" target="_blank" rel="noopener noreferrer">CPP 复制构造函数/赋值运算符？傻傻分不清楚 - 知乎</a></p></li><li><p><span id="ref-5"></span>[5] <a href="https://blog.csdn.net/ganwenbo2011/article/details/100919900" target="_blank" rel="noopener noreferrer">为什么C++中复制构造函数可以访问参数对象的私有成员</a></p></li><li><p><span id="ref-6"></span>[6] <a href="https://zhuanlan.zhihu.com/p/455848360" target="_blank" rel="noopener noreferrer">弘竣：一文入魂：妈妈再也不担心我不懂C++移动语义了 - 知乎</a>：讲得非常详细的文章，推荐</p></li><li><p><span id="ref-7"></span>[7] <a href="https://zhuanlan.zhihu.com/p/435689642" target="_blank" rel="noopener noreferrer">auto&amp;&amp;、万能引用和完美转发 - 知乎</a></p></li><li><p><span id="ref-8"></span>[8] <a href="https://zhuanlan.zhihu.com/p/435605194" target="_blank" rel="noopener noreferrer">如何确定表达式的值类型？ - 知乎</a></p></li><li><p><span id="ref-9"></span>[9] <a href="https://www.zhihu.com/question/40346748" target="_blank" rel="noopener noreferrer">如何理解c++中的引用折叠? - 知乎</a></p></li><li><p><span id="ref-10"></span>[10] <a href="https://www.zhihu.com/question/348291815" target="_blank" rel="noopener noreferrer">C++完美转发是否是多此一举? - 知乎</a></p></li><li><p><span id="ref-11"></span>[11] <a href="https://zhuanlan.zhihu.com/p/369203981" target="_blank" rel="noopener noreferrer">谈谈完美转发(Perfect Forwarding)：完美转发 = 引用折叠 + 万能引用 + std::forward - 知乎</a></p></li><li><p><span id="ref"></span><a href="https://www.zhihu.com/question/567388005" target="_blank" rel="noopener noreferrer">为什么快2023年了三大编译器厂商还没完成c++20的所有新特性? - 知乎</a></p></li></ul></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg><a class="external-link meta-item-label" href="https://github.com/HenryZhuHR/henryzhuhr.github.io/edit/main/docs/program/cpp/rvalue/rvalue.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub"><!--[--><!--]--><!----><span>Edit this page on GitHub</span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><!----></footer><!----><!--[--><div class="pager"><a href="/program/cpp/lambda/lambda.html" class="prev">Previous <br><span>Lambda 表达式</span></a><a href="/logs/wuhan23_sunset/wuhan23_sunset.html" class="next">Next <br><span>23年武汉盛夏</span></a></div><!--]--><!----></main><ul class="catalog" style="top:0px;"><li class="level-2 toc-link-左值和右值">左值和右值</li><li class="level-2 toc-link-左值引用">左值引用</li><li class="level-2 toc-link-右值引用">右值引用</li><li class="level-2 toc-link-引用绑定">引用绑定</li><li class="level-2 toc-link-拷贝构造函数和拷贝赋值运算符">拷贝构造函数和拷贝赋值运算符</li><li class="level-3 toc-link-拷贝构造函数">拷贝构造函数</li><li class="level-3 toc-link-拷贝赋值运算符">拷贝赋值运算符</li><li class="level-3 toc-link-拷贝构造函数和拷贝赋值运算符的区别">拷贝构造函数和拷贝赋值运算符的区别</li><li class="level-3 toc-link-深拷贝">深拷贝</li><li class="level-3 toc-link-浅拷贝">浅拷贝</li><li class="level-3 toc-link-拷贝构造函数的应用">拷贝构造函数的应用</li><li class="level-2 toc-link-移动语义">移动语义</li><li class="level-2 toc-link-移动构造函数">移动构造函数</li><li class="level-2 toc-link-万能引用">万能引用</li><li class="level-2 toc-link-引用折叠">引用折叠</li><li class="level-2 toc-link-完美转发">完美转发</li><li class="level-2 toc-link-参考">参考</li></ul></div><!--]--></div><div class="search-page" role="search"><span class="search-close"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="28" height="28" fill="currentColor"><path d="M224 416c-8.188 0-16.38-3.125-22.62-9.375l-192-192c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L224 338.8l169.4-169.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-192 192C240.4 412.9 232.2 416 224 416z"></path></svg></span><div class="gungnir-search-box"><input placeholder="$ grep ..." autocomplete="off" spellcheck="false" value><!----></div></div><div class="menu-btn-container"><div class="menu-btn-wrapper"><div class="menu-btn"><div style="" class="menu-btn-icon"><span></span><span></span><span></span></div><div style="display:none;" class="menu-text">0</div><svg class="menu-progress"><circle class="menu-border" cx="50%" cy="50%" r="48%" style="stroke-dasharray:0% 314.15926%;"></circle></svg></div><div class="menu-btn-child-wrapper"><div title="toggle color mode" class="menu-btn-child"><svg class="ov-icon" style="font-size:1.2em;display:none;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M256 160c-52.9 0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0-49.9-49.9-49.9-131.1 0-181 49.9-49.9 131.1-49.9 181 0 49.9 49.9 49.9 131.1 0 181z"/></svg><svg class="ov-icon" style="font-size:1.2em;display:none;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 00283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"/></svg><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M224 96l16-32 32-16-32-16-16-32-16 32-32 16 32 16 16 32zM80 160l26.66-53.33L160 80l-53.34-26.67L80 0 53.34 53.33 0 80l53.34 26.67L80 160zm352 128l-26.66 53.33L352 368l53.34 26.67L432 448l26.66-53.33L512 368l-53.34-26.67L432 288zm70.62-193.77L417.77 9.38C411.53 3.12 403.34 0 395.15 0c-8.19 0-16.38 3.12-22.63 9.38L9.38 372.52c-12.5 12.5-12.5 32.76 0 45.25l84.85 84.85c6.25 6.25 14.44 9.37 22.62 9.37 8.19 0 16.38-3.12 22.63-9.37l363.14-363.15c12.5-12.48 12.5-32.75 0-45.24zM359.45 203.46l-50.91-50.91 86.6-86.6 50.91 50.91-86.6 86.6z"/></svg></div><div class="menu-btn-child"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"/></svg></div><div class="menu-btn-child"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z"/></svg></div><div class="menu-btn-child menu-toc-btn"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M48 48a48 48 0 1048 48 48 48 0 00-48-48zm0 160a48 48 0 1048 48 48 48 0 00-48-48zm0 160a48 48 0 1048 48 48 48 0 00-48-48zm448 16H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16v-32a16 16 0 00-16-16zm0-320H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16V80a16 16 0 00-16-16zm0 160H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16v-32a16 16 0 00-16-16z"/></svg></div><div class="toggle-sidebar-button menu-btn-child menu-btn-sidebar" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-1.6 -1.6 19.2 19.2" fill="currentColor"><path d="M14 2a1 1 0 011 1v10a1 1 0 01-1 1H2a1 1 0 01-1-1V3a1 1 0 011-1h12zM2 1a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V3a2 2 0 00-2-2H2z"/><path d="M3 4a1 1 0 011-1h2a1 1 0 011 1v8a1 1 0 01-1 1H4a1 1 0 01-1-1V4z"/></svg></div></div></div></div><footer class="footer"><span>
        &copy; <a href="https://github.com/HenryZhuHR" target="_blank">HenryZhuHR</a> 2022-today
        <br>
        Powered by <a href="https://v2.vuepress.vuejs.org" target="_blank">VuePress</a> &
        <a href="https://github.com/Renovamen/vuepress-theme-gungnir" target="_blank">Gungnir</a>
      </span></footer></div><!--]--></div>
    <script type="module" src="/assets/app.1fb5ba75.js" defer></script>
  </body>
</html>
