<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.49">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" type="image/png" sizes="32x32" href="/images/global/avatar-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/global/avatar-16x16.png"><meta name="application-name" content="Henry Zhu"><meta name="apple-mobile-web-app-title" content="Henry Zhu"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="apple-touch-icon" href="/images/global/avatar.png"><meta name="theme-color" content="#377bb5"><meta name="msapplication-TileColor" content="#377bb5"><title>一切为了减少拷贝 | Henry Zhu</title><meta name="description" content="">
    <link rel="modulepreload" href="/assets/app.1aef078d.js"><link rel="modulepreload" href="/assets/rvalue.html.c752bebc.js"><link rel="modulepreload" href="/assets/rvalue.html.a233212a.js"><link rel="prefetch" href="/assets/offer.html.f10949ca.js"><link rel="prefetch" href="/assets/resume.html.083c40db.js"><link rel="prefetch" href="/assets/deeplearning.html.79a10a98.js"><link rel="prefetch" href="/assets/about.html.7525c1d6.js"><link rel="prefetch" href="/assets/index.html.e9812dca.js"><link rel="prefetch" href="/assets/cpu.html.32de7515.js"><link rel="prefetch" href="/assets/process.html.9ddf1941.js"><link rel="prefetch" href="/assets/mysql.html.62c63f1c.js"><link rel="prefetch" href="/assets/obsidian.html.8e418f39.js"><link rel="prefetch" href="/assets/DiffusionModel.html.cb5c8761.js"><link rel="prefetch" href="/assets/index.html.c3e4888f.js"><link rel="prefetch" href="/assets/basic.html.f70527e8.js"><link rel="prefetch" href="/assets/classification.html.aace3a58.js"><link rel="prefetch" href="/assets/classifier.html.bee18005.js"><link rel="prefetch" href="/assets/cnn.html.e75c50b3.js"><link rel="prefetch" href="/assets/gan.html.4612367b.js"><link rel="prefetch" href="/assets/FaceAssign.html.566c434c.js"><link rel="prefetch" href="/assets/Initialization.html.273bacc8.js"><link rel="prefetch" href="/assets/MetricLearning.html.61f59963.js"><link rel="prefetch" href="/assets/ema.html.45efd9f0.js"><link rel="prefetch" href="/assets/mlp.html.0a9533c0.js"><link rel="prefetch" href="/assets/nlp.html.cb42db0d.js"><link rel="prefetch" href="/assets/norm.html.fc18b7b1.js"><link rel="prefetch" href="/assets/object_dection.html.3b98c5b8.js"><link rel="prefetch" href="/assets/fine_tune.html.99a7d88a.js"><link rel="prefetch" href="/assets/pytorch-install.html.3a13dea0.js"><link rel="prefetch" href="/assets/train.html.df8d70ba.js"><link rel="prefetch" href="/assets/transformer.html.3b0f3f23.js"><link rel="prefetch" href="/assets/index.html.06ab2aa9.js"><link rel="prefetch" href="/assets/对抗纹理.html.15d42d09.js"><link rel="prefetch" href="/assets/2019ICML_Zhang_TRADES.html.9a493929.js"><link rel="prefetch" href="/assets/2019_Shafahi_LS.html.1420b7e4.js"><link rel="prefetch" href="/assets/2020ICML_Rice_RobustOverfitting.html.0bb27983.js"><link rel="prefetch" href="/assets/2020NIPS_Pang_HE.html.d06b5555.js"><link rel="prefetch" href="/assets/2021CVPR_Luo_Diffusion3DPointCloud.html.d2639f3c.js"><link rel="prefetch" href="/assets/2021ICML_radford_CLIP.html.b43926dc.js"><link rel="prefetch" href="/assets/AdversarialTraining.html.2a70a74a.js"><link rel="prefetch" href="/assets/StyleGAN2.html.b49e6de5.js"><link rel="prefetch" href="/assets/latex.html.bfbaf7e4.js"><link rel="prefetch" href="/assets/backtracking.html.476c6b65.js"><link rel="prefetch" href="/assets/dp.html.6cecfc6d.js"><link rel="prefetch" href="/assets/monotonic_stack.html.a1a506bc.js"><link rel="prefetch" href="/assets/wuhan23_sunset.html.70aa9960.js"><link rel="prefetch" href="/assets/多卡训练.html.4cd57f68.js"><link rel="prefetch" href="/assets/index.html.26bee13a.js"><link rel="prefetch" href="/assets/conda.html.ffcdad64.js"><link rel="prefetch" href="/assets/CXX.html.13597de2.js"><link rel="prefetch" href="/assets/deploy.html.da7b2687.js"><link rel="prefetch" href="/assets/mAP.html.e68f496b.js"><link rel="prefetch" href="/assets/design_pattern.html.c6007362.js"><link rel="prefetch" href="/assets/freertos.html.055fbecd.js"><link rel="prefetch" href="/assets/command.html.d90748e1.js"><link rel="prefetch" href="/assets/git-zhihu.html.85bf37a1.js"><link rel="prefetch" href="/assets/git.html.ccc11723.js"><link rel="prefetch" href="/assets/github.html.c528895a.js"><link rel="prefetch" href="/assets/http.html.39be9feb.js"><link rel="prefetch" href="/assets/linux-ubuntu.html.bfbd915a.js"><link rel="prefetch" href="/assets/linux.html.d48fd7e2.js"><link rel="prefetch" href="/assets/macos.html.29d15d55.js"><link rel="prefetch" href="/assets/mosquitto.html.fa0ef666.js"><link rel="prefetch" href="/assets/index.html.8e6243f9.js"><link rel="prefetch" href="/assets/openvino.html.60dab996.js"><link rel="prefetch" href="/assets/list.html.af0675c5.js"><link rel="prefetch" href="/assets/python.html.ac62dbe0.js"><link rel="prefetch" href="/assets/OpenWRT.html.9db01f22.js"><link rel="prefetch" href="/assets/homeAssistant-zhihu.html.aa06fe39.js"><link rel="prefetch" href="/assets/homeAssistant.html.62ff3213.js"><link rel="prefetch" href="/assets/icm20602.html.f711c406.js"><link rel="prefetch" href="/assets/raspberrypi.html.b946feca.js"><link rel="prefetch" href="/assets/server.html.8ca5b072.js"><link rel="prefetch" href="/assets/ros2.html.6892ad4a.js"><link rel="prefetch" href="/assets/rtmp.html.949ef5fe.js"><link rel="prefetch" href="/assets/ssh.html.0e31ad5f.js"><link rel="prefetch" href="/assets/Vue-init.html.6c28841f.js"><link rel="prefetch" href="/assets/index.html.2cb6f90d.js"><link rel="prefetch" href="/assets/CodiMD.html.05d19d7c.js"><link rel="prefetch" href="/assets/PromptEngineering.html.9f8329ef.js"><link rel="prefetch" href="/assets/QQ-GPT.html.918345a6.js"><link rel="prefetch" href="/assets/utm串口挂载.html.f5014fdf.js"><link rel="prefetch" href="/assets/BlenderPython.html.92c1957b.js"><link rel="prefetch" href="/assets/ContentAuthoring-vehicles.html.1bb7d537.js"><link rel="prefetch" href="/assets/apis.html.b65023c7.js"><link rel="prefetch" href="/assets/carla-zhihu.html.0d10ecbd.js"><link rel="prefetch" href="/assets/carla.html.2861d299.js"><link rel="prefetch" href="/assets/python-api.html.4bdc72ca.js"><link rel="prefetch" href="/assets/retrieve_data.html.79d439e7.js"><link rel="prefetch" href="/assets/clash.html.d3c85722.js"><link rel="prefetch" href="/assets/pytorch3d.html.2e321db0.js"><link rel="prefetch" href="/assets/vscode.html.1045525a.js"><link rel="prefetch" href="/assets/start.html.48cb4eaf.js"><link rel="prefetch" href="/assets/dataset.html.d49a5dbf.js"><link rel="prefetch" href="/assets/index.html.759b3854.js"><link rel="prefetch" href="/assets/diffusion_attack.html.110755c2.js"><link rel="prefetch" href="/assets/cuda_cudnn.html.45267fd2.js"><link rel="prefetch" href="/assets/TensorRT.legacy.html.cafb9bd0.js"><link rel="prefetch" href="/assets/TensorRT.html.84219ea7.js"><link rel="prefetch" href="/assets/cuda.html.79ba6e10.js"><link rel="prefetch" href="/assets/index.html.21ce7dbc.js"><link rel="prefetch" href="/assets/JetsonXavierNX-zhihu.html.239f8e4b.js"><link rel="prefetch" href="/assets/jetson_xavier.html.c9defb75.js"><link rel="prefetch" href="/assets/basic.html.e94816c4.js"><link rel="prefetch" href="/assets/cmake.html.fc521b1d.js"><link rel="prefetch" href="/assets/cxx11.html.97573fd5.js"><link rel="prefetch" href="/assets/hash_table.html.1ce9867b.js"><link rel="prefetch" href="/assets/tree.html.dc1bdac5.js"><link rel="prefetch" href="/assets/generics.html.261f1c0c.js"><link rel="prefetch" href="/assets/lambda.html.7b7317fc.js"><link rel="prefetch" href="/assets/safety_efficiency.html.a2cc00a4.js"><link rel="prefetch" href="/assets/smart_ptr.html.e0c6686c.js"><link rel="prefetch" href="/assets/std_cincout.html.c99d0f48.js"><link rel="prefetch" href="/assets/stl.html.bd60dd5d.js"><link rel="prefetch" href="/assets/thread.html.e82ea703.js"><link rel="prefetch" href="/assets/trick.html.c1ecbf0f.js"><link rel="prefetch" href="/assets/java-env.html.10a692f5.js"><link rel="prefetch" href="/assets/basic.html.64c0853a.js"><link rel="prefetch" href="/assets/linux-basic.html.c7f0780d.js"><link rel="prefetch" href="/assets/linux-file_system.html.d23379f6.js"><link rel="prefetch" href="/assets/实验1 Linux.html.299bc327.js"><link rel="prefetch" href="/assets/实验2 Makefile实验.html.04d9957c.js"><link rel="prefetch" href="/assets/cp.html.c2243b36.js"><link rel="prefetch" href="/assets/frp.html.da9993fe.js"><link rel="prefetch" href="/assets/tmux.html.f5910246.js"><link rel="prefetch" href="/assets/ubuntu.html.1e653aec.js"><link rel="prefetch" href="/assets/vim.html.b3ae171d.js"><link rel="prefetch" href="/assets/iterator.html.600a592d.js"><link rel="prefetch" href="/assets/list.html.87b79305.js"><link rel="prefetch" href="/assets/icm20602.html.1f34a743.js"><link rel="prefetch" href="/assets/404.html.7d858b3d.js"><link rel="prefetch" href="/assets/index.html.de26035a.js"><link rel="prefetch" href="/assets/index.html.4a704eac.js"><link rel="prefetch" href="/assets/index.html.aa248416.js"><link rel="prefetch" href="/assets/index.html.e17824b6.js"><link rel="prefetch" href="/assets/index.html.fb4e8b68.js"><link rel="prefetch" href="/assets/index.html.a04dd3d3.js"><link rel="prefetch" href="/assets/index.html.ff009d80.js"><link rel="prefetch" href="/assets/index.html.bf8f59c9.js"><link rel="prefetch" href="/assets/index.html.d96055c1.js"><link rel="prefetch" href="/assets/index.html.2126153c.js"><link rel="prefetch" href="/assets/index.html.f45aae34.js"><link rel="prefetch" href="/assets/index.html.7f48a75e.js"><link rel="prefetch" href="/assets/index.html.07f86cc2.js"><link rel="prefetch" href="/assets/index.html.cf475022.js"><link rel="prefetch" href="/assets/index.html.881f858e.js"><link rel="prefetch" href="/assets/index.html.efd3a267.js"><link rel="prefetch" href="/assets/index.html.8111aed0.js"><link rel="prefetch" href="/assets/index.html.76958b33.js"><link rel="prefetch" href="/assets/index.html.a4fddea4.js"><link rel="prefetch" href="/assets/index.html.f7d705bb.js"><link rel="prefetch" href="/assets/index.html.f55a68b7.js"><link rel="prefetch" href="/assets/index.html.7f012b50.js"><link rel="prefetch" href="/assets/index.html.c0ba8663.js"><link rel="prefetch" href="/assets/index.html.78a29513.js"><link rel="prefetch" href="/assets/index.html.fb327772.js"><link rel="prefetch" href="/assets/index.html.bbc9b385.js"><link rel="prefetch" href="/assets/index.html.ea22432c.js"><link rel="prefetch" href="/assets/index.html.140ed163.js"><link rel="prefetch" href="/assets/index.html.503474a9.js"><link rel="prefetch" href="/assets/index.html.deae5fb3.js"><link rel="prefetch" href="/assets/offer.html.3868d08f.js"><link rel="prefetch" href="/assets/resume.html.d7ec25bf.js"><link rel="prefetch" href="/assets/deeplearning.html.846bcbfc.js"><link rel="prefetch" href="/assets/about.html.d48a0c4a.js"><link rel="prefetch" href="/assets/index.html.f0bca64a.js"><link rel="prefetch" href="/assets/cpu.html.eb13ecbc.js"><link rel="prefetch" href="/assets/process.html.5e25e604.js"><link rel="prefetch" href="/assets/mysql.html.2ed36301.js"><link rel="prefetch" href="/assets/obsidian.html.bd062683.js"><link rel="prefetch" href="/assets/DiffusionModel.html.08bcc291.js"><link rel="prefetch" href="/assets/index.html.e06a7ead.js"><link rel="prefetch" href="/assets/basic.html.e40514e2.js"><link rel="prefetch" href="/assets/classification.html.90f002ab.js"><link rel="prefetch" href="/assets/classifier.html.3279d75b.js"><link rel="prefetch" href="/assets/cnn.html.55fdbbd2.js"><link rel="prefetch" href="/assets/gan.html.63feabd0.js"><link rel="prefetch" href="/assets/FaceAssign.html.46a36559.js"><link rel="prefetch" href="/assets/Initialization.html.cbf39f11.js"><link rel="prefetch" href="/assets/MetricLearning.html.5b4f355b.js"><link rel="prefetch" href="/assets/ema.html.ee1dc48e.js"><link rel="prefetch" href="/assets/mlp.html.b8307347.js"><link rel="prefetch" href="/assets/nlp.html.98ff821e.js"><link rel="prefetch" href="/assets/norm.html.d85aa767.js"><link rel="prefetch" href="/assets/object_dection.html.e6f30b7f.js"><link rel="prefetch" href="/assets/fine_tune.html.5e1931bb.js"><link rel="prefetch" href="/assets/pytorch-install.html.ee2d51d9.js"><link rel="prefetch" href="/assets/train.html.b65fd805.js"><link rel="prefetch" href="/assets/transformer.html.c6187826.js"><link rel="prefetch" href="/assets/index.html.476abe47.js"><link rel="prefetch" href="/assets/对抗纹理.html.722762c6.js"><link rel="prefetch" href="/assets/2019ICML_Zhang_TRADES.html.85bb345d.js"><link rel="prefetch" href="/assets/2019_Shafahi_LS.html.6b5fa125.js"><link rel="prefetch" href="/assets/2020ICML_Rice_RobustOverfitting.html.21b3fc74.js"><link rel="prefetch" href="/assets/2020NIPS_Pang_HE.html.900aaea1.js"><link rel="prefetch" href="/assets/2021CVPR_Luo_Diffusion3DPointCloud.html.27026ef0.js"><link rel="prefetch" href="/assets/2021ICML_radford_CLIP.html.bc93d1c8.js"><link rel="prefetch" href="/assets/AdversarialTraining.html.0a5cc05a.js"><link rel="prefetch" href="/assets/StyleGAN2.html.dfb4eb0b.js"><link rel="prefetch" href="/assets/latex.html.4d2e0408.js"><link rel="prefetch" href="/assets/backtracking.html.b0bb5285.js"><link rel="prefetch" href="/assets/dp.html.1fc556b1.js"><link rel="prefetch" href="/assets/monotonic_stack.html.7d789e6f.js"><link rel="prefetch" href="/assets/wuhan23_sunset.html.b9fd4c2d.js"><link rel="prefetch" href="/assets/多卡训练.html.27bd316c.js"><link rel="prefetch" href="/assets/index.html.dd0d9c57.js"><link rel="prefetch" href="/assets/conda.html.96bc3854.js"><link rel="prefetch" href="/assets/CXX.html.b4458dd6.js"><link rel="prefetch" href="/assets/deploy.html.580b6721.js"><link rel="prefetch" href="/assets/mAP.html.311f1269.js"><link rel="prefetch" href="/assets/design_pattern.html.8bcfa400.js"><link rel="prefetch" href="/assets/freertos.html.fb8bbba1.js"><link rel="prefetch" href="/assets/command.html.47aba328.js"><link rel="prefetch" href="/assets/git-zhihu.html.1eae0cae.js"><link rel="prefetch" href="/assets/git.html.3e59d425.js"><link rel="prefetch" href="/assets/github.html.24cadaed.js"><link rel="prefetch" href="/assets/http.html.3bf21874.js"><link rel="prefetch" href="/assets/linux-ubuntu.html.a33d728e.js"><link rel="prefetch" href="/assets/linux.html.196d3670.js"><link rel="prefetch" href="/assets/macos.html.b2dd7ea2.js"><link rel="prefetch" href="/assets/mosquitto.html.72bcde0f.js"><link rel="prefetch" href="/assets/index.html.4d1bcdcc.js"><link rel="prefetch" href="/assets/openvino.html.9ec40f6e.js"><link rel="prefetch" href="/assets/list.html.0c8ffeb4.js"><link rel="prefetch" href="/assets/python.html.c7451391.js"><link rel="prefetch" href="/assets/OpenWRT.html.3b6c6cdc.js"><link rel="prefetch" href="/assets/homeAssistant-zhihu.html.c8e5f197.js"><link rel="prefetch" href="/assets/homeAssistant.html.04b1ed9d.js"><link rel="prefetch" href="/assets/icm20602.html.4b6f1d73.js"><link rel="prefetch" href="/assets/raspberrypi.html.cc4ed917.js"><link rel="prefetch" href="/assets/server.html.b7d569e5.js"><link rel="prefetch" href="/assets/ros2.html.58258223.js"><link rel="prefetch" href="/assets/rtmp.html.778d041b.js"><link rel="prefetch" href="/assets/ssh.html.7f223b75.js"><link rel="prefetch" href="/assets/Vue-init.html.ba466c93.js"><link rel="prefetch" href="/assets/index.html.dec830bb.js"><link rel="prefetch" href="/assets/CodiMD.html.35c5c110.js"><link rel="prefetch" href="/assets/PromptEngineering.html.a69ac619.js"><link rel="prefetch" href="/assets/QQ-GPT.html.3538977b.js"><link rel="prefetch" href="/assets/utm串口挂载.html.0761b847.js"><link rel="prefetch" href="/assets/BlenderPython.html.f1772b13.js"><link rel="prefetch" href="/assets/ContentAuthoring-vehicles.html.5007ce07.js"><link rel="prefetch" href="/assets/apis.html.e906451c.js"><link rel="prefetch" href="/assets/carla-zhihu.html.02dfd44a.js"><link rel="prefetch" href="/assets/carla.html.21daf75a.js"><link rel="prefetch" href="/assets/python-api.html.cac30f05.js"><link rel="prefetch" href="/assets/retrieve_data.html.85b6bc86.js"><link rel="prefetch" href="/assets/clash.html.2852b07e.js"><link rel="prefetch" href="/assets/pytorch3d.html.bf0ecb17.js"><link rel="prefetch" href="/assets/vscode.html.5b900452.js"><link rel="prefetch" href="/assets/start.html.e00a244e.js"><link rel="prefetch" href="/assets/dataset.html.d35389d2.js"><link rel="prefetch" href="/assets/index.html.0812ae47.js"><link rel="prefetch" href="/assets/diffusion_attack.html.995141c0.js"><link rel="prefetch" href="/assets/cuda_cudnn.html.dcb20437.js"><link rel="prefetch" href="/assets/TensorRT.legacy.html.3ce4cf18.js"><link rel="prefetch" href="/assets/TensorRT.html.e9f6b941.js"><link rel="prefetch" href="/assets/cuda.html.0284523c.js"><link rel="prefetch" href="/assets/index.html.b5913f1a.js"><link rel="prefetch" href="/assets/JetsonXavierNX-zhihu.html.cd8af2cc.js"><link rel="prefetch" href="/assets/jetson_xavier.html.27f40969.js"><link rel="prefetch" href="/assets/basic.html.3a996b02.js"><link rel="prefetch" href="/assets/cmake.html.2ec45f5a.js"><link rel="prefetch" href="/assets/cxx11.html.bca6121b.js"><link rel="prefetch" href="/assets/hash_table.html.d5a7f57f.js"><link rel="prefetch" href="/assets/tree.html.77ade7fb.js"><link rel="prefetch" href="/assets/generics.html.5469b3ae.js"><link rel="prefetch" href="/assets/lambda.html.52d731bf.js"><link rel="prefetch" href="/assets/safety_efficiency.html.92c5b5c2.js"><link rel="prefetch" href="/assets/smart_ptr.html.cc56b2da.js"><link rel="prefetch" href="/assets/std_cincout.html.9aff4212.js"><link rel="prefetch" href="/assets/stl.html.8773088f.js"><link rel="prefetch" href="/assets/thread.html.3f9a56bd.js"><link rel="prefetch" href="/assets/trick.html.8671e81b.js"><link rel="prefetch" href="/assets/java-env.html.ef5549ec.js"><link rel="prefetch" href="/assets/basic.html.ea6aff46.js"><link rel="prefetch" href="/assets/linux-basic.html.13f5fea0.js"><link rel="prefetch" href="/assets/linux-file_system.html.2b6ab14a.js"><link rel="prefetch" href="/assets/实验1 Linux.html.ca1414a7.js"><link rel="prefetch" href="/assets/实验2 Makefile实验.html.753b01f9.js"><link rel="prefetch" href="/assets/cp.html.d573d98c.js"><link rel="prefetch" href="/assets/frp.html.c8efdce5.js"><link rel="prefetch" href="/assets/tmux.html.cd2e15e9.js"><link rel="prefetch" href="/assets/ubuntu.html.4f3dfbbb.js"><link rel="prefetch" href="/assets/vim.html.64280aad.js"><link rel="prefetch" href="/assets/iterator.html.2b48617a.js"><link rel="prefetch" href="/assets/list.html.b87da470.js"><link rel="prefetch" href="/assets/icm20602.html.819653a5.js"><link rel="prefetch" href="/assets/404.html.566d7b1f.js"><link rel="prefetch" href="/assets/index.html.dddfd778.js"><link rel="prefetch" href="/assets/index.html.46c4a564.js"><link rel="prefetch" href="/assets/index.html.a1494f0c.js"><link rel="prefetch" href="/assets/index.html.ffd9caca.js"><link rel="prefetch" href="/assets/index.html.624d2ab8.js"><link rel="prefetch" href="/assets/index.html.f950bd12.js"><link rel="prefetch" href="/assets/index.html.d0553e76.js"><link rel="prefetch" href="/assets/index.html.e09eff3a.js"><link rel="prefetch" href="/assets/index.html.4ba84630.js"><link rel="prefetch" href="/assets/index.html.4129857d.js"><link rel="prefetch" href="/assets/index.html.b08f82bf.js"><link rel="prefetch" href="/assets/index.html.bd5a2c94.js"><link rel="prefetch" href="/assets/index.html.839055ec.js"><link rel="prefetch" href="/assets/index.html.434c33f5.js"><link rel="prefetch" href="/assets/index.html.eb42e86d.js"><link rel="prefetch" href="/assets/index.html.6a297211.js"><link rel="prefetch" href="/assets/index.html.fd688755.js"><link rel="prefetch" href="/assets/index.html.f101b956.js"><link rel="prefetch" href="/assets/index.html.64b025cd.js"><link rel="prefetch" href="/assets/index.html.29e19983.js"><link rel="prefetch" href="/assets/index.html.dc792ac0.js"><link rel="prefetch" href="/assets/index.html.4722c165.js"><link rel="prefetch" href="/assets/index.html.16ed122a.js"><link rel="prefetch" href="/assets/index.html.aed05c8b.js"><link rel="prefetch" href="/assets/index.html.b216deaf.js"><link rel="prefetch" href="/assets/index.html.d82d8273.js"><link rel="prefetch" href="/assets/index.html.1849f7be.js"><link rel="prefetch" href="/assets/index.html.81aca02d.js"><link rel="prefetch" href="/assets/index.html.57e129ed.js"><link rel="prefetch" href="/assets/index.html.2f17274b.js"><link rel="prefetch" href="/assets/404.7832e9b0.js"><link rel="prefetch" href="/assets/HomePage.1bb8cb54.js"><link rel="prefetch" href="/assets/Layout.b4cb729d.js"><link rel="prefetch" href="/assets/Links.2eb8a714.js"><link rel="prefetch" href="/assets/Post.be25753e.js"><link rel="prefetch" href="/assets/Tags.d5e01926.js">
    <link rel="stylesheet" href="/assets/style.fd106935.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar"><!--[--><header class="navbar invert"><span><a href="/" class=""><span class="site-name">cd Home/主页</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="主页/Home"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0.48 0.48 23.04 23.04" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg></span><span>主页/Home</span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/links/" class="" aria-label="文章分类/Links"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M305.45 462.59c7.391 7.298 6.188 20.097-3 25.004-77.714 41.802-176.726 29.91-242.344-35.709-65.602-65.603-77.51-164.523-35.692-242.331 4.891-9.095 17.69-10.298 25.003-3l116.812 116.813 27.394-27.394c-.688-2.61-1.594-5.001-1.594-7.814a32.004 32.004 0 1132.004 32.005c-2.797 0-5.204-.891-7.798-1.594l-27.41 27.41zm206.526-159.523a16.103 16.103 0 01-16.002 17.003H463.86a15.97 15.97 0 01-15.892-15.002C440.467 175.549 336.453 70.534 207.03 63.533a15.845 15.845 0 01-15.002-15.908V16.027A16.094 16.094 0 01209.03.024C372.255 8.62 503.475 139.841 511.976 303.067zm-96.012-.297a16.21 16.21 0 01-16.112 17.3h-32.207a16.069 16.069 0 01-15.893-14.705c-6.907-77.011-68.118-138.91-144.924-145.224a15.94 15.94 0 01-14.8-15.893v-32.114a16.134 16.134 0 0117.3-16.096c110.123 8.501 198.228 96.607 206.636 206.732z"/></svg></span><span>文章分类/Links</span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/tags/" class="" aria-label="标签/Tags"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg></span><span>标签/Tags</span><!--[--><!--]--></a></div><!--]--><div class="navbar-item"><a style="cursor:pointer;"><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 2c4.968 0 9 4.032 9 9s-4.032 9-9 9-9-4.032-9-9 4.032-9 9-9zm0 16c3.867 0 7-3.133 7-7 0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7zm8.485.071l2.829 2.828-1.415 1.415-2.828-2.829 1.414-1.414z"/></svg></span><span>Search</span></a></div></nav><!--[--><!--]--><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="主页/Home"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0.48 0.48 23.04 23.04" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg></span><span>主页/Home</span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/links/" class="" aria-label="文章分类/Links"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M305.45 462.59c7.391 7.298 6.188 20.097-3 25.004-77.714 41.802-176.726 29.91-242.344-35.709-65.602-65.603-77.51-164.523-35.692-242.331 4.891-9.095 17.69-10.298 25.003-3l116.812 116.813 27.394-27.394c-.688-2.61-1.594-5.001-1.594-7.814a32.004 32.004 0 1132.004 32.005c-2.797 0-5.204-.891-7.798-1.594l-27.41 27.41zm206.526-159.523a16.103 16.103 0 01-16.002 17.003H463.86a15.97 15.97 0 01-15.892-15.002C440.467 175.549 336.453 70.534 207.03 63.533a15.845 15.845 0 01-15.002-15.908V16.027A16.094 16.094 0 01209.03.024C372.255 8.62 503.475 139.841 511.976 303.067zm-96.012-.297a16.21 16.21 0 01-16.112 17.3h-32.207a16.069 16.069 0 01-15.893-14.705c-6.907-77.011-68.118-138.91-144.924-145.224a15.94 15.94 0 01-14.8-15.893v-32.114a16.134 16.134 0 0117.3-16.096c110.123 8.501 198.228 96.607 206.636 206.732z"/></svg></span><span>文章分类/Links</span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/tags/" class="" aria-label="标签/Tags"><!--[--><!--]--><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M0 252.118V48C0 21.49 21.49 0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882 0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg></span><span>标签/Tags</span><!--[--><!--]--></a></div><!--]--><div class="navbar-item"><a style="cursor:pointer;"><span class="nav-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 2c4.968 0 9 4.032 9 9s-4.032 9-9 9-9-4.032-9-9 4.032-9 9-9zm0 16c3.867 0 7-3.133 7-7 0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7zm8.485.071l2.829 2.828-1.415 1.415-2.828-2.829 1.414-1.414z"/></svg></span><span>Search</span></a></div></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><div class="page-content"><!--[--><div class="show-catalog post-wrapper"><div class="article-header use-image post-header" style="background-image:url(/images/backgrounds/terraform-studios-pablo-dominguez-redwall2.jpg);"><div class="article-header-mask" style="background:rgb(67,65,47, .2);"></div><div class="article-header-content"><div class="article-tags"><!--[--><a href="/tags/c++/" class="article-tag">C++</a><a href="/tags/%E5%BC%80%E5%8F%91/" class="article-tag">开发</a><a href="/tags/%E9%9D%A2%E8%AF%95/" class="article-tag">面试</a><!--]--></div><h1 class="article-title">一切为了减少拷贝</h1><p class="article-subtitle">C++ 右值引用、移动语义、万能引用、引用折叠、完美转发</p><div class="article-icons"><div class="article-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M313.6 304c-28.7 0-42.5 16-89.6 16-47.1 0-60.8-16-89.6-16C60.2 304 0 364.2 0 438.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-25.6c0-74.2-60.2-134.4-134.4-134.4zM400 464H48v-25.6c0-47.6 38.8-86.4 86.4-86.4 14.6 0 38.3 16 89.6 16 51.7 0 74.9-16 89.6-16 47.6 0 86.4 38.8 86.4 86.4V464zM224 288c79.5 0 144-64.5 144-144S303.5 0 224 0 80 64.5 80 144s64.5 144 144 144zm0-240c52.9 0 96 43.1 96 96s-43.1 96-96 96-96-43.1-96-96 43.1-96 96-96z"/></svg><span>HenryZhu</span></div><div class="article-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M400 64h-48V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H160V12c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v52H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zm-6 400H54c-3.3 0-6-2.7-6-6V160h352v298c0 3.3-2.7 6-6 6z"/></svg><span>2023-09-26</span></div><div class="article-icon"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="0 0 24 24" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M17.618 5.968l1.453-1.453 1.414 1.414-1.453 1.453a9 9 0 11-1.414-1.414zM12 20a7 7 0 100-14 7 7 0 000 14zM11 8h2v6h-2V8zM8 1h8v2H8V1z"/></svg><span>28 min</span></div></div></div><!----></div><main class="page post-content"><!--[--><!--]--><div class="theme-gungnir-content"><!--[--><!--]--><div><h1 id="一切为了减少拷贝" tabindex="-1"><a class="header-anchor" href="#一切为了减少拷贝" aria-hidden="true">#</a> 一切为了减少拷贝</h1><p>C++ 11 中引入了右值引用、移动语义、万能引用、引用折叠、完美转发等新特性，这些特性的出现都是为了减少拷贝操作，提高程序的性能。而这些是现代 C++ 噩梦的开始</p><h2 id="左值和右值" tabindex="-1"><a class="header-anchor" href="#左值和右值" aria-hidden="true">#</a> 左值和右值</h2><p><img src="/assets/value.65b7a01b.svg" alt="value"></p><p>先来下定义：</p><ul><li><strong>左值(loactor valu, lvalue)</strong> 是存储在内存中、有明确存储地址（可寻址）的数据</li><li><strong>右值(read value, rvalue)</strong> 是可以提供数据值的数据（不一定可以寻址，例如存储于寄存器中的数据）。同时右值又有 <strong>纯右值(pure rvalue)</strong> 和 <strong>将亡值(eXpiring Value)</strong> 的分类。</li></ul><blockquote><p>locator value 翻译为「可寻址变量」，read value 翻译为「只读变量(字面量)」，因此 l 和 r 并不是左右的意思，而是 locator 和 read 的意思</p></blockquote><p><strong>例如</strong>，<code>x</code> 是一个左值，因为其有明确的内存地址；<code>3</code> 是一个纯右值，因为其不存储在内存中，而是直接提供数据（的临时）值。</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>  <span class="token comment">// x 是一个左值，3 是一个纯右值（字面量）</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>例如</strong>，自增操作时，<code>x++</code> 是一个右值，<code>++x</code> 是一个左值。</p><ul><li><code>x++</code> <strong>返回临时变量，是一个右值</strong>。在后置自增操作中，<code>x</code> 的值会被编译器拷贝一份，然后自增，最后返回拷贝的值。因此对 <code>x++</code> 取地址会报错</li><li><code>++x</code> <strong>返回自己本身，是一个左值</strong>。对 <code>++x</code> 取地址不会报错</li></ul><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code>x<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token comment">// 右值</span>
<span class="token operator">++</span>x<span class="token punctuation">;</span>  <span class="token comment">// 左值</span>
<span class="token keyword">int</span><span class="token operator">*</span> p <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token comment">// error: lvalue required as unary &#39;&amp;&#39; operand</span>
<span class="token keyword">int</span><span class="token operator">*</span> q <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token operator">++</span>x<span class="token punctuation">;</span>  <span class="token comment">// ok</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>例如</strong>，通常字面量都是右值，<strong>字符串字面量除外</strong>，虽然很少这样做，但字符串字面量存储到程序中对数据段时，程序加载到时候也会为其分配内存地址，因此<strong>是左值</strong>。</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span><span class="token operator">*</span> p <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span> <span class="token comment">// lvalue</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>例如</strong>，函数返回值</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> vec <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span>   <span class="token comment">// 0x16f84b228 </span>
    <span class="token comment">// vec 左值， {1, 2, 3} 右值</span>
    <span class="token keyword">return</span> vec<span class="token punctuation">;</span> <span class="token comment">// 返回时拷贝复制到 std::vector&lt;int&gt; </span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> nums<span class="token punctuation">;</span>  <span class="token comment">// 0x16f84b200  左值</span>
nums <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// 0x16f84b200</span>
                        <span class="token comment">// RVO: 0x16f84b228</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>函数 <code>func()</code> 内的 <code>vec</code> 是一个临时变量，在函数结束后， <code>vec</code> 会被拷贝一份返回，然后立即销毁，这就会造成额外的开销</p><p>但是，编译器对此进行了默认 <strong>RVO 优化</strong> (禁用可以添加编译选项 <code>-fno-elide-constructors</code>)，会将 <code>vec</code> 进行隐式右值转化，直接将 <code>vec</code> 的内容移动到 <code>nums</code> 中，而不是拷贝一份，这样就避免了额外的开销。</p><h2 id="左值引用" tabindex="-1"><a class="header-anchor" href="#左值引用" aria-hidden="true">#</a> 左值引用</h2><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span> val <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">int</span><span class="token operator">&amp;</span> lrval <span class="token operator">=</span> val<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>定义左值引用的时候需要直接初始化，否则会报错 <code>error: declaration of reference variable &#39;lrval&#39; requires an initializer</code></p><h2 id="右值引用" tabindex="-1"><a class="header-anchor" href="#右值引用" aria-hidden="true">#</a> 右值引用</h2><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span> val <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token operator">&amp;&amp;</span> rrval <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>定义右值引用的时候需要直接初始化，否则会报错 <code>error: declaration of reference variable &#39;lrval&#39; requires an initializer</code></p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">PrintRefType</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">&amp;</span>ref<span class="token punctuation">)</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;lvalue:&quot;</span> <span class="token operator">&lt;&lt;</span>ref<span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">PrintRefType</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">&amp;&amp;</span>ref<span class="token punctuation">)</span> <span class="token punctuation">{</span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;rvalue:&quot;</span> <span class="token operator">&lt;&lt;</span>ref<span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> val1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">PrintRefType</span><span class="token punctuation">(</span>val1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// output: lvalue:1</span>
    <span class="token function">PrintRefType</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// output: rvalue:2</span>

    <span class="token keyword">int</span><span class="token operator">&amp;&amp;</span> val2 <span class="token operator">=</span> val1<span class="token punctuation">;</span>  <span class="token comment">// error: rvalue reference to type &#39;int&#39; cannot bind to lvalue of type &#39;int&#39;</span>

    <span class="token keyword">int</span><span class="token operator">&amp;&amp;</span> val3 <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>val1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">PrintRefType</span><span class="token punctuation">(</span>val3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// output: lvalue:1</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>val1</code> 是一个左值</li><li><code>2</code> 是一个右值</li><li><code>int&amp;&amp; val2 = val1;</code> 右值引用不能引用左值，报错 <code>error: rvalue reference to type &#39;int&#39; cannot bind to lvalue of type &#39;int&#39;</code></li><li><code>int&amp;&amp; val3 = std::move(val1);</code> 可以使用 <code>std::move</code> 将左值转化为右值，但是这里的 <code>val3</code> 仍然是一个左值，因为 <code>val3</code> 有明确的内存地址，可以寻址，因此是一个左值</li></ul><blockquote><p>大佬说过一句话：<strong>右值的概念其实很微妙</strong>，一旦某个右值，有了名字，也就在内存中有了位置，它就变成了一个左值。<strong>但它又是一个很有用的概念</strong>，允许程序员更加细粒度的处理对象拷贝时的内存分配问题，提高了对临时对象和不需要的对象的利用率，极大提高程序的效率。当然，也会引入更多的bug。不过，这就是C++的哲学，什么都允许你做，但出了问题，可别赖C++这门语言。<sup><a href="#ref-11">[11]</a></sup></p></blockquote><h2 id="引用绑定" tabindex="-1"><a class="header-anchor" href="#引用绑定" aria-hidden="true">#</a> 引用绑定</h2><p>「<strong>右值引用</strong>」只能绑定到「<strong>右值</strong>」上</p><p>「<strong>左值引用</strong>」除了可以绑定到「<strong>左值</strong>」上，「<strong>常量左值引用</strong>」还可以绑定到「<strong>右值</strong>」上，但是非常左值引用不可绑定到右值</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code>string <span class="token operator">&amp;</span>s <span class="token operator">=</span> <span class="token string">&quot;hi&quot;</span><span class="token punctuation">;</span>       <span class="token comment">// 非常左值引用 不可 绑定到右值</span>
<span class="token keyword">const</span> string <span class="token operator">&amp;</span>s <span class="token operator">=</span> <span class="token string">&quot;hi&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 常量左值引用 可以 绑定到右值</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>规则简化如下：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code>rvalue reference        <span class="token punctuation">{</span>rvalue<span class="token punctuation">}</span> <span class="token comment">// 右值引用 绑定到 右值</span>
lvalue reference        <span class="token punctuation">{</span>lvalue<span class="token punctuation">}</span> <span class="token comment">// 左值引用 绑定到 左值</span>
<span class="token keyword">const</span> lvalue reference  <span class="token punctuation">{</span>rvalue<span class="token punctuation">}</span> <span class="token comment">// 常量左值引用 绑定到 右值</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>相比之下，声明中带 “&amp;&amp;” 的，可能是lvalue references 或者 rvalue references 的引用可以绑定到任何东西上。这种引用灵活也忒灵活了，值得单独给它们起个名字。我称它们为 <a href="#%E4%B8%87%E8%83%BD%E5%BC%95%E7%94%A8">「<strong>万能引用</strong>」(universal references)</a></p><h2 id="拷贝构造函数和拷贝赋值运算符" tabindex="-1"><a class="header-anchor" href="#拷贝构造函数和拷贝赋值运算符" aria-hidden="true">#</a> 拷贝构造函数和拷贝赋值运算符</h2><h3 id="拷贝构造函数" tabindex="-1"><a class="header-anchor" href="#拷贝构造函数" aria-hidden="true">#</a> 拷贝构造函数</h3><p>当没有自定义拷贝构造函数时，编译器会自动生成一个「<strong>默认拷贝构造函数</strong>」，类似于：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token keyword">const</span> MyClass<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>a <span class="token operator">=</span> obj<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>该函数会将一个对象的数据成员的值拷贝到另一个对象中，但是不会拷贝对象中的指针成员，而是将指针成员的值拷贝到另一个对象中，这样两个对象中的指针成员指向同一个地址，这就是<a href="#%E6%B5%85%E6%8B%B7%E8%B4%9D"><strong>浅拷贝</strong></a>，有时候会导致程序出错。因此需要自定义拷贝构造函数，实现<a href="#%E6%B7%B1%E6%8B%B7%E8%B4%9D"><strong>深拷贝</strong></a>。</p><p>如果不需要编译器自动生成的拷贝构造函数，可以使用 <code>= delete</code> 关键字，例如：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token keyword">const</span> MyClass<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>❓ 哪些是拷贝构造函数</p><p>当函数第一个参数是类的对象的引用，且没有返回值时，该函数就是拷贝构造函数。例如：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token class-name">X</span><span class="token double-colon punctuation">::</span><span class="token function">X</span><span class="token punctuation">(</span>X<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">X</span><span class="token double-colon punctuation">::</span><span class="token function">X</span><span class="token punctuation">(</span><span class="token keyword">const</span> X<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">X</span><span class="token double-colon punctuation">::</span><span class="token function">X</span><span class="token punctuation">(</span><span class="token keyword">volatile</span> X<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">X</span><span class="token double-colon punctuation">::</span><span class="token function">X</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">volatile</span> X<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为什么强调第一个参数呢，因为，下面这些也都是拷贝构造函数：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token class-name">X</span><span class="token double-colon punctuation">::</span><span class="token function">X</span><span class="token punctuation">(</span><span class="token keyword">const</span> X<span class="token operator">&amp;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token class-name">X</span><span class="token double-colon punctuation">::</span><span class="token function">X</span><span class="token punctuation">(</span>X<span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">X</span><span class="token double-colon punctuation">::</span><span class="token function">X</span><span class="token punctuation">(</span>X<span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>而<strong>值传递</strong>的不是拷贝构造函数，例如：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token class-name">X</span><span class="token double-colon punctuation">::</span><span class="token function">X</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token class-name">X</span><span class="token double-colon punctuation">::</span><span class="token function">X</span><span class="token punctuation">(</span><span class="token keyword">const</span> X<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">X</span><span class="token double-colon punctuation">::</span><span class="token function">X</span><span class="token punctuation">(</span><span class="token keyword">volatile</span> X<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">X</span><span class="token double-colon punctuation">::</span><span class="token function">X</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">volatile</span> X<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>❓ <strong>为什么呢</strong>。</p><p>因为，值传递的时候，会调用拷贝构造函数，而拷贝构造函数又是值传递，这样就会导致无限递归，直到栈溢出，因此编译器会报错。</p><p>❓<strong>还有一个疑惑</strong>是，拷贝构造函数里能调用了另一个对象的 <code>private</code> 成员变量，这是为什么呢</p><p>实际上，这是对私有成员变量的理解有误，<strong>封装是编译期的概念，是针对类型而非对象的</strong>，在<strong>类的成员函数中可以访问「同类型实例对象」的私有成员变量</strong>，具体参考<a href="#ref-5">[5]</a></p><h3 id="拷贝赋值运算符" tabindex="-1"><a class="header-anchor" href="#拷贝赋值运算符" aria-hidden="true">#</a> 拷贝赋值运算符</h3><p>「<strong>拷贝赋值运算符</strong>」可以看成是一个特殊的拷贝构造函数，当没有重写拷贝赋值运算符时，编译器会自动生成一个「<strong>默认拷贝赋值运算符</strong>」，类似于：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code>MyClass<span class="token operator">&amp;</span> MyClass<span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> MyClass<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
   <span class="token keyword">this</span><span class="token operator">-&gt;</span>a <span class="token operator">=</span> obj<span class="token punctuation">.</span>a<span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果不需要编译器自动生成的赋值构造函数，可以使用 <code>= delete</code> 关键字，例如：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    MyClass<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> MyClass<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="拷贝构造函数和拷贝赋值运算符的区别" tabindex="-1"><a class="header-anchor" href="#拷贝构造函数和拷贝赋值运算符的区别" aria-hidden="true">#</a> 拷贝构造函数和拷贝赋值运算符的区别</h3><p>「<strong>拷贝赋值运算符</strong>」和「<strong>拷贝构造函数</strong>」都是用来初始化一个对象，但是「<strong>赋值构造函数</strong>」是用来初始化一个已经存在的对象，而「<strong>拷贝构造函数</strong>」是用来初始化一个新的对象。</p><p>例如，如下的例子使用的是「<strong>拷贝构造函数</strong>」：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code>MyClass obj1<span class="token punctuation">;</span>       <span class="token comment">// 调用默认构造函数</span>
MyClass <span class="token function">obj2</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>
MyClass obj2 <span class="token operator">=</span> obj1<span class="token punctuation">;</span>
MyClass obj3 <span class="token operator">=</span> <span class="token function">MyClass</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>
MyClass obj4 <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>
MyClass obj5 <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token function">MyClass</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
MyClass <span class="token operator">*</span>p_obj6 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">MyClass</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如下的例子使用的是「<strong>拷贝赋值运算符</strong>」：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code>MyClass obj1<span class="token punctuation">;</span>   <span class="token comment">// 调用默认构造函数</span>
MyClass obj2<span class="token punctuation">;</span>   <span class="token comment">// 调用默认构造函数</span>
obj2 <span class="token operator">=</span> obj1<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="深拷贝" tabindex="-1"><a class="header-anchor" href="#深拷贝" aria-hidden="true">#</a> 深拷贝</h3><p>考虑这个例子，编译器会为我们自动生成一个拷贝构造函数</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> a<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> count<span class="token punctuation">;</span>   <span class="token comment">// 静态成员</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> count<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token operator">~</span><span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> count<span class="token operator">--</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> count<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> MyClass<span class="token double-colon punctuation">::</span>count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// 静态成员初始化（必须在类外）</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    MyClass mc1<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token class-name">MyClass</span><span class="token double-colon punctuation">::</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">// 1</span>
    MyClass <span class="token function">mc2</span><span class="token punctuation">(</span>mc1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token class-name">MyClass</span><span class="token double-colon punctuation">::</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">// 1</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这时候出现的问题是，输出都是 1 ，这会导致在析构的时候，会使得 <code>count</code> 为 -1，这是不符合预期的</p><p>这是因为在默认拷贝构造函数中，只是简单的将 <code>mc1</code> 的值赋值给 <code>mc2</code>，这样 <code>mc1</code> 和 <code>mc2</code> 的 <code>count</code> 都指向同一个地址，因此在析构的时候，会导致 <code>count</code> 减少两次，因此 <code>count</code> 为 -1</p><p>为此，需要自定义拷贝构造函数，实现深拷贝。这时候再输出 <code>count</code> 就是 2 了</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token keyword">const</span> MyClass<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token operator">-&gt;</span>a <span class="token operator">=</span> obj<span class="token punctuation">.</span>a<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token operator">-&gt;</span>count<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="浅拷贝" tabindex="-1"><a class="header-anchor" href="#浅拷贝" aria-hidden="true">#</a> 浅拷贝</h3><p>考虑下面这个例子，编译器生成的拷贝构造函数，会将 <code>mc1</code> 的 <code>p</code> 的值赋值给 <code>mc2</code> 的 <code>p</code>，这样 <code>mc1</code> 和 <code>mc2</code> 的 <code>p</code> 都指向同一个地址，因此在析构的时候，会导致 <code>p</code> 被释放两次，因此会报错</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> a<span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
  <span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token operator">~</span><span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token function">assert</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-&gt;</span>p<span class="token operator">!</span> <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>p<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  MyClass mc1<span class="token punctuation">;</span>
  MyClass <span class="token function">mc2</span><span class="token punctuation">(</span>mc1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为此，需要自定义拷贝构造函数，为 <code>p</code> 重新分配内存，实现深拷贝</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token keyword">const</span> MyClass<span class="token operator">&amp;</span> obj<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token operator">-&gt;</span>a <span class="token operator">=</span> obj<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token operator">-&gt;</span>p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token keyword">this</span><span class="token operator">-&gt;</span>p <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="拷贝构造函数的应用" tabindex="-1"><a class="header-anchor" href="#拷贝构造函数的应用" aria-hidden="true">#</a> 拷贝构造函数的应用</h3><ul><li>从 <a href="#%E6%B7%B1%E6%8B%B7%E8%B4%9D">深拷贝</a> 的例子中可以看出，当「<strong>数据成员中有静态成员</strong>」时，需要考虑自定义拷贝构造函数，处理静态成员</li><li>从 <a href="#%E6%B5%85%E6%8B%B7%E8%B4%9D">浅拷贝</a> 的例子中可以看出，当「<strong>数据成员中有指针</strong>」时，必须要用「<strong>深拷贝</strong>」</li></ul><h2 id="移动语义" tabindex="-1"><a class="header-anchor" href="#移动语义" aria-hidden="true">#</a> 移动语义</h2><p>移动语义的出现实际上是为了解决拷贝构造函数的问题，因为拷贝构造函数会造成额外的开销，而移动语义可以避免这种额外的开销。</p><p>考虑下面这个例子<sup><a href="#ref-6">[6]</a></sup></p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>string str<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token operator">:</span> str<span class="token punctuation">{</span> s <span class="token punctuation">}</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>MyClass<span class="token operator">&gt;</span> mc_list<span class="token punctuation">;</span>
    MyClass tmp<span class="token punctuation">{</span> <span class="token string">&quot;hello&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    mc_list<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// tmp 是一个左值，拷贝</span>
    mc_list<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// tmp 是一个左值，拷贝</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>每次 <code>push_back</code> 的时候，都会发生一次拷贝操作，在两次添加后，<code>tmp</code> 的生命周期即将结束，那么你不能将 <code>tmp</code> 的内存“移动”到 <code>mc_list</code> 中吗？这样就可以避免额外的拷贝操作了</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>MyClass<span class="token operator">&gt;</span> mc_list<span class="token punctuation">;</span>
    MyClass tmp<span class="token punctuation">{</span> <span class="token string">&quot;hello&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    mc_list<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// tmp 是一个左值，拷贝</span>
    mc_list<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 将左值转化为右值</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里的 <code>std::move</code> 就是移动语义，将左值转化为右值，这样就可以避免额外的拷贝操作了，为什么呢？因为 <code>std::vector</code> 的 <code>push_back</code> 针对<strong>左值 (拷贝)</strong> 和<strong>右值 (移动)</strong> 有不同的实现，查看的源码 (Apple Clang 14.0)：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">// 前面有 `typedef const value_type&amp;  const_reference;`</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Allocator</span><span class="token operator">&gt;</span>
_LIBCPP_CONSTEXPR_SINCE_CXX20
<span class="token keyword">inline</span> _LIBCPP_HIDE_FROM_ABI
<span class="token keyword">void</span> <span class="token class-name">vector</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Allocator<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">push_back</span><span class="token punctuation">(</span>const_reference __x<span class="token punctuation">)</span> <span class="token comment">// 左值引用</span>
<span class="token punctuation">{</span>   <span class="token comment">// 执行拷贝操作</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-&gt;</span>__end_ <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span><span class="token function">__end_cap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">__construct_one_at_end</span><span class="token punctuation">(</span>__x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">__push_back_slow_path</span><span class="token punctuation">(</span>__x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">_Allocator</span><span class="token operator">&gt;</span>
_LIBCPP_CONSTEXPR_SINCE_CXX20
<span class="token keyword">inline</span> _LIBCPP_HIDE_FROM_ABI
<span class="token keyword">void</span> <span class="token class-name">vector</span><span class="token operator">&lt;</span>_Tp<span class="token punctuation">,</span> _Allocator<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">push_back</span><span class="token punctuation">(</span>value_type<span class="token operator">&amp;&amp;</span> __x<span class="token punctuation">)</span> <span class="token comment">// 右值引用</span>
<span class="token punctuation">{</span>   <span class="token comment">// 执行移动操作</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-&gt;</span>__end_ <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span><span class="token function">__end_cap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">__construct_one_at_end</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>__x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">__push_back_slow_path</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>__x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>总结一下，就是移动语义 <code>std::move</code> 可以将左值转化为右值，这样就可以避免额外的拷贝操作了</p><h2 id="移动构造函数" tabindex="-1"><a class="header-anchor" href="#移动构造函数" aria-hidden="true">#</a> 移动构造函数</h2><p>还是上面的类，我们增加「<strong>移动构造函数</strong>」，移动构造函数接受一个右值引用，例如：</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>string str<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> s<span class="token punctuation">)</span><span class="token operator">:</span> str<span class="token punctuation">{</span> s <span class="token punctuation">}</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 移动构造函数</span>
    <span class="token function">MyClass</span><span class="token punctuation">(</span>MyClass<span class="token operator">&amp;&amp;</span> rValue<span class="token punctuation">)</span> <span class="token keyword">noexcept</span> <span class="token comment">// noexcept</span>
    <span class="token operator">:</span> str<span class="token punctuation">{</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>rValue<span class="token punctuation">.</span>str<span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>有了移动构造函数之后，就可以通过它来创建新的对象，避免拷贝操作的开销</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code>MyClass tmp<span class="token punctuation">{</span> <span class="token string">&quot;hello&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
MyClass A<span class="token punctuation">{</span> std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// 调用移动构造函数</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>注意 <code>noexcept</code> 说明符是我们对于不会抛出异常的保证，如果在执行的过程中有异常被抛出了，应用程序将会直接终止执行。也就是告知编译器，我们的移动构造函数不会抛出异常，可以放心使用</p><h2 id="万能引用" tabindex="-1"><a class="header-anchor" href="#万能引用" aria-hidden="true">#</a> 万能引用</h2><p>考虑下面的例子<sup><a href="#ref-7">[7]</a></sup>，用到的函数 <code>type_to_string</code> 参考 <sup><a href="#ref-8">[8]</a></sup></p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code>string <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">&amp;</span>a<span class="token punctuation">)</span>  <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;lvalue&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
string <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">&amp;&amp;</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;rvalue&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">&amp;&amp;</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    cout <span class="token operator">&lt;&lt;</span> boolalpha<span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token generic-function"><span class="token function">type_to_string</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;, &quot;</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> is_lvalue_reference<span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;, &quot;</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token function">f</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token function">g</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 报错，无法将左值绑定到右值引用</span>
    <span class="token function">g</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// output: int&amp;&amp;, true, lvalue</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述例子过程如下：</p><ul><li>因为传入的是一个纯右值 <code>10</code> ，因为传入后就“不存在”了，因此被隐式地转换为将亡值</li><li>函数参数中，<code>10</code> 被绑定到右值引用 <code>a</code> (推导为 <code>int&amp;&amp;</code>)。所以这里输出 <code>int&amp;&amp;</code></li><li>右值引用 <code>a</code> 是一个左值(推导为 <code>int&amp;</code>)，所以输出 <code>lvalue</code>。所以这里输出 <code>true</code></li><li>根据 <code>a</code> 的类型重载，调用 <code>f(int &amp;a)</code>，所以输出 <code>lvalue</code></li></ul><p>所以可以看出，函数的左值引用和右值引用的重载，所依据的是「<strong>值的类型</strong>」，而不是表达式的类型</p><p>然而实际上我们并不关心值的类型，而是关心表达式所持有的资源能不能获取。对于一个函数所接受的参数，我们可以将其分为两类：</p><ul><li><strong>左值</strong>：我们无法获取其资源，因为其资源可能被其他对象所持有</li><li><strong>将亡值</strong>：我们可以获取其资源，因为其资源即将被销毁，因此可以直接拿来使用</li></ul><p>对于这两种情况，需要加以区分。但是我们希望将两个重载函数合并为一个函数模板，</p><p>第一步，需要引入「<strong>万能引用</strong>」推导表达式的值类型，万能引用需要借助于模板，也就是 <code>T&amp;&amp;</code></p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">// `constexpr` compiled with -std=c++17</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
string <span class="token function">f</span><span class="token punctuation">(</span>T<span class="token operator">&amp;&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token keyword">constexpr</span><span class="token punctuation">(</span>is_lvalue_reference<span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;lvalue&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> 
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token keyword">constexpr</span> <span class="token punctuation">(</span>is_rvalue_reference<span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;rvalue&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里的 <code>T&amp;&amp;</code> 可以根据传入的参数推导出类型 （这里涉及到<a href="#%E5%BC%95%E7%94%A8%E6%8A%98%E5%8F%A0"><strong>引用折叠</strong></a>）</p><ul><li>当传入的是<strong>左值</strong>时，<code>T</code> 推导为左值引用 <code>T&amp;</code>。</li><li>当传入的是<strong>将亡值</strong>时，<code>T</code> 推导为右值引用 <code>T&amp;&amp;</code>。</li></ul><p>所以，最后 <code>a</code> 的类型只与传入表达式的值类型有关，但是不管传入表达式的值类型是什么， <code>a</code> 的值类型都会变为左值</p><p>第二步，将 <code>a</code> 的值类型与表达式的值类型进行同步，那么我们就可以利用 <code>decltype(a)</code> 来获取值类型，并且利用 <code>static_cast&lt;decltype(a)&gt;(a)</code> 来将 <code>a</code> 的类型转化为 <code>a</code> 的值类型。</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
string <span class="token function">f</span><span class="token punctuation">(</span>T<span class="token operator">&amp;&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token keyword">constexpr</span><span class="token punctuation">(</span>is_lvalue_reference<span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;lvalue&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> 
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token keyword">constexpr</span><span class="token punctuation">(</span>is_rvalue_reference<span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;rvalue&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这时候调用</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// output: lvalue</span>
            <span class="token function">f</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// output: lvalue</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>表达式很长，需要解释一下 <code>is_lvalue_reference&lt;decltype((static_cast&lt;decltype(a)&gt;(a)))&gt;::value</code> 是个什么东西。</p><ol><li><p>首先，<code>decltype(a)</code> 是获取 <code>a</code> 的值类型</p></li><li><p><code>static_cast&lt;decltype(a)&gt;(a)</code> 是将 <code>a</code> 的类型转化为 <code>a</code> 的值类型</p></li><li><p><code>decltype((...))</code> 是 <code>static_cast&lt;decltype(a)&gt;(a)</code> 的值类型</p></li><li><p><code>is_lvalue_reference&lt;...&gt;::value</code> 是判断 <code>decltype((...))</code> 的值类型是否为左值引用，也就是 <code>static_cast&lt;decltype(a)&gt;(a)</code> 的值类型是否为左值引用，也就是 <code>a</code> 的值类型是否为左值引用</p></li></ol><blockquote><p><code>decltype(a)</code> 是获取 <code>a</code> 的值类型，<code>decltype((a))</code> 是获取 <code>a</code> 的引用类型，<a href="https://segmentfault.com/q/1010000000516149" target="_blank" rel="noopener noreferrer">“C++ decltype((i))为什么是个引用？”</a></p></blockquote><h2 id="引用折叠" tabindex="-1"><a class="header-anchor" href="#引用折叠" aria-hidden="true">#</a> 引用折叠</h2><p>引用折叠(reference collapsing) 是 C++11 中的一个新特性，它是为了解决万能引用中的问题而出现的。引用折叠的规则如下：</p><table><thead><tr><th>模板类型</th><th>T 实际类型</th><th>最终类型</th></tr></thead><tbody><tr><td><code>T&amp;</code></td><td><code>R</code></td><td><code>R&amp;</code></td></tr><tr><td><code>T&amp;</code></td><td><code>R&amp;</code></td><td><code>R&amp;</code></td></tr><tr><td><code>T&amp;</code></td><td><code>R&amp;&amp;</code></td><td><code>R&amp;</code></td></tr><tr><td><code>T&amp;&amp;</code></td><td><code>R</code></td><td><code>R&amp;&amp;</code></td></tr><tr><td><code>T&amp;&amp;</code></td><td><code>R&amp;</code></td><td><code>R&amp;</code></td></tr><tr><td><code>T&amp;&amp;</code></td><td><code>R&amp;&amp;</code></td><td><code>R&amp;&amp;</code></td></tr></tbody></table><blockquote><p>实际上，只要左值引用会传染，沾上一个左值引用就变左值引用了<sup><a href="#ref-9">[9]</a></sup></p></blockquote><p>根本原因是因为 C++ 中禁止 reference to reference ，所以编译器需要对四种情况(也就是 L2L,L2R,R2L,R2R )进行处理，将他们“折叠”(也可说是“坍缩”)成一种单一的 reference 。<sup><a href="#ref-9">[9]</a></sup></p><p>这时候我们再来看这一段代码</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
string <span class="token function">f</span><span class="token punctuation">(</span>T<span class="token operator">&amp;&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>解释一下两次调用实际发生了什么，</p><ul><li><code>int x = 20; f(x);</code> 传入函数的 <code>b</code> 是一个左值(<code>L</code>)，模板类型是一个万能引用 <code>T&amp;&amp;</code>，因此 <code>T</code> 推导为左值引用 <code>T&amp;</code>，因此 <code>a</code> 的类型为 <code>T&amp;</code></li><li><code>f(10);</code> 传入函数的 <code>10</code> 是一个纯右值，因此被隐式地转换为将亡值(<code>R</code>)，模板类型是一个万能引用 <code>T&amp;&amp;</code>，因此 <code>T</code> 推导为右值引用 <code>T&amp;&amp;</code>，因此 <code>a</code> 的类型为 <code>T&amp;&amp;</code></li></ul><h2 id="完美转发" tabindex="-1"><a class="header-anchor" href="#完美转发" aria-hidden="true">#</a> 完美转发</h2><p>在<a href="#%E4%B8%87%E8%83%BD%E5%BC%95%E7%94%A8"><strong>万能引用</strong></a>中，出现了一个 <code>is_lvalue_reference&lt;decltype((static_cast&lt;decltype(a)&gt;(a)))&gt;::value</code>，其中最重要的是 <code>static_cast&lt;decltype(a)&gt;(a)</code>，其目的是将 <code>a</code> 的类型转化为 <code>a</code> 的值类型，这种转化就是「<strong>完美转发</strong>」，也就是<code>std::forward&lt;T&gt;(a)</code>，其源码 (Apple Clang 14.0) 如下</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token operator">&gt;</span>
_LIBCPP_NODISCARD_EXT <span class="token keyword">inline</span> _LIBCPP_HIDE_FROM_ABI _LIBCPP_CONSTEXPR _Tp<span class="token operator">&amp;&amp;</span>
<span class="token function">forward</span><span class="token punctuation">(</span>_LIBCPP_LIFETIMEBOUND __libcpp_remove_reference_t<span class="token operator">&lt;</span>_Tp<span class="token operator">&gt;</span><span class="token operator">&amp;</span> __t<span class="token punctuation">)</span> _NOEXCEPT <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>_Tp<span class="token operator">&amp;&amp;</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>__t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">_Tp</span><span class="token operator">&gt;</span>
_LIBCPP_NODISCARD_EXT <span class="token keyword">inline</span> _LIBCPP_HIDE_FROM_ABI _LIBCPP_CONSTEXPR _Tp<span class="token operator">&amp;&amp;</span>
<span class="token function">forward</span><span class="token punctuation">(</span>_LIBCPP_LIFETIMEBOUND __libcpp_remove_reference_t<span class="token operator">&lt;</span>_Tp<span class="token operator">&gt;</span><span class="token operator">&amp;&amp;</span> __t<span class="token punctuation">)</span> _NOEXCEPT <span class="token punctuation">{</span>
  <span class="token keyword">static_assert</span><span class="token punctuation">(</span><span class="token operator">!</span>is_lvalue_reference<span class="token operator">&lt;</span>_Tp<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">,</span> <span class="token string">&quot;cannot forward an rvalue as an lvalue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>_Tp<span class="token operator">&amp;&amp;</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>__t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看出，其原理实际上就是 <code>static_cast&lt;_Tp&amp;&amp;&gt;(__t)</code>，这里的 <code>_Tp</code> 就是 <code>T</code>，也就是 <code>a</code> 的值类型，<code>__t</code> 就是 <code>a</code>，也就是 <code>a</code> 的引用类型，因此 <code>static_cast&lt;_Tp&amp;&amp;&gt;(__t)</code> 就是将 <code>a</code> 的引用类型转化为 <code>a</code> 的值类型，这就是「<strong>完美转发</strong>」。</p><p>所以上述代码可以简化为</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">f1</span><span class="token punctuation">(</span>T<span class="token operator">&amp;&amp;</span> a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token keyword">constexpr</span><span class="token punctuation">(</span>is_lvalue<span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;lvalue&quot;</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token keyword">constexpr</span><span class="token punctuation">(</span>is_xvalue<span class="token operator">&lt;</span><span class="token keyword">decltype</span><span class="token punctuation">(</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;xvalue&quot;</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的例子有些许复杂，我们在看一个简单的例子<sup><a href="#ref-11">[11]</a></sup></p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">getR</span><span class="token punctuation">(</span>T<span class="token operator">&amp;</span> t<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;lvalueR&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">getR</span><span class="token punctuation">(</span>T<span class="token operator">&amp;&amp;</span> t<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;rvalueR&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">testForward</span><span class="token punctuation">(</span>T<span class="token operator">&amp;&amp;</span> v<span class="token punctuation">)</span><span class="token punctuation">{</span> 
    <span class="token function">getR</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// v 已经是个左值，永远调用左值版本</span>
    <span class="token function">getR</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 永远调用右值版本</span>
    <span class="token function">getR</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 取决于实参的类型</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">testForward</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">//实参为左值，调用左值版本</span>
    <span class="token function">testForward</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//实参为右值，调用右值版本</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个例子就比较清楚了，<code>std::forward&lt;T&gt;(v)</code> 就是将 <code>v</code> 的引用类型转化为 <code>v</code> 的值类型，其调用哪一个重载函数，取决于传递进来的参数是左值还是右值</p><ul><li><p>这个例子其实体现了「<strong>完美转发存在的意义</strong>」，那就是你可以用不上，但不能没有的“功能”。只要你的函数接受了通用引用，又需要把这些通用引用传递给下一层函数，就必须依靠完美转发。<sup><a href="#ref-10">[10]</a></sup></p></li><li><p>那么「<strong>使用完美转发的意义</strong>」就是和设计模式相关的问题了。你可以把所有操作写在一个函数里，也可以分散到多个函数。但只要你分散了，遇到需要传递通用引用到下一层的情况就是难免的了。<sup><a href="#ref-10">[10]</a></sup></p></li></ul><p>「<strong>完美转发</strong>」基于「<strong>万能引用</strong>」，「<strong>引用折叠</strong>」以及「<strong><code>std::forward</code></strong>」。完美转发机制，是为了将左值和右值统一处理，节约代码量，而只有万能引用会出现同时接受左值和右值的情况，所以完美转发只存在于万能引用中。<sup><a href="#ref-11">[11]</a></sup></p><h2 id="写个代码" tabindex="-1"><a class="header-anchor" href="#写个代码" aria-hidden="true">#</a> 写个代码</h2><h3 id="一个类的完整写法" tabindex="-1"><a class="header-anchor" href="#一个类的完整写法" aria-hidden="true">#</a> 一个类的完整写法</h3><p>我们来写一个 <code>Buffer</code> 类，用于接受字节流，包含「<strong>默认构造函数</strong>」、「<strong>拷贝构造函数</strong>」、「<strong>拷贝赋值运算符</strong>」、「<strong>移动构造函数</strong>」、「<strong>移动赋值运算符</strong>」、「<strong>析构函数</strong>」</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">Buffer</span><span class="token punctuation">{</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    size_t         capacity_<span class="token punctuation">;</span> <span class="token comment">// 容量</span>
    size_t         length_<span class="token punctuation">;</span>   <span class="token comment">// 长度</span>
    std<span class="token double-colon punctuation">::</span>string    name_<span class="token punctuation">;</span>     <span class="token comment">// 名称</span>
    <span class="token comment">// 这里有个顺序问题，初始化列表中的顺序是按照成员变量的声明顺序来的</span>
    <span class="token comment">// 因为用到了 capacity_，所以要放在 capacity_ 后面</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span> pbuffer_<span class="token punctuation">;</span>  <span class="token comment">// 指针</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token keyword">explicit</span> <span class="token function">Buffer</span><span class="token punctuation">(</span>size_t capacity<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> name <span class="token operator">=</span> <span class="token string">&quot;tempBuffer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Buffer</span><span class="token punctuation">(</span><span class="token keyword">const</span> Buffer<span class="token operator">&amp;</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Buffer<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Buffer<span class="token operator">&amp;</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Buffer</span><span class="token punctuation">(</span>Buffer<span class="token operator">&amp;&amp;</span> buffer<span class="token punctuation">)</span> <span class="token keyword">noexcept</span><span class="token punctuation">;</span>
    Buffer<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span>Buffer<span class="token operator">&amp;&amp;</span> buffer<span class="token punctuation">)</span> <span class="token keyword">noexcept</span><span class="token punctuation">;</span>
    <span class="token operator">~</span><span class="token function">Buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    size_t <span class="token function">GetLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> length<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    size_t <span class="token function">GetCapacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> capacity<span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">bool</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">append</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span> data<span class="token punctuation">,</span> size_t length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">friend</span> std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>ostream<span class="token operator">&amp;</span> os<span class="token punctuation">,</span> Buffer<span class="token operator">&amp;</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中，<code>capacity</code> 是 buffer 的最大容量，<code>length</code> 是 buffer 的当前长度，<code>buf</code> 是buffer 数组的指针</p><p>默认构造函数是一个单参数的构造函数，可以通过 <code>explicit</code> 关键字来声明，这样就可以避免隐式转换；并且使用初始化列表来初始化成员变量，通过将参数的内存空间与成员变量的内存空间绑定，构造函数列表初始化可以直接对成员变量进行初始化，避免了额外的赋值操作，提高了效率</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token class-name">Buffer</span><span class="token double-colon punctuation">::</span><span class="token function">Buffer</span><span class="token punctuation">(</span>size_t capacity<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> name<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">capacity_</span><span class="token punctuation">(</span>capacity<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">length_</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">name_</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> 
    <span class="token function">pbuffer_</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token punctuation">[</span>capacity<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>name_ <span class="token operator">&lt;&lt;</span> <span class="token string">&quot; [constructor] called: &quot;</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span><span class="token keyword">this</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>析构函数用于释放资源，这里释放了 <code>pbuffer_</code> 的内存空间</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token class-name">Buffer</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">Buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>name_ <span class="token operator">&lt;&lt;</span> <span class="token string">&quot; [destructor] called: &quot;</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span><span class="token keyword">this</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> pbuffer_<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>「<strong>拷贝构造函数</strong>」使用 <code>std::copy</code> 将 <code>other</code> 的数组拷贝给当前对象，拷贝范围是 <code>other.pbuffer_</code> 到 <code>other.pbuffer_ + other.capacity_</code></p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token class-name">Buffer</span><span class="token double-colon punctuation">::</span><span class="token function">Buffer</span><span class="token punctuation">(</span><span class="token keyword">const</span> Buffer<span class="token operator">&amp;</span> other<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">capacity_</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>capacity_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">length_</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>length_<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">name_</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>name_<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">pbuffer_</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token punctuation">[</span>other<span class="token punctuation">.</span>capacity_<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>name_ <span class="token operator">&lt;&lt;</span> <span class="token string">&quot; [copy constructor] called: &quot;</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span><span class="token keyword">this</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span><span class="token function">copy</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>pbuffer_<span class="token punctuation">,</span> other<span class="token punctuation">.</span>pbuffer_ <span class="token operator">+</span> other<span class="token punctuation">.</span>capacity_<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>pbuffer_<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>「<strong>拷贝赋值运算</strong>」首先要检查是否为自赋值，然后释放旧资源，然后将新资源拷贝给当前对象。返回当前对象的引用 (通常是 *this 的引用)，这样可以实现链式赋值，例如 <code>a = b = c</code>，这里的 <code>a</code>、<code>b</code>、<code>c</code> 都是 <code>Buffer</code> 类型的对象</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code>Buffer<span class="token operator">&amp;</span> Buffer<span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Buffer<span class="token operator">&amp;</span> other<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>name_ <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;[copy assignment operator] called: &quot;</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">&amp;</span>other <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">!=</span> <span class="token operator">&amp;</span>other<span class="token punctuation">)</span> <span class="token comment">// 检查是否为自赋值</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 释放旧资源</span>
        <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>pbuffer_<span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token operator">-&gt;</span>capacity_ <span class="token operator">=</span> other<span class="token punctuation">.</span>capacity_<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token operator">-&gt;</span>length_   <span class="token operator">=</span> other<span class="token punctuation">.</span>length_<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token operator">-&gt;</span>name_     <span class="token operator">=</span> other<span class="token punctuation">.</span>name_<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token operator">-&gt;</span>pbuffer_  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token punctuation">[</span>other<span class="token punctuation">.</span>capacity_<span class="token punctuation">]</span><span class="token punctuation">;</span>
        std<span class="token double-colon punctuation">::</span><span class="token function">copy</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>pbuffer_<span class="token punctuation">,</span> other<span class="token punctuation">.</span>pbuffer_ <span class="token operator">+</span> other<span class="token punctuation">.</span>capacity_<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>pbuffer_<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>「<strong>移动构造函数</strong>」通常用于创建新对象，因此任务是获取源对象 <code>other</code> 的资源，并确保源对象 <code>other</code> 不再拥有这些资源。</p><p>需要额外说明的是，在移动构造中，需要使用 <code>noexcept</code> 说明符，告知编译器，我们的移动构造函数不会抛出异常，可以放心使用。以下是为什么移动构造函数和移动赋值运算符通常不引发异常的原因：</p><ol><li>资源转移：移动构造函数和移动赋值运算符的主要目的是将资源（例如内存、文件句柄等）从一个对象转移到另一个对象，而不进行资源的复制。因此，它们的操作通常是相对低风险的，不太可能引发异常。</li><li>预期安全性：移动语义被设计为在正常情况下不引发异常。这使得在移动资源时不需要额外的异常处理代码，提高了代码的可读性和性能。</li><li>性能优化：编译器可以根据 noexcept 信息来进行性能优化。如果一个函数声明为 noexcept，编译器可以生成更高效的代码，因为它知道在该函数中不会引发异常，从而可以避免额外的异常处理开销。</li></ol><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token class-name">Buffer</span><span class="token double-colon punctuation">::</span><span class="token function">Buffer</span><span class="token punctuation">(</span>Buffer<span class="token operator">&amp;&amp;</span> other<span class="token punctuation">)</span> <span class="token keyword">noexcept</span>
    <span class="token operator">:</span> <span class="token function">capacity_</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">length_</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">name_</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">pbuffer_</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 使用 std::move 将资源从 other 转移给当前对象</span>
    capacity_ <span class="token operator">=</span> other<span class="token punctuation">.</span>capacity_<span class="token punctuation">;</span>
    length_   <span class="token operator">=</span> other<span class="token punctuation">.</span>length_<span class="token punctuation">;</span>
    <span class="token comment">// name_     = std::move(other.name_); // 这里报错了，说多个重载，但是编译执行通过，</span>
    name_     <span class="token operator">=</span> other<span class="token punctuation">.</span>name_<span class="token punctuation">;</span>
    pbuffer_  <span class="token operator">=</span> other<span class="token punctuation">.</span>pbuffer_<span class="token punctuation">;</span>

    <span class="token comment">// 清空 other 的资源</span>
    other<span class="token punctuation">.</span>capacity_ <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    other<span class="token punctuation">.</span>length_   <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    other<span class="token punctuation">.</span>name_     <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    other<span class="token punctuation">.</span>pbuffer_  <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>「<strong>移动赋值运算符</strong>」 移用于将源对象 <code>other</code> 的资源转移到当前对象上，而当前对象已经存在并且可能拥有自己的资源。因此，在移动赋值运算符中，通常需要释放当前对象的资源，以确保在资源转移之前清空当前对象，避免资源泄漏和资源的重复释放。</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code>Buffer<span class="token operator">&amp;</span> Buffer<span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span>Buffer<span class="token operator">&amp;&amp;</span> other<span class="token punctuation">)</span> <span class="token keyword">noexcept</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">!=</span> <span class="token operator">&amp;</span>other<span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token comment">// 检查是否为自赋值</span>
        <span class="token comment">// 释放当前对象的资源</span>
        <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> pbuffer_<span class="token punctuation">;</span>

        <span class="token comment">// 使用 std::move 将资源从 other 转移给当前对象</span>
        capacity_ <span class="token operator">=</span> other<span class="token punctuation">.</span>capacity_<span class="token punctuation">;</span>
        length_   <span class="token operator">=</span> other<span class="token punctuation">.</span>length_<span class="token punctuation">;</span>
        <span class="token comment">// name_     = std::move(other.name_); // 这里报错了，说多个重载，但是编译执行通过，</span>
        name_     <span class="token operator">=</span> other<span class="token punctuation">.</span>name_<span class="token punctuation">;</span>
        pbuffer_  <span class="token operator">=</span> other<span class="token punctuation">.</span>pbuffer_<span class="token punctuation">;</span>

        <span class="token comment">/**
         * 偷完资源后，原对象的资源就没有了，所以要把原对象的资源清空
         * 尤其是指针
         */</span>
        other<span class="token punctuation">.</span>capacity_ <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        other<span class="token punctuation">.</span>length_   <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        other<span class="token punctuation">.</span>name_     <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        other<span class="token punctuation">.</span>pbuffer_  <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>特别的，如果假设 <code>Buffer</code> 类不需要这些默认函数，可以删除，并且参数列表中只需要声明类型即可</p><div class="language-cpp ext-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">class</span> <span class="token class-name">Buffer</span> <span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">Buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span><span class="token comment">// 删除默认构造函数</span>
    <span class="token function">Buffer</span><span class="token punctuation">(</span><span class="token keyword">const</span> Buffer<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span><span class="token comment">// 删除拷贝构造函数</span>
    Buffer<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Buffer<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span><span class="token comment">// 删除拷贝赋值运算符</span>
    <span class="token function">Buffer</span><span class="token punctuation">(</span>Buffer<span class="token operator">&amp;&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span><span class="token comment">// 删除移动构造函数</span>
    Buffer<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span>Buffer<span class="token operator">&amp;&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span><span class="token comment">// 删除移动赋值运算符</span>
    <span class="token operator">~</span><span class="token function">Buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span><span class="token comment">// 删除析构函数</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考" aria-hidden="true">#</a> 参考</h2><ul><li><p><span id="ref-1"></span>[1] <a href="https://en.cppreference.com" target="_blank" rel="noopener noreferrer">cppreference.com</a></p></li><li><p><span id="ref-2"></span>[2] <a href="https://eli.thegreenplace.net/2011/12/15/understanding-lvalues-and-rvalues-in-c-and-c/" target="_blank" rel="noopener noreferrer">Understanding lvalues and rvalues in C and C++</a></p></li><li><p><span id="ref-3"></span>[3] <a href="https://changkun.de/modern-cpp/en-us/03-runtime/#3-3-rvalue-Reference" target="_blank" rel="noopener noreferrer">MODERN C++ TUTORIAL: C++ 11/14/17/20 ON THE FLY(SECOND EDITION) Changkun Ou</a></p></li><li><p><span id="ref-4"></span>[4] <a href="https://zhuanlan.zhihu.com/p/378951486" target="_blank" rel="noopener noreferrer">CPP 复制构造函数/赋值运算符？傻傻分不清楚 - 知乎</a></p></li><li><p><span id="ref-5"></span>[5] <a href="https://blog.csdn.net/ganwenbo2011/article/details/100919900" target="_blank" rel="noopener noreferrer">为什么C++中复制构造函数可以访问参数对象的私有成员</a></p></li><li><p><span id="ref-6"></span>[6] <a href="https://zhuanlan.zhihu.com/p/455848360" target="_blank" rel="noopener noreferrer">弘竣：一文入魂：妈妈再也不担心我不懂C++移动语义了 - 知乎</a>：讲得非常详细的文章，推荐</p></li><li><p><span id="ref-7"></span>[7] <a href="https://zhuanlan.zhihu.com/p/435689642" target="_blank" rel="noopener noreferrer">auto&amp;&amp;、万能引用和完美转发 - 知乎</a></p></li><li><p><span id="ref-8"></span>[8] <a href="https://zhuanlan.zhihu.com/p/435605194" target="_blank" rel="noopener noreferrer">如何确定表达式的值类型？ - 知乎</a></p></li><li><p><span id="ref-9"></span>[9] <a href="https://www.zhihu.com/question/40346748" target="_blank" rel="noopener noreferrer">如何理解c++中的引用折叠? - 知乎</a></p></li><li><p><span id="ref-10"></span>[10] <a href="https://www.zhihu.com/question/348291815" target="_blank" rel="noopener noreferrer">C++完美转发是否是多此一举? - 知乎</a></p></li><li><p><span id="ref-11"></span>[11] <a href="https://zhuanlan.zhihu.com/p/369203981" target="_blank" rel="noopener noreferrer">谈谈完美转发(Perfect Forwarding)：完美转发 = 引用折叠 + 万能引用 + std::forward - 知乎</a></p></li><li><p><span id="ref-12"></span>[12] <a href="https://zhuanlan.zhihu.com/p/374392832" target="_blank" rel="noopener noreferrer">什么是move？理解C++ Value categories，move， move in Rust - CrackingOysters的文章 - 知乎</a></p></li><li><p><span id="ref"></span><a href="https://www.zhihu.com/question/567388005" target="_blank" rel="noopener noreferrer">为什么快2023年了三大编译器厂商还没完成c++20的所有新特性? - 知乎</a></p></li></ul></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg><a class="external-link meta-item-label" href="https://github.com/HenryZhuHR/henryzhuhr.github.io/edit/main/docs/program/cpp/rvalue/rvalue.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub"><!--[--><!--]--><!----><span>Edit this page on GitHub</span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><!----></footer><!----><!--[--><div class="pager"><a href="/program/cpp/basic/basic.html" class="prev">Previous <br><span>C++ 基础</span></a><a href="/os/process.html" class="next">Next <br><span>进程管理</span></a></div><!--]--><!----></main><ul class="catalog" style="top:0px;"><li class="level-2 toc-link-左值和右值">左值和右值</li><li class="level-2 toc-link-左值引用">左值引用</li><li class="level-2 toc-link-右值引用">右值引用</li><li class="level-2 toc-link-引用绑定">引用绑定</li><li class="level-2 toc-link-拷贝构造函数和拷贝赋值运算符">拷贝构造函数和拷贝赋值运算符</li><li class="level-3 toc-link-拷贝构造函数">拷贝构造函数</li><li class="level-3 toc-link-拷贝赋值运算符">拷贝赋值运算符</li><li class="level-3 toc-link-拷贝构造函数和拷贝赋值运算符的区别">拷贝构造函数和拷贝赋值运算符的区别</li><li class="level-3 toc-link-深拷贝">深拷贝</li><li class="level-3 toc-link-浅拷贝">浅拷贝</li><li class="level-3 toc-link-拷贝构造函数的应用">拷贝构造函数的应用</li><li class="level-2 toc-link-移动语义">移动语义</li><li class="level-2 toc-link-移动构造函数">移动构造函数</li><li class="level-2 toc-link-万能引用">万能引用</li><li class="level-2 toc-link-引用折叠">引用折叠</li><li class="level-2 toc-link-完美转发">完美转发</li><li class="level-2 toc-link-写个代码">写个代码</li><li class="level-3 toc-link-一个类的完整写法">一个类的完整写法</li><li class="level-2 toc-link-参考">参考</li></ul></div><!--]--></div><div class="search-page" role="search"><span class="search-close"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="28" height="28" fill="currentColor"><path d="M224 416c-8.188 0-16.38-3.125-22.62-9.375l-192-192c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L224 338.8l169.4-169.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-192 192C240.4 412.9 232.2 416 224 416z"></path></svg></span><div class="gungnir-search-box"><input placeholder="$ grep ..." autocomplete="off" spellcheck="false" value><!----></div></div><div class="menu-btn-container"><div class="menu-btn-wrapper"><div class="menu-btn"><div style="" class="menu-btn-icon"><span></span><span></span><span></span></div><div style="display:none;" class="menu-text">0</div><svg class="menu-progress"><circle class="menu-border" cx="50%" cy="50%" r="48%" style="stroke-dasharray:0% 314.15926%;"></circle></svg></div><div class="menu-btn-child-wrapper"><div title="toggle color mode" class="menu-btn-child"><svg class="ov-icon" style="font-size:1.2em;display:none;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M256 160c-52.9 0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0-49.9-49.9-49.9-131.1 0-181 49.9-49.9 131.1-49.9 181 0 49.9 49.9 49.9 131.1 0 181z"/></svg><svg class="ov-icon" style="font-size:1.2em;display:none;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 00283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"/></svg><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M224 96l16-32 32-16-32-16-16-32-16 32-32 16 32 16 16 32zM80 160l26.66-53.33L160 80l-53.34-26.67L80 0 53.34 53.33 0 80l53.34 26.67L80 160zm352 128l-26.66 53.33L352 368l53.34 26.67L432 448l26.66-53.33L512 368l-53.34-26.67L432 288zm70.62-193.77L417.77 9.38C411.53 3.12 403.34 0 395.15 0c-8.19 0-16.38 3.12-22.63 9.38L9.38 372.52c-12.5 12.5-12.5 32.76 0 45.25l84.85 84.85c6.25 6.25 14.44 9.37 22.62 9.37 8.19 0 16.38-3.12 22.63-9.37l363.14-363.15c12.5-12.48 12.5-32.75 0-45.24zM359.45 203.46l-50.91-50.91 86.6-86.6 50.91 50.91-86.6 86.6z"/></svg></div><div class="menu-btn-child"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"/></svg></div><div class="menu-btn-child"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-75.52 -43.52 599.04 599.04" fill="currentColor"><path d="M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z"/></svg></div><div class="menu-btn-child menu-toc-btn"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-43.52 -43.52 599.04 599.04" fill="currentColor"><path d="M48 48a48 48 0 1048 48 48 48 0 00-48-48zm0 160a48 48 0 1048 48 48 48 0 00-48-48zm0 160a48 48 0 1048 48 48 48 0 00-48-48zm448 16H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16v-32a16 16 0 00-16-16zm0-320H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16V80a16 16 0 00-16-16zm0 160H176a16 16 0 00-16 16v32a16 16 0 0016 16h320a16 16 0 0016-16v-32a16 16 0 00-16-16z"/></svg></div><div class="toggle-sidebar-button menu-btn-child menu-btn-sidebar" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><svg class="ov-icon" style="font-size:1.2em;" aria-hidden="true" width="19.2" height="19.2" viewBox="-1.6 -1.6 19.2 19.2" fill="currentColor"><path d="M14 2a1 1 0 011 1v10a1 1 0 01-1 1H2a1 1 0 01-1-1V3a1 1 0 011-1h12zM2 1a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V3a2 2 0 00-2-2H2z"/><path d="M3 4a1 1 0 011-1h2a1 1 0 011 1v8a1 1 0 01-1 1H4a1 1 0 01-1-1V4z"/></svg></div></div></div></div><footer class="footer"><span>
        &copy; <a href="https://github.com/HenryZhuHR" target="_blank">HenryZhuHR</a> 2022-today
        <br>
        Powered by <a href="https://v2.vuepress.vuejs.org" target="_blank">VuePress</a> &
        <a href="https://github.com/Renovamen/vuepress-theme-gungnir" target="_blank">Gungnir</a>
      </span></footer></div><!--]--></div>
    <script type="module" src="/assets/app.1aef078d.js" defer></script>
  </body>
</html>
